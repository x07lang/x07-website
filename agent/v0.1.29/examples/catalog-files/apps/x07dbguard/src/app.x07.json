{"decls":[{"kind":"export","names":["app.solve"]},{"body":["begin",["let","n",["view.len","b"]],["if",["=","n",0],["return",["bytes.lit","{\"error\":\"no command\"}"]],0],["let","plan_cmd",["bytes.lit","plan"]],["let","verify_cmd",["bytes.lit","verify"]],["let","apply_cmd",["bytes.lit","apply"]],["let","plan_bytes",["os.fs.read_file",["bytes.lit","arch/db/migrations/dbguard_v1.migrate.json"]]],["let","plan_json",["bytes.view","plan_bytes"]],["if",["std.bytes.starts_with","b",["bytes.view","plan_cmd"]],["app.plan.run_v1","plan_json"],["if",["std.bytes.starts_with","b",["bytes.view","verify_cmd"]],["begin",["let","fp",["app.fingerprint.hex_v1","plan_json"]],["app.verify.run_v1","plan_json",["bytes.view","fp"]]],["if",["std.bytes.starts_with","b",["bytes.view","apply_cmd"]],["begin",["let","apply_len",["view.len",["bytes.view","apply_cmd"]]],["if",["<=","n",["+",1,"apply_len"]],["return",["bytes.lit","{\"error\":\"apply requires sqlite path\"}"]],0],["if",["!=",["view.get_u8","b","apply_len"],32],["return",["bytes.lit","{\"error\":\"apply requires sqlite path\"}"]],0],["let","dsn_view",["view.slice","b",["+",1,"apply_len"],["-","n",["+",1,"apply_len"]]]],["let","dsn_val",["ext.data_model.value_string","dsn_view"]],["let","dsn_doc",["ext.data_model.doc_ok",["bytes.view","dsn_val"]]],["let","plan_id",["bytes.lit","dbguard_v1"]],["app.apply.run_v1",["bytes.view","plan_id"],["bytes.view","dsn_doc"]]],["bytes.lit","{\"error\":\"unknown command\"}"]]]]],"kind":"defn","name":"app.solve","params":[{"name":"b","ty":"bytes_view"}],"result":"bytes"}],"imports":["app.apply","app.fingerprint","app.plan","app.verify","ext.data_model","std.bytes"],"kind":"module","module_id":"app","schema_version":"x07.x07ast@0.5.0"}
