{"decls":[{"kind":"export","names":["std.obs.openmetrics.render_v1"]},{"body":["begin",["let","o","out"],["let","n",["view.len","s"]],["for","i",0,"n",["begin",["let","c",["view.get_u8","s","i"]],["if",["if",["=","c",34],1,["=","c",92]],["begin",["set","o",["vec_u8.push","o",92]],["set","o",["vec_u8.push","o","c"]],0],["if",["=","c",10],["begin",["set","o",["vec_u8.push","o",92]],["set","o",["vec_u8.push","o",110]],0],["if",["=","c",13],["begin",["set","o",["vec_u8.push","o",92]],["set","o",["vec_u8.push","o",114]],0],["if",["=","c",9],["begin",["set","o",["vec_u8.push","o",92]],["set","o",["vec_u8.push","o",116]],0],["begin",["set","o",["vec_u8.push","o","c"]],0]]]]],0]],"o"],"kind":"defn","name":"std.obs.openmetrics._append_escaped_value_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"s","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","o","out"],["let","labels_len",["ext.data_model.seq_len","doc","labels_off"]],["if",["<","labels_len",0],["return","o"],0],["let","have_le",["if",[">",["view.len","le"],0],1,0]],["if",["if",[">","labels_len",0],1,["!=","have_le",0]],0,["return","o"]],["set","o",["vec_u8.push","o",123]],["let","first",1],["for","i",0,"labels_len",["begin",["let","entry_off",["ext.data_model.seq_get","doc","labels_off","i"]],["if",["<","entry_off",0],["return","o"],0],["let","k_key",["bytes.lit","k"]],["let","v_key",["bytes.lit","v"]],["let","k_off",["ext.data_model.map_find","doc","entry_off",["bytes.view","k_key"]]],["let","v_off",["ext.data_model.map_find","doc","entry_off",["bytes.view","v_key"]]],["if",["if",["<","k_off",0],1,["<","v_off",0]],["return","o"],0],["let","k",["ext.data_model.string_get","doc","k_off"]],["let","v",["ext.data_model.string_get","doc","v_off"]],["if",["=","first",0],["set","o",["vec_u8.push","o",44]],0],["set","first",0],["set","o",["vec_u8.extend_bytes","o","k"]],["set","o",["vec_u8.push","o",61]],["set","o",["vec_u8.push","o",34]],["set","o",["std.obs.openmetrics._append_escaped_value_v1","o",["bytes.view","v"]]],["set","o",["vec_u8.push","o",34]],0]],["if",["!=","have_le",0],["begin",["if",["=","first",0],["set","o",["vec_u8.push","o",44]],0],["set","o",["vec_u8.extend_bytes","o",["bytes.lit","le"]]],["set","o",["vec_u8.push","o",61]],["set","o",["vec_u8.push","o",34]],["set","o",["std.obs.openmetrics._append_escaped_value_v1","o","le"]],["set","o",["vec_u8.push","o",34]],0],0],["set","o",["vec_u8.push","o",125]],"o"],"kind":"defn","name":"std.obs.openmetrics._append_labelset_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"doc","ty":"bytes_view"},{"name":"labels_off","ty":"i32"},{"name":"le","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["if",["=",["ext.data_model.doc_is_err","snapshot"],1],["return",["result_bytes.err",62001]],0],["if",["!=",["ext.data_model.root_kind","snapshot"],5],["return",["result_bytes.err",62002]],0],["let","root",["ext.data_model.root_offset","snapshot"]],["let","k_schema",["bytes.lit","schema_version"]],["let","schema_off",["ext.data_model.map_find","snapshot","root",["bytes.view","k_schema"]]],["if",["<","schema_off",0],["return",["result_bytes.err",62003]],0],["let","schema",["ext.data_model.string_get","snapshot","schema_off"]],["if",["bytes.eq","schema",["bytes.lit","x07.obs.snapshot@0.1.0"]],0,["return",["result_bytes.err",62004]]],["let","k_metrics",["bytes.lit","metrics"]],["let","metrics_off",["ext.data_model.map_find","snapshot","root",["bytes.view","k_metrics"]]],["if",["<","metrics_off",0],["return",["result_bytes.err",62005]],0],["let","metrics_len",["ext.data_model.seq_len","snapshot","metrics_off"]],["if",["<","metrics_len",0],["return",["result_bytes.err",62006]],0],["let","out",["vec_u8.with_capacity",1024]],["let","le_inf",["bytes.lit","+Inf"]],["let","empty",["bytes.alloc",0]],["for","mi",0,"metrics_len",["begin",["let","metric_off",["ext.data_model.seq_get","snapshot","metrics_off","mi"]],["if",["<","metric_off",0],["return",["result_bytes.err",62007]],0],["let","k_id",["bytes.lit","id"]],["let","k_type",["bytes.lit","type"]],["let","k_help",["bytes.lit","help"]],["let","k_unit",["bytes.lit","unit"]],["let","id_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_id"]]],["let","type_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_type"]]],["let","help_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_help"]]],["let","unit_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_unit"]]],["if",["if",["<","id_off",0],1,["<","type_off",0]],["return",["result_bytes.err",62008]],0],["let","id",["ext.data_model.string_get","snapshot","id_off"]],["let","typ",["ext.data_model.string_get","snapshot","type_off"]],["let","help",["if",["<","help_off",0],["bytes.alloc",0],["ext.data_model.string_get","snapshot","help_off"]]],["let","unit",["if",["<","unit_off",0],["bytes.alloc",0],["ext.data_model.string_get","snapshot","unit_off"]]],["let","prom_type",["if",["bytes.eq","typ",["bytes.lit","counter_u64_v1"]],["bytes.lit","counter"],["if",["bytes.eq","typ",["bytes.lit","gauge_f64_v1"]],["bytes.lit","gauge"],["if",["bytes.eq","typ",["bytes.lit","histogram_f64_v1"]],["bytes.lit","histogram"],["bytes.lit","unknown"]]]]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","# HELP "]]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["vec_u8.push","out",32]],["set","out",["std.obs.openmetrics._append_escaped_value_v1","out",["bytes.view","help"]]],["set","out",["vec_u8.push","out",10]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","# TYPE "]]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","prom_type"]],["set","out",["vec_u8.push","out",10]],["if",[">",["bytes.len","unit"],0],["begin",["set","out",["vec_u8.extend_bytes","out",["bytes.lit","# UNIT "]]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","unit"]],["set","out",["vec_u8.push","out",10]],0],0],["let","k_series",["bytes.lit","series"]],["let","series_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_series"]]],["if",["<","series_off",0],["return",["result_bytes.err",62009]],0],["let","series_len",["ext.data_model.seq_len","snapshot","series_off"]],["if",["<","series_len",0],["return",["result_bytes.err",62010]],0],["for","si",0,"series_len",["begin",["let","s_off",["ext.data_model.seq_get","snapshot","series_off","si"]],["if",["<","s_off",0],["return",["result_bytes.err",62011]],0],["let","k_labels",["bytes.lit","labels"]],["let","labels_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_labels"]]],["if",["<","labels_off",0],["return",["result_bytes.err",62012]],0],["if",["bytes.eq","typ",["bytes.lit","histogram_f64_v1"]],["begin",["let","k_buckets",["bytes.lit","buckets"]],["let","buckets_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_buckets"]]],["if",["<","buckets_off",0],["return",["result_bytes.err",62013]],0],["let","buckets_len",["ext.data_model.seq_len","snapshot","buckets_off"]],["if",["<","buckets_len",0],["return",["result_bytes.err",62014]],0],["let","k_bucket_counts",["bytes.lit","bucket_counts"]],["let","bc_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_bucket_counts"]]],["if",["<","bc_off",0],["return",["result_bytes.err",62015]],0],["for","bi",0,"buckets_len",["begin",["let","b_off",["ext.data_model.seq_get","snapshot","buckets_off","bi"]],["let","le_str",["ext.data_model.number_get","snapshot","b_off"]],["let","c_off",["ext.data_model.seq_get","snapshot","bc_off","bi"]],["let","c_str",["ext.data_model.number_get","snapshot","c_off"]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","_bucket"]]],["set","out",["std.obs.openmetrics._append_labelset_v1","out","snapshot","labels_off",["bytes.view","le_str"]]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","c_str"]],["set","out",["vec_u8.push","out",10]],0]],["let","c_inf_off",["ext.data_model.seq_get","snapshot","bc_off","buckets_len"]],["let","c_inf_str",["ext.data_model.number_get","snapshot","c_inf_off"]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","_bucket"]]],["set","out",["std.obs.openmetrics._append_labelset_v1","out","snapshot","labels_off",["bytes.view","le_inf"]]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","c_inf_str"]],["set","out",["vec_u8.push","out",10]],["let","k_sum",["bytes.lit","sum"]],["let","sum_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_sum"]]],["if",["<","sum_off",0],["return",["result_bytes.err",62016]],0],["let","sum_str",["ext.data_model.number_get","snapshot","sum_off"]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","_sum"]]],["set","out",["std.obs.openmetrics._append_labelset_v1","out","snapshot","labels_off",["bytes.view","empty"]]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","sum_str"]],["set","out",["vec_u8.push","out",10]],["let","k_count",["bytes.lit","count"]],["let","count_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_count"]]],["if",["<","count_off",0],["return",["result_bytes.err",62017]],0],["let","count_str",["ext.data_model.number_get","snapshot","count_off"]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","_count"]]],["set","out",["std.obs.openmetrics._append_labelset_v1","out","snapshot","labels_off",["bytes.view","empty"]]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","count_str"]],["set","out",["vec_u8.push","out",10]],0],["begin",["let","k_value",["bytes.lit","value"]],["let","value_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_value"]]],["if",["<","value_off",0],["return",["result_bytes.err",62018]],0],["let","value_str",["ext.data_model.number_get","snapshot","value_off"]],["set","out",["vec_u8.extend_bytes","out","id"]],["set","out",["std.obs.openmetrics._append_labelset_v1","out","snapshot","labels_off",["bytes.view","empty"]]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.extend_bytes","out","value_str"]],["set","out",["vec_u8.push","out",10]],0]],0]],0]],["set","out",["vec_u8.extend_bytes","out",["bytes.lit","# EOF\n"]]],["result_bytes.ok",["vec_u8.into_bytes","out"]]],"kind":"defn","name":"std.obs.openmetrics.render_v1","params":[{"name":"snapshot","ty":"bytes_view"}],"result":"result_bytes"}],"imports":["ext.data_model","std.vec"],"kind":"module","module_id":"std.obs.openmetrics","schema_version":"x07.x07ast@0.3.0"}
