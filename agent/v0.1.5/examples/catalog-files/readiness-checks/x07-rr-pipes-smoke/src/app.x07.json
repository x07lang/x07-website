{"decls":[{"kind":"export","names":["app.ingest_record_v1","app.ingest_replay_v1","app.main"]},{"body":["std.rr.with_policy_v1",["bytes.lit","smoke_rr_v1"],["bytes.lit","ingest_v1.rrbin"],["i32.lit",1],["budget.scope_from_arch_v1",["bytes.lit","ingest_rr_v1"],["result_bytes.ok",["std.stream.pipe_v1",["std.stream.cfg_v1",["chunk_max_bytes",64],["bufread_cap_bytes",64],["max_in_bytes",64],["max_out_bytes",64],["max_items",8]],["std.stream.src.rr_send_v1",["std.stream.expr_v1",["bytes.lit","C"]]],["std.stream.chain_v1",["std.stream.xf.split_lines_v1",["std.stream.expr_v1",10],["std.stream.expr_v1",64]]],["std.stream.sink.collect_bytes_v1"]]]]],"kind":"defn","name":"app._pipe_res_record_v1","params":[],"result":"result_bytes"},{"body":["std.rr.with_policy_v1",["bytes.lit","smoke_rr_v1"],["bytes.lit","ingest_v1.rrbin"],["i32.lit",2],["budget.scope_from_arch_v1",["bytes.lit","ingest_rr_v1"],["result_bytes.ok",["std.stream.pipe_v1",["std.stream.cfg_v1",["chunk_max_bytes",64],["bufread_cap_bytes",64],["max_in_bytes",64],["max_out_bytes",64],["max_items",8]],["std.stream.src.rr_send_v1",["std.stream.expr_v1",["bytes.lit","C"]]],["std.stream.chain_v1",["std.stream.xf.split_lines_v1",["std.stream.expr_v1",10],["std.stream.expr_v1",64]]],["std.stream.sink.collect_bytes_v1"]]]]],"kind":"defn","name":"app._pipe_res_replay_v1","params":[],"result":"result_bytes"},{"body":["begin",["let","out",["std.vec.with_capacity",160]],["set","out",["std.vec.extend_bytes","out",["bytes.lit","{\"err\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","err"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"mode\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","mode"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"ok\":0}"]]],["let","raw",["std.vec.as_bytes","out"]],["std.json.canonicalize_small",["bytes.view","raw"]]],"kind":"defn","name":"app._report_err_v1","params":[{"name":"mode","ty":"i32"},{"name":"err","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","n",["bytes.len","doc"]],["if",["<u","n",1],["return",["app._report_err_v1","mode",9001]],0],["let","tag",["bytes.get_u8","doc",0]],["if",["=","tag",0],["begin",["let","dv",["bytes.view","doc"]],["let","err",["if",[">=u","n",5],["std.codec.read_u32_le","dv",1],9002]],["return",["app._report_err_v1","mode","err"]]],0],["if",["<u","n",21],["return",["app._report_err_v1","mode",9003]],0],["let","dv",["bytes.view","doc"]],["let","bytes_in",["std.codec.read_u32_le","dv",1]],["let","bytes_out",["std.codec.read_u32_le","dv",5]],["let","items_in",["std.codec.read_u32_le","dv",9]],["let","items_out",["std.codec.read_u32_le","dv",13]],["let","payload_len",["std.codec.read_u32_le","dv",17]],["let","payload",["view.slice","dv",21,"payload_len"]],["let","want",["bytes.lit","PONG"]],["let","payload_ok",["if",["=",["std.bytes.eq","payload",["bytes.view","want"]],1],1,0]],["app._report_ok_v1","mode","bytes_in","bytes_out","items_in","items_out","payload_len","payload_ok"]],"kind":"defn","name":"app._report_from_doc_v1","params":[{"name":"doc","ty":"bytes"},{"name":"mode","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","ok",["if",["if",["=","payload_ok",1],["=","items_out",1],0],1,0]],["let","out",["std.vec.with_capacity",256]],["set","out",["std.vec.extend_bytes","out",["bytes.lit","{\"bytes_in\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","bytes_in"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"bytes_out\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","bytes_out"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"items_in\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","items_in"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"items_out\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","items_out"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"mode\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","mode"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"payload_len\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","payload_len"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"payload_ok\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","payload_ok"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit",",\"ok\":"]]],["set","out",["std.vec.extend_bytes","out",["std.fmt.s32_to_dec","ok"]]],["set","out",["std.vec.extend_bytes","out",["bytes.lit","}"]]],["let","raw",["std.vec.as_bytes","out"]],["std.json.canonicalize_small",["bytes.view","raw"]]],"kind":"defn","name":"app._report_ok_v1","params":[{"name":"mode","ty":"i32"},{"name":"bytes_in","ty":"i32"},{"name":"bytes_out","ty":"i32"},{"name":"items_in","ty":"i32"},{"name":"items_out","ty":"i32"},{"name":"payload_len","ty":"i32"},{"name":"payload_ok","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","res",["app._pipe_res_record_v1"]],["let","err",["result_bytes.err_code","res"]],["if",["!=","err",0],["return",["app._report_err_v1",1,"err"]],0],["let","doc",["result_bytes.unwrap_or","res",["bytes.alloc",0]]],["app._report_from_doc_v1","doc",1]],"kind":"defn","name":"app.ingest_record_v1","params":[],"result":"bytes"},{"body":["begin",["let","res",["app._pipe_res_replay_v1"]],["let","err",["result_bytes.err_code","res"]],["if",["!=","err",0],["return",["app._report_err_v1",2,"err"]],0],["let","doc",["result_bytes.unwrap_or","res",["bytes.alloc",0]]],["app._report_from_doc_v1","doc",2]],"kind":"defn","name":"app.ingest_replay_v1","params":[],"result":"bytes"},{"body":["begin",["let","is_record",["if",[">",["view.len","input_bytes"],0],["if",["=",["view.get_u8","input_bytes",0],114],1,0],0]],["if",["=","is_record",1],["app.ingest_record_v1"],["app.ingest_replay_v1"]]],"kind":"defn","name":"app.main","params":[{"name":"input_bytes","ty":"bytes_view"}],"result":"bytes"}],"imports":["std.bytes","std.codec","std.fmt","std.json","std.rr","std.vec"],"kind":"module","module_id":"app","schema_version":"x07.x07ast@0.4.0"}
