{"decls":[{"kind":"export","names":["ext.xml.xml_events_attr_count","ext.xml.xml_events_attr_key","ext.xml.xml_events_attr_value","ext.xml.xml_events_is_err","ext.xml.xml_events_kind","ext.xml.xml_events_len","ext.xml.xml_events_name","ext.xml.xml_events_parse","ext.xml.xml_events_text","ext.xml.xml_tree_attr_count","ext.xml.xml_tree_attr_key","ext.xml.xml_tree_attr_value","ext.xml.xml_tree_child_at","ext.xml.xml_tree_child_count","ext.xml.xml_tree_is_err","ext.xml.xml_tree_node_count","ext.xml.xml_tree_node_kind","ext.xml.xml_tree_node_name","ext.xml.xml_tree_node_parent","ext.xml.xml_tree_node_text","ext.xml.xml_tree_parse","ext.xml.xml_tree_root"]},{"body":["begin",["if",["<","start",0],["return",["-",0,1]],0],["if",["<","attr_count",0],["return",["-",0,1]],0],["if",["if",["<","attr_idx",0],1,[">=","attr_idx","attr_count"]],["return",["-",0,1]],0],["let","p","start"],["let","a",0],["for","_",0,"attr_idx",["if",["<u","a","attr_idx"],["begin",["if",[">=u",["+","p",4],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["let","key_len",["ext.xml._read_u32_le","doc","p"]],["if",["<","key_len",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["if",[">=u",["+","p","key_len"],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["set","p",["+","p","key_len"]],["if",[">=u",["+","p",4],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["let","val_len",["ext.xml._read_u32_le","doc","p"]],["if",["<","val_len",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["if",[">=u",["+","p","val_len"],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["set","p",["+","p","val_len"]],["set","a",["+","a",1]]],0]],"p"],"kind":"defn","name":"ext.xml._attr_entry_off","params":[{"name":"doc","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"attr_count","ty":"i32"},{"name":"attr_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",["+",["-","end","start"],1]]],["set","out",["vec_u8.push","out",1]],["let","i","start"],["let","done",0],["for","_",0,["+",["-","end","start"],1],["if",["=","done",0],["if",[">=u","i","end"],["set","done",1],["begin",["let","c",["view.get_u8","src","i"]],["if",["=",["=","c",38],0],["begin",["set","out",["vec_u8.push","out","c"]],["set","i",["+","i",1]]],["begin",["if",[">=u",["+","i",1],"end"],["return",["ext.xml._res_err0"]],0],["let","c1",["view.get_u8","src",["+","i",1]]],["if",["=","c1",108],["begin",["if",[">=u",["+","i",3],"end"],["return",["ext.xml._res_err0"]],0],["if",["if",["=",["view.get_u8","src",["+","i",2]],116],["=",["view.get_u8","src",["+","i",3]],59],0],["begin",["set","out",["vec_u8.push","out",60]],["set","i",["+","i",4]]],["return",["ext.xml._res_err0"]]],0],["if",["=","c1",103],["begin",["if",[">=u",["+","i",3],"end"],["return",["ext.xml._res_err0"]],0],["if",["if",["=",["view.get_u8","src",["+","i",2]],116],["=",["view.get_u8","src",["+","i",3]],59],0],["begin",["set","out",["vec_u8.push","out",62]],["set","i",["+","i",4]]],["return",["ext.xml._res_err0"]]],0],["if",["=","c1",97],["begin",["if",[">=u",["+","i",4],"end"],["return",["ext.xml._res_err0"]],0],["if",["if",["if",["=",["view.get_u8","src",["+","i",2]],109],["=",["view.get_u8","src",["+","i",3]],112],0],["=",["view.get_u8","src",["+","i",4]],59],0],["begin",["set","out",["vec_u8.push","out",38]],["set","i",["+","i",5]]],["if",[">=u",["+","i",5],"end"],["return",["ext.xml._res_err0"]],["if",["if",["if",["if",["=",["view.get_u8","src",["+","i",2]],112],["=",["view.get_u8","src",["+","i",3]],111],0],["=",["view.get_u8","src",["+","i",4]],115],0],["=",["view.get_u8","src",["+","i",5]],59],0],["begin",["set","out",["vec_u8.push","out",39]],["set","i",["+","i",6]]],["return",["ext.xml._res_err0"]]]]],0],["if",["=","c1",113],["begin",["if",[">=u",["+","i",5],"end"],["return",["ext.xml._res_err0"]],0],["if",["if",["if",["if",["=",["view.get_u8","src",["+","i",2]],117],["=",["view.get_u8","src",["+","i",3]],111],0],["=",["view.get_u8","src",["+","i",4]],116],0],["=",["view.get_u8","src",["+","i",5]],59],0],["begin",["set","out",["vec_u8.push","out",34]],["set","i",["+","i",6]]],["return",["ext.xml._res_err0"]]],0],["if",["=","c1",35],["begin",["if",[">=u",["+","i",2],"end"],["return",["ext.xml._res_err0"]],0],["let","base",10],["let","j",["+","i",2]],["let","c2",["view.get_u8","src","j"]],["if",["if",["=","c2",120],1,["=","c2",88]],["begin",["set","base",16],["set","j",["+","j",1]]],0],["if",[">=u","j","end"],["return",["ext.xml._res_err0"]],0],["let","cp",0],["let","any",0],["let","found_semi",0],["let","done2",0],["for","_",0,["+",["-","end","j"],1],["if",["=","done2",0],["if",[">=u","j","end"],["set","done2",1],["begin",["let","d",["view.get_u8","src","j"]],["if",["=","d",59],["begin",["set","found_semi",1],["set","done2",1]],["begin",["let","val",["if",["=","base",10],["ext.xml._hex_val","d"],["ext.xml._hex_val","d"]]],["let","ok_digit",["if",["=","base",10],["if",[">=u","d",48],["<u","d",58],0],[">=","val",0]]],["if",["=","ok_digit",0],["return",["ext.xml._res_err0"]],0],["let","digit",["if",["=","base",10],["-","d",48],"val"]],["set","cp",["+",["*","cp","base"],"digit"]],["set","any",1],["set","j",["+","j",1]]]]]],0]],["if",["if",["=","found_semi",0],1,["=","any",0]],["return",["ext.xml._res_err0"]],0],["if",["=","cp",0],["return",["ext.xml._res_err0"]],0],["if",["if",[">=u","cp",55296],["<u","cp",57344],0],["return",["ext.xml._res_err0"]],0],["if",[">=u","cp",1114112],["return",["ext.xml._res_err0"]],0],["set","out",["ext.xml._push_utf8","out","cp"]],["set","i",["+","j",1]]],["return",["ext.xml._res_err0"]]]]]]]]]]],0]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._decode_entities_status","params":[{"name":"src","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"end","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","e","events"],["set","e",["vec_u8.push","e","kind"]],["set","e",["vec_u8.push","e",0]],["set","e",["vec_u8.push","e",0]],["set","e",["vec_u8.push","e",0]],["set","e",["ext.xml._push_u32_le","e","name_start"]],["set","e",["ext.xml._push_u32_le","e","name_len"]],["set","e",["ext.xml._push_u32_le","e","attr_start"]],["set","e",["ext.xml._push_u32_le","e","attr_count"]],["set","e",["ext.xml._push_u32_le","e","text_start"]],["set","e",["ext.xml._push_u32_le","e","text_len"]],"e"],"kind":"defn","name":"ext.xml._emit_event_record","params":[{"name":"events","ty":"vec_u8"},{"name":"kind","ty":"i32"},{"name":"name_start","ty":"i32"},{"name":"name_len","ty":"i32"},{"name":"attr_start","ty":"i32"},{"name":"attr_count","ty":"i32"},{"name":"text_start","ty":"i32"},{"name":"text_len","ty":"i32"}],"result":"vec_u8"},{"body":["vec_u8.into_bytes",["vec_u8.with_capacity",0]],"kind":"defn","name":"ext.xml._empty_bytes","params":[],"result":"bytes"},{"body":["begin",["let","ok",1],["let","i",0],["for","_",0,"len",["if","ok",["begin",["let","ac",["view.get_u8","a",["+","a_start","i"]]],["let","bc",["view.get_u8","b",["+","b_start","i"]]],["if",["=",["=","ac","bc"],0],["set","ok",0],0],["set","i",["+","i",1]]],0]],"ok"],"kind":"defn","name":"ext.xml._eq_bytes_range","params":[{"name":"a","ty":"bytes_view"},{"name":"a_start","ty":"i32"},{"name":"b","ty":"bytes_view"},{"name":"b_start","ty":"i32"},{"name":"len","ty":"i32"}],"result":"i32"},{"body":["begin",["let","off",["ext.xml._events_find_event_off","doc","idx"]],["if",["<","off",0],["return",["-",0,1]],0],["if",["=",["=",["view.get_u8","doc","off"],1],0],["return",["-",0,1]],0],["if",[">=u",["+","off",5],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["let","name_len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","name_len",0],["return",["-",0,1]],0],["let","p",["+","off",5]],["if",[">=u",["+","p","name_len"],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["set","p",["+","p","name_len"]],["if",[">=u",["+","p",4],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["let","attr_count",["ext.xml._read_u32_le","doc","p"]],["if",["<","attr_count",0],["return",["-",0,1]],0],["ext.xml._attr_entry_off","doc",["+","p",4],"attr_count","attr_idx"]],"kind":"defn","name":"ext.xml._events_attr_entry_off","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"},{"name":"attr_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","count",["ext.xml.xml_events_len","doc"]],["if",["<","count",0],["return",["-",0,1]],0],["if",["if",["<","idx",0],1,[">=","idx","count"]],["return",["-",0,1]],0],["let","off",["ext.xml._events_payload_start"]],["let","i",0],["for","_",0,"idx",["if",["<u","i","idx"],["begin",["set","off",["ext.xml._events_skip_one","doc","off"]],["if",["<","off",0],["return",["-",0,1]],0],["set","i",["+","i",1]]],0]],"off"],"kind":"defn","name":"ext.xml._events_find_event_off","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","payload"]],["if",["<","off",0],["return",["-",0,1]],0],["if",[">=u","off","n"],["return",["-",0,1]],0],["let","kind",["view.get_u8","payload","off"]],["if",["=","kind",1],["begin",["if",[">=u",["+","off",5],["+","n",1]],["return",["-",0,1]],0],["let","name_len",["ext.xml._read_u32_le","payload",["+","off",1]]],["if",["<","name_len",0],["return",["-",0,1]],0],["let","p",["+","off",5]],["if",[">=u",["+","p","name_len"],["+","n",1]],["return",["-",0,1]],0],["set","p",["+","p","name_len"]],["if",[">=u",["+","p",4],["+","n",1]],["return",["-",0,1]],0],["let","attr_count",["ext.xml._read_u32_le","payload","p"]],["if",["<","attr_count",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["let","a",0],["for","_",0,"attr_count",["if",["<u","a","attr_count"],["begin",["if",[">=u",["+","p",4],["+","n",1]],["return",["-",0,1]],0],["let","key_len",["ext.xml._read_u32_le","payload","p"]],["if",["<","key_len",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["if",[">=u",["+","p","key_len"],["+","n",1]],["return",["-",0,1]],0],["set","p",["+","p","key_len"]],["if",[">=u",["+","p",4],["+","n",1]],["return",["-",0,1]],0],["let","val_len",["ext.xml._read_u32_le","payload","p"]],["if",["<","val_len",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["if",[">=u",["+","p","val_len"],["+","n",1]],["return",["-",0,1]],0],["set","p",["+","p","val_len"]],["set","a",["+","a",1]]],0]],"p"],["if",["if",["=","kind",2],1,["=","kind",3]],["begin",["if",[">=u",["+","off",5],["+","n",1]],["return",["-",0,1]],0],["let","len",["ext.xml._read_u32_le","payload",["+","off",1]]],["if",["<","len",0],["return",["-",0,1]],0],["let","p",["+","off",5]],["if",[">=u",["+","p","len"],["+","n",1]],["return",["-",0,1]],0],["+","p","len"]],["-",0,1]]]],"kind":"defn","name":"ext.xml._events_payload_skip_one","params":[{"name":"payload","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":5,"kind":"defn","name":"ext.xml._events_payload_start","params":[],"result":"i32"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<","off",0],["return",["-",0,1]],0],["if",[">=u","off","n"],["return",["-",0,1]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=","kind",1],["begin",["if",[">=u",["+","off",5],["+","n",1]],["return",["-",0,1]],0],["let","name_len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","name_len",0],["return",["-",0,1]],0],["let","p",["+","off",5]],["if",[">=u",["+","p","name_len"],["+","n",1]],["return",["-",0,1]],0],["set","p",["+","p","name_len"]],["if",[">=u",["+","p",4],["+","n",1]],["return",["-",0,1]],0],["let","attr_count",["ext.xml._read_u32_le","doc","p"]],["if",["<","attr_count",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["let","a",0],["for","_",0,"attr_count",["if",["<u","a","attr_count"],["begin",["if",[">=u",["+","p",4],["+","n",1]],["return",["-",0,1]],0],["let","key_len",["ext.xml._read_u32_le","doc","p"]],["if",["<","key_len",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["if",[">=u",["+","p","key_len"],["+","n",1]],["return",["-",0,1]],0],["set","p",["+","p","key_len"]],["if",[">=u",["+","p",4],["+","n",1]],["return",["-",0,1]],0],["let","val_len",["ext.xml._read_u32_le","doc","p"]],["if",["<","val_len",0],["return",["-",0,1]],0],["set","p",["+","p",4]],["if",[">=u",["+","p","val_len"],["+","n",1]],["return",["-",0,1]],0],["set","p",["+","p","val_len"]],["set","a",["+","a",1]]],0]],"p"],["if",["if",["=","kind",2],1,["=","kind",3]],["begin",["if",[">=u",["+","off",5],["+","n",1]],["return",["-",0,1]],0],["let","len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","len",0],["return",["-",0,1]],0],["let","p",["+","off",5]],["if",[">=u",["+","p","len"],["+","n",1]],["return",["-",0,1]],0],["+","p","len"]],["-",0,1]]]],"kind":"defn","name":"ext.xml._events_skip_one","params":[{"name":"doc","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","i","start"],["let","found",["-",0,1]],["for","_","start","end",["if",["<u","i","end"],["if",["<","found",0],["if",["=",["view.get_u8","src","i"],"needle"],["set","found","i"],["set","i",["+","i",1]]],0],0]],"found"],"kind":"defn","name":"ext.xml._find_byte","params":[{"name":"src","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"end","ty":"i32"},{"name":"needle","ty":"i32"}],"result":"i32"},{"body":["begin",["let","i","content_start"],["let","found",0],["let","done",0],["for","_",0,["-","n","content_start"],["if",["=","done",0],["if",[">=u",["+","i",2],"n"],["set","done",1],["if",["if",["if",["=",["view.get_u8","src","i"],93],["=",["view.get_u8","src",["+","i",1]],93],0],["=",["view.get_u8","src",["+","i",2]],62],0],["begin",["set","found",1],["set","done",1]],["set","i",["+","i",1]]]],0]],["if","found","i",["-",0,1]]],"kind":"defn","name":"ext.xml._find_cdata_close_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"content_start","ty":"i32"},{"name":"n","ty":"i32"}],"result":"i32"},{"body":["begin",["let","i","start"],["let","found",["-",0,1]],["for","_","start","n",["if",["<u","i","n"],["if",["<","found",0],["if",["=",["view.get_u8","src","i"],60],["set","found","i"],["set","i",["+","i",1]]],0],0]],["if",["<","found",0],"n","found"]],"kind":"defn","name":"ext.xml._find_lt","params":[{"name":"src","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"n","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["if",[">=u","c",48],["<u","c",58],0],["return",["-","c",48]],0],["if",["if",[">=u","c",65],["<u","c",71],0],["return",["-","c",55]],0],["if",["if",[">=u","c",97],["<u","c",103],0],["return",["-","c",87]],0],["-",0,1]],"kind":"defn","name":"ext.xml._hex_val","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","i","start"],["let","ok",1],["for","_","start","end",["if",["if","ok",["<u","i","end"],0],["begin",["if",["=",["ext.xml._is_ws",["view.get_u8","src","i"]],0],["set","ok",0],0],["set","i",["+","i",1]]],0]],"ok"],"kind":"defn","name":"ext.xml._is_all_ws","params":[{"name":"src","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"end","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["ext.xml._is_name_start","c"],["return",1],0],["if",["if",[">=u","c",48],["<u","c",58],0],["return",1],0],["if",["if",["=","c",45],1,["=","c",46]],["return",1],0],0],"kind":"defn","name":"ext.xml._is_name_char","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["if",["=","c",58],1,["=","c",95]],["return",1],0],["if",["if",[">=u","c",65],["<u","c",91],0],["return",1],0],["if",["if",[">=u","c",97],["<u","c",123],0],["return",1],0],[">=u","c",128]],"kind":"defn","name":"ext.xml._is_name_start","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["if",["if",["if",["=","c",32],1,["=","c",9]],1,["=","c",10]],1,["=","c",13]],"kind":"defn","name":"ext.xml._is_ws","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",0]],["set","out",["ext.xml._push_u32_le","out","code"]],["set","out",["ext.xml._push_u32_le","out",0]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._make_error_code","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["=",["<u","start","end"],0],["return",["-",0,1]],0],["let","first",["view.get_u8","src","start"]],["if",["=",["ext.xml._is_name_start","first"],0],["return",["-",0,1]],0],["let","i",["+","start",1]],["let","done",0],["for","_",0,["-","end","start"],["if",["=","done",0],["if",["=",["<u","i","end"],0],["set","done",1],["begin",["let","c",["view.get_u8","src","i"]],["if",["ext.xml._is_name_char","c"],["set","i",["+","i",1]],["set","done",1]]]],0]],"i"],"kind":"defn","name":"ext.xml._parse_name_end","params":[{"name":"src","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"end","ty":"i32"}],"result":"i32"},{"body":["begin",["let","o","out"],["set","o",["vec_u8.push","o",["&","val",255]]],["set","o",["vec_u8.push","o",["&",[">>u","val",8],255]]],["set","o",["vec_u8.push","o",["&",[">>u","val",16],255]]],["set","o",["vec_u8.push","o",["&",[">>u","val",24],255]]],"o"],"kind":"defn","name":"ext.xml._push_u32_le","params":[{"name":"out","ty":"vec_u8"},{"name":"val","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","o","out"],["if",["<u","cp",128],["return",["vec_u8.push","o","cp"]],0],["if",["<u","cp",2048],["begin",["set","o",["vec_u8.push","o",["|",192,[">>u","cp",6]]]],["set","o",["vec_u8.push","o",["|",128,["&","cp",63]]]],["return","o"]],0],["if",["<u","cp",65536],["begin",["set","o",["vec_u8.push","o",["|",224,[">>u","cp",12]]]],["set","o",["vec_u8.push","o",["|",128,["&",[">>u","cp",6],63]]]],["set","o",["vec_u8.push","o",["|",128,["&","cp",63]]]],["return","o"]],0],["if",["<u","cp",1114112],["begin",["set","o",["vec_u8.push","o",["|",240,[">>u","cp",18]]]],["set","o",["vec_u8.push","o",["|",128,["&",[">>u","cp",12],63]]]],["set","o",["vec_u8.push","o",["|",128,["&",[">>u","cp",6],63]]]],["set","o",["vec_u8.push","o",["|",128,["&","cp",63]]]],["return","o"]],0],"o"],"kind":"defn","name":"ext.xml._push_utf8","params":[{"name":"out","ty":"vec_u8"},{"name":"cp","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","b0",["view.get_u8","b","offset"]],["let","b1",["view.get_u8","b",["+","offset",1]]],["let","b2",["view.get_u8","b",["+","offset",2]]],["let","b3",["view.get_u8","b",["+","offset",3]]],["+",["+",["+","b0",["<<u","b1",8]],["<<u","b2",16]],["<<u","b3",24]]],"kind":"defn","name":"ext.xml._read_u32_le","params":[{"name":"b","ty":"bytes_view"},{"name":"offset","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",1]],["set","out",["vec_u8.push","out",0]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._res_err0","params":[],"result":"bytes"},{"body":["begin",["let","i",["ext.xml._skip_ws","src","start","n"]],["if",[">=u","i","n"],["return",["ext.xml._make_error_code",4]],0],["let","t",["view.get_u8","src","i"]],["if",["if",["=","t",62],1,["=","t",47]],["begin",["let","out",["vec_u8.with_capacity",6]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","i"]],["set","out",["vec_u8.push","out",0]],["return",["vec_u8.into_bytes","out"]]],0],["let","key_start_src","i"],["let","key_end_src",["ext.xml._parse_name_end","src","key_start_src","n"]],["if",["<","key_end_src",0],["return",["ext.xml._make_error_code",8]],0],["let","key_len",["-","key_end_src","key_start_src"]],["set","i",["ext.xml._skip_ws","src","key_end_src","n"]],["if",[">=u","i","n"],["return",["ext.xml._make_error_code",4]],0],["if",["=",["=",["view.get_u8","src","i"],61],0],["return",["ext.xml._make_error_code",2]],0],["set","i",["ext.xml._skip_ws","src",["+","i",1],"n"]],["if",[">=u","i","n"],["return",["ext.xml._make_error_code",4]],0],["let","q",["view.get_u8","src","i"]],["if",["=",["if",["=","q",34],1,["=","q",39]],0],["return",["ext.xml._make_error_code",2]],0],["let","val_start_src",["+","i",1]],["let","val_end_src",["ext.xml._find_byte","src","val_start_src","n","q"]],["if",["<","val_end_src",0],["return",["ext.xml._make_error_code",4]],0],["let","decoded",["ext.xml._decode_entities_status","src","val_start_src","val_end_src"]],["let","dv",["bytes.view","decoded"]],["if",["<",["view.len","dv"],1],["return",["ext.xml._make_error_code",6]],0],["if",["=",["=",["view.get_u8","dv",0],1],0],["return",["ext.xml._make_error_code",6]],0],["let","val_len",["-",["view.len","dv"],1]],["let","new_pos",["+","val_end_src",1]],["let","out",["vec_u8.with_capacity",["+",["+",14,"key_len"],"val_len"]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","new_pos"]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","key_len"]],["set","out",["vec_u8.extend_bytes_range","out","src","key_start_src","key_len"]],["set","out",["ext.xml._push_u32_le","out","val_len"]],["if",[">","val_len",0],["set","out",["vec_u8.extend_bytes_range","out","dv",1,"val_len"]],0],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._scan_attr_or_end","params":[{"name":"src","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"n","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","i",["+","pos",1]],["set","i",["ext.xml._skip_ws","src","i","n"]],["let","name_start_src","i"],["let","name_end_src",["ext.xml._parse_name_end","src","name_start_src","n"]],["if",["<","name_end_src",0],["return",["ext.xml._make_error_code",8]],0],["let","name_len",["-","name_end_src","name_start_src"]],["set","i","name_end_src"],["let","attrs_blob",["vec_u8.with_capacity",0]],["let","attr_count",0],["let","done_attrs",0],["for","_",0,["+",["-","n","i"],1],["if",["=","done_attrs",0],["begin",["let","step_b",["ext.xml._scan_attr_or_end","src","i","n"]],["if",["<",["view.len",["bytes.view","step_b"]],1],["return",["ext.xml._make_error_code",2]],0],["if",["=",["view.get_u8",["bytes.view","step_b"],0],0],["return","step_b"],0],["let","step_v",["bytes.view","step_b"]],["if",["<",["view.len","step_v"],6],["return",["ext.xml._make_error_code",2]],0],["let","new_i",["ext.xml._read_u32_le","step_v",1]],["let","kind",["view.get_u8","step_v",5]],["if",["=","kind",0],["begin",["set","i","new_i"],["set","done_attrs",1]],["if",["=","kind",1],["begin",["if",["<",["view.len","step_v"],10],["return",["ext.xml._make_error_code",2]],0],["let","key_len",["ext.xml._read_u32_le","step_v",6]],["let","key_off",10],["if",["<","key_len",0],["return",["ext.xml._make_error_code",2]],0],["if",[">=u",["+","key_off","key_len"],["+",["view.len","step_v"],1]],["return",["ext.xml._make_error_code",2]],0],["let","val_len_off",["+","key_off","key_len"]],["if",[">=u",["+","val_len_off",4],["+",["view.len","step_v"],1]],["return",["ext.xml._make_error_code",2]],0],["let","val_len",["ext.xml._read_u32_le","step_v","val_len_off"]],["let","val_off",["+","val_len_off",4]],["if",["<","val_len",0],["return",["ext.xml._make_error_code",2]],0],["if",[">=u",["+","val_off","val_len"],["+",["view.len","step_v"],1]],["return",["ext.xml._make_error_code",2]],0],["set","attrs_blob",["ext.xml._push_u32_le","attrs_blob","key_len"]],["if",[">","key_len",0],["set","attrs_blob",["vec_u8.extend_bytes_range","attrs_blob","step_v","key_off","key_len"]],0],["set","attrs_blob",["ext.xml._push_u32_le","attrs_blob","val_len"]],["if",[">","val_len",0],["set","attrs_blob",["vec_u8.extend_bytes_range","attrs_blob","step_v","val_off","val_len"]],0],["set","attr_count",["+","attr_count",1]],["set","i","new_i"]],["return",["ext.xml._make_error_code",2]]]]],0]],["set","i",["ext.xml._skip_ws","src","i","n"]],["if",[">=u","i","n"],["return",["ext.xml._make_error_code",4]],0],["let","self_closing",0],["if",["=",["view.get_u8","src","i"],47],["begin",["if",[">=u",["+","i",1],"n"],["return",["ext.xml._make_error_code",4]],0],["if",["=",["=",["view.get_u8","src",["+","i",1]],62],0],["return",["ext.xml._make_error_code",2]],0],["set","self_closing",1],["set","i",["+","i",2]]],["if",["=",["view.get_u8","src","i"],62],["set","i",["+","i",1]],["return",["ext.xml._make_error_code",2]]]],["let","attrs_v",["vec_u8.as_view","attrs_blob"]],["let","out",["vec_u8.with_capacity",["+",["+",14,"name_len"],["view.len","attrs_v"]]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","i"]],["set","out",["vec_u8.push","out",["if","self_closing",1,0]]],["set","out",["ext.xml._push_u32_le","out","name_len"]],["if",[">","name_len",0],["set","out",["vec_u8.extend_bytes_range","out","src","name_start_src","name_len"]],0],["set","out",["ext.xml._push_u32_le","out","attr_count"]],["set","out",["vec_u8.extend_bytes_range","out","attrs_v",0,["view.len","attrs_v"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._scan_start_tag_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","i",["+","pos",4]],["let","found",0],["let","done",0],["for","_",0,["-","n","pos"],["if",["=","done",0],["if",[">=u",["+","i",2],"n"],["set","done",1],["if",["if",["if",["=",["view.get_u8","src","i"],45],["=",["view.get_u8","src",["+","i",1]],45],0],["=",["view.get_u8","src",["+","i",2]],62],0],["begin",["set","found",1],["set","done",1]],["set","i",["+","i",1]]]],0]],["if","found",["+","i",3],["-",0,1]]],"kind":"defn","name":"ext.xml._skip_comment_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"}],"result":"i32"},{"body":["begin",["let","i",["+","pos",2]],["let","found",0],["let","done",0],["for","_",0,["-","n","pos"],["if",["=","done",0],["if",[">=u",["+","i",1],"n"],["set","done",1],["if",["if",["=",["view.get_u8","src","i"],63],["=",["view.get_u8","src",["+","i",1]],62],0],["begin",["set","found",1],["set","done",1]],["set","i",["+","i",1]]]],0]],["if","found",["+","i",2],["-",0,1]]],"kind":"defn","name":"ext.xml._skip_pi_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"}],"result":"i32"},{"body":["begin",["let","i","start"],["let","done",0],["for","_",0,["+",["-","end","start"],1],["if",["=","done",0],["if",["=",["<u","i","end"],0],["set","done",1],["begin",["let","c",["view.get_u8","src","i"]],["if",["ext.xml._is_ws","c"],["set","i",["+","i",1]],["set","done",1]]]],0]],"i"],"kind":"defn","name":"ext.xml._skip_ws","params":[{"name":"src","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"end","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["if",["<","start",0],1,["<","len",0]],["return",["ext.xml._empty_bytes"]],0],["let","abs",["+","strings_start","start"]],["if",[">=u","abs",["view.len","doc"]],["return",["ext.xml._empty_bytes"]],0],["if",[">=u",["+","abs","len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["view.to_bytes",["view.slice","doc","abs","len"]]],"kind":"defn","name":"ext.xml._slice_from_strings","params":[{"name":"doc","ty":"bytes_view"},{"name":"strings_start","ty":"i32"},{"name":"start","ty":"i32"},{"name":"len","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["=","depth",0],["return",["ext.xml._make_error_code",2]],0],["if",[">=u",["+","pos",8],"n"],["return",["ext.xml._make_error_code",4]],0],["if",["=",["if",["if",["if",["if",["if",["=",["view.get_u8","src",["+","pos",3]],67],["=",["view.get_u8","src",["+","pos",4]],68],0],["=",["view.get_u8","src",["+","pos",5]],65],0],["=",["view.get_u8","src",["+","pos",6]],84],0],["=",["view.get_u8","src",["+","pos",7]],65],0],["=",["view.get_u8","src",["+","pos",8]],91],0],0],["return",["ext.xml._make_error_code",2]],0],["let","content_start",["+","pos",9]],["let","content_end",["ext.xml._find_cdata_close_or_err","src","content_start","n"]],["if",["<","content_end",0],["return",["ext.xml._make_error_code",4]],0],["let","text_len",["-","content_end","content_start"]],["let","new_pos",["+","content_end",3]],["if",["<=","text_len",0],["return",["ext.xml._step_ok","new_pos",0,0,["vec_u8.with_capacity",0]]],0],["let","payload",["vec_u8.with_capacity",["+",5,"text_len"]]],["set","payload",["vec_u8.push","payload",3]],["set","payload",["ext.xml._push_u32_le","payload","text_len"]],["set","payload",["vec_u8.extend_bytes_range","payload","src","content_start","text_len"]],["ext.xml._step_ok","new_pos",0,1,"payload"]],"kind":"defn","name":"ext.xml._step_cdata_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"},{"name":"depth","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","new_pos",["ext.xml._skip_comment_or_err","src","pos","n"]],["if",["<","new_pos",0],["return",["ext.xml._make_error_code",4]],0],["ext.xml._step_ok","new_pos",0,0,["vec_u8.with_capacity",0]]],"kind":"defn","name":"ext.xml._step_comment_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["=","depth",0],["return",["ext.xml._make_error_code",3]],0],["let","i",["+","pos",2]],["set","i",["ext.xml._skip_ws","src","i","n"]],["let","name_start_src","i"],["let","name_end",["ext.xml._parse_name_end","src","name_start_src","n"]],["if",["<","name_end",0],["return",["ext.xml._make_error_code",8]],0],["let","name_len",["-","name_end","name_start_src"]],["set","i",["ext.xml._skip_ws","src","name_end","n"]],["if",[">=u","i","n"],["return",["ext.xml._make_error_code",4]],0],["if",["=",["=",["view.get_u8","src","i"],62],0],["return",["ext.xml._make_error_code",2]],0],["let","new_pos",["+","i",1]],["let","payload",["vec_u8.with_capacity",["+",5,"name_len"]]],["set","payload",["vec_u8.push","payload",2]],["set","payload",["ext.xml._push_u32_le","payload","name_len"]],["if",[">","name_len",0],["set","payload",["vec_u8.extend_bytes_range","payload","src","name_start_src","name_len"]],0],["ext.xml._step_ok","new_pos",["-",0,1],1,"payload"]],"kind":"defn","name":"ext.xml._step_end_tag_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"},{"name":"depth","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","pv",["vec_u8.as_view","payload"]],["let","out",["vec_u8.with_capacity",["+",13,["view.len","pv"]]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","new_pos"]],["set","out",["ext.xml._push_u32_le","out","depth_delta"]],["set","out",["ext.xml._push_u32_le","out","event_count_delta"]],["set","out",["vec_u8.extend_bytes_range","out","pv",0,["view.len","pv"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._step_ok","params":[{"name":"new_pos","ty":"i32"},{"name":"depth_delta","ty":"i32"},{"name":"event_count_delta","ty":"i32"},{"name":"payload","ty":"vec_u8"}],"result":"bytes"},{"body":["begin",["let","new_pos",["ext.xml._skip_pi_or_err","src","pos","n"]],["if",["<","new_pos",0],["return",["ext.xml._make_error_code",4]],0],["ext.xml._step_ok","new_pos",0,0,["vec_u8.with_capacity",0]]],"kind":"defn","name":"ext.xml._step_pi_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","scanned_b",["ext.xml._scan_start_tag_or_err","src","pos","n"]],["if",["<",["view.len",["bytes.view","scanned_b"]],1],["return",["ext.xml._make_error_code",2]],0],["if",["=",["view.get_u8",["bytes.view","scanned_b"],0],0],["return","scanned_b"],0],["let","scanned_v",["bytes.view","scanned_b"]],["if",["<",["view.len","scanned_v"],14],["return",["ext.xml._make_error_code",2]],0],["let","new_pos",["ext.xml._read_u32_le","scanned_v",1]],["let","self_closing",["view.get_u8","scanned_v",5]],["let","name_len",["ext.xml._read_u32_le","scanned_v",6]],["if",["<","name_len",0],["return",["ext.xml._make_error_code",2]],0],["let","name_off",10],["if",[">=u",["+","name_off","name_len"],["+",["view.len","scanned_v"],1]],["return",["ext.xml._make_error_code",2]],0],["let","attr_count_off",["+","name_off","name_len"]],["if",[">=u",["+","attr_count_off",4],["+",["view.len","scanned_v"],1]],["return",["ext.xml._make_error_code",2]],0],["let","attr_count",["ext.xml._read_u32_le","scanned_v","attr_count_off"]],["if",["<","attr_count",0],["return",["ext.xml._make_error_code",2]],0],["let","attrs_off",["+","attr_count_off",4]],["let","attrs_len",["-",["view.len","scanned_v"],"attrs_off"]],["if",["<","attrs_len",0],["return",["ext.xml._make_error_code",2]],0],["let","payload",["vec_u8.with_capacity",["+",["+",["+",["+",["+",5,"name_len"],4],"attrs_len"],5],"name_len"]]],["set","payload",["vec_u8.push","payload",1]],["set","payload",["ext.xml._push_u32_le","payload","name_len"]],["if",[">","name_len",0],["set","payload",["vec_u8.extend_bytes_range","payload","scanned_v","name_off","name_len"]],0],["set","payload",["ext.xml._push_u32_le","payload","attr_count"]],["if",[">","attrs_len",0],["set","payload",["vec_u8.extend_bytes_range","payload","scanned_v","attrs_off","attrs_len"]],0],["let","depth_delta",1],["let","count_delta",1],["if",["=","self_closing",1],["begin",["set","payload",["vec_u8.push","payload",2]],["set","payload",["ext.xml._push_u32_le","payload","name_len"]],["if",[">","name_len",0],["set","payload",["vec_u8.extend_bytes_range","payload","scanned_v","name_off","name_len"]],0],["set","depth_delta",0],["set","count_delta",2]],0],["ext.xml._step_ok","new_pos","depth_delta","count_delta","payload"]],"kind":"defn","name":"ext.xml._step_start_tag_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","end",["ext.xml._find_lt","src","pos","n"]],["if",["=","depth",0],["begin",["if",["=",["ext.xml._is_all_ws","src","pos","end"],0],["return",["ext.xml._make_error_code",2]],0],["return",["ext.xml._step_ok","end",0,0,["vec_u8.with_capacity",0]]]],0],["let","decoded",["ext.xml._decode_entities_status","src","pos","end"]],["let","dv",["bytes.view","decoded"]],["if",["<",["view.len","dv"],1],["return",["ext.xml._make_error_code",6]],0],["if",["=",["=",["view.get_u8","dv",0],1],0],["return",["ext.xml._make_error_code",6]],0],["let","text_len",["-",["view.len","dv"],1]],["if",["<=","text_len",0],["return",["ext.xml._step_ok","end",0,0,["vec_u8.with_capacity",0]]],0],["let","payload",["vec_u8.with_capacity",["+",5,"text_len"]]],["set","payload",["vec_u8.push","payload",3]],["set","payload",["ext.xml._push_u32_le","payload","text_len"]],["set","payload",["vec_u8.extend_bytes_range","payload","dv",1,"text_len"]],["ext.xml._step_ok","end",0,1,"payload"]],"kind":"defn","name":"ext.xml._step_text_or_err","params":[{"name":"src","ty":"bytes_view"},{"name":"pos","ty":"i32"},{"name":"n","ty":"i32"},{"name":"depth","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","strings_start",["ext.xml._tree_strings_start","doc"]],["if",["<","strings_start",0],["return",["-",0,1]],0],["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["-",0,1]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",1],0],["return",["-",0,1]],0],["let","attr_bytes_start",["ext.xml._read_u32_le","doc",["+","off",16]]],["let","attr_count",["ext.xml._read_u32_le","doc",["+","off",20]]],["let","start",["+","strings_start","attr_bytes_start"]],["ext.xml._attr_entry_off","doc","start","attr_count","attr_idx"]],"kind":"defn","name":"ext.xml._tree_attr_entry_off","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"},{"name":"attr_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","strings_start",["ext.xml._tree_strings_start","doc"]],["if",["<","strings_start",0],["return",["-",0,1]],0],["let","strings_len",["ext.xml._tree_header_strings_len","doc"]],["let","attrs_count",["ext.xml._tree_header_attrs_count","doc"]],["if",["if",["<","strings_len",0],1,["<","attrs_count",0]],["return",["-",0,1]],0],["+","strings_start","strings_len"]],"kind":"defn","name":"ext.xml._tree_attrs_start","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["if",["if",["<","event_count",0],1,["<","node_total",0]],1,["<","children_total",0]],["return",["ext.xml._make_error_code",2]],0],["let","nodes_b",["bytes.alloc",["*","node_total",40]]],["let","children_b",["bytes.alloc",["*","children_total",4]]],["let","child_write",0],["let","stack",["vec_u8.with_capacity",0]],["let","stack_top",["-",0,1]],["let","stack_frames",0],["let","depth",0],["let","node_idx",0],["let","root_idx",["-",0,1]],["let","off",["ext.xml._events_payload_start"]],["let","i",0],["for","_",0,"event_count",["if",["<u","i","event_count"],["begin",["if",["<","off",0],["return",["ext.xml._make_error_code",2]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=","kind",1],["begin",["if",[">=u",["+","off",5],["+",["view.len","doc"],1]],["return",["ext.xml._make_error_code",2]],0],["let","name_len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","name_len",0],["return",["ext.xml._make_error_code",2]],0],["let","name_off",["+","off",5]],["if",[">=u",["+","name_off","name_len"],["+",["view.len","doc"],1]],["return",["ext.xml._make_error_code",2]],0],["let","p",["+","name_off","name_len"]],["if",[">=u",["+","p",4],["+",["view.len","doc"],1]],["return",["ext.xml._make_error_code",2]],0],["let","attr_count",["ext.xml._read_u32_le","doc","p"]],["if",["<","attr_count",0],["return",["ext.xml._make_error_code",2]],0],["set","p",["+","p",4]],["let","attr_bytes_start",["-","p",["ext.xml._events_payload_start"]]],["let","parent",["if",["<","stack_top",0],["-",0,1],["begin",["let","stack_v",["vec_u8.as_view","stack"]],["ext.xml._read_u32_le","stack_v",["+",["*","stack_top",8],4]]]]],["if",["<","parent",0],["if",["<","root_idx",0],["set","root_idx","node_idx"],["return",["ext.xml._make_error_code",2]]],["begin",["set","children_b",["ext.xml._write_u32_le_at_bytes","children_b",["*","child_write",4],"node_idx"]],["set","child_write",["+","child_write",1]],["set","nodes_b",["ext.xml._tree_inc_child_count","nodes_b","parent"]]]],["let","name_start","off"],["let","child_start_idx","child_write"],["set","nodes_b",["ext.xml._tree_write_elem_node","nodes_b","node_idx","parent","name_start","name_len","attr_bytes_start","attr_count","child_start_idx"]],["set","stack",["ext.xml._push_u32_le","stack","stack_top"]],["set","stack",["ext.xml._push_u32_le","stack","node_idx"]],["set","stack_top","stack_frames"],["set","stack_frames",["+","stack_frames",1]],["set","depth",["+","depth",1]],["set","node_idx",["+","node_idx",1]]],["if",["=","kind",2],["begin",["if",["=","depth",0],["return",["ext.xml._make_error_code",3]],0],["if",["<","stack_top",0],["return",["ext.xml._make_error_code",3]],0],["let","stack_v",["vec_u8.as_view","stack"]],["set","stack_top",["ext.xml._read_u32_le","stack_v",["*","stack_top",8]]],["set","depth",["-","depth",1]]],["if",["=","kind",3],["begin",["if",["=","depth",0],["return",["ext.xml._make_error_code",2]],0],["if",[">=u",["+","off",5],["+",["view.len","doc"],1]],["return",["ext.xml._make_error_code",2]],0],["let","text_len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","text_len",0],["return",["ext.xml._make_error_code",2]],0],["let","text_off",["+","off",5]],["if",[">=u",["+","text_off","text_len"],["+",["view.len","doc"],1]],["return",["ext.xml._make_error_code",2]],0],["if",["<","stack_top",0],["return",["ext.xml._make_error_code",2]],0],["let","parent",["ext.xml._read_u32_le",["vec_u8.as_view","stack"],["+",["*","stack_top",8],4]]],["set","children_b",["ext.xml._write_u32_le_at_bytes","children_b",["*","child_write",4],"node_idx"]],["set","child_write",["+","child_write",1]],["set","nodes_b",["ext.xml._tree_inc_child_count","nodes_b","parent"]],["let","text_start","off"],["set","nodes_b",["ext.xml._tree_write_text_node","nodes_b","node_idx","parent","text_start","text_len"]],["set","node_idx",["+","node_idx",1]]],["return",["ext.xml._make_error_code",2]]]]],["set","off",["ext.xml._events_skip_one","doc","off"]],["set","i",["+","i",1]]],0]],["if",["=",["=","depth",0],0],["return",["ext.xml._make_error_code",4]],0],["if",["<","root_idx",0],["return",["ext.xml._make_error_code",1]],0],["if",["=",["=","node_idx","node_total"],0],["return",["ext.xml._make_error_code",2]],0],["if",["=",["=","child_write","children_total"],0],["return",["ext.xml._make_error_code",2]],0],["let","nodes_v",["bytes.view","nodes_b"]],["let","children_v",["bytes.view","children_b"]],["let","payload_start",["ext.xml._events_payload_start"]],["let","strings_len",["-",["view.len","doc"],"payload_start"]],["if",["<","strings_len",0],["return",["ext.xml._make_error_code",2]],0],["let","strings_blob",["view.slice","doc","payload_start","strings_len"]],["let","attrs_count",0],["let","out",["vec_u8.with_capacity",["+",["+",["+",21,["view.len","nodes_v"]],"strings_len"],["view.len","children_v"]]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","node_total"]],["set","out",["ext.xml._push_u32_le","out","root_idx"]],["set","out",["ext.xml._push_u32_le","out","strings_len"]],["set","out",["ext.xml._push_u32_le","out","attrs_count"]],["set","out",["ext.xml._push_u32_le","out","children_total"]],["set","out",["vec_u8.extend_bytes_range","out","nodes_v",0,["view.len","nodes_v"]]],["set","out",["vec_u8.extend_bytes_range","out","strings_blob",0,"strings_len"]],["set","out",["vec_u8.extend_bytes_range","out","children_v",0,["view.len","children_v"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._tree_build_or_err","params":[{"name":"doc","ty":"bytes_view"},{"name":"event_count","ty":"i32"},{"name":"node_total","ty":"i32"},{"name":"children_total","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","attrs_start",["ext.xml._tree_attrs_start","doc"]],["if",["<","attrs_start",0],["return",["-",0,1]],0],["let","attrs_count",["ext.xml._tree_header_attrs_count","doc"]],["if",["<","attrs_count",0],["return",["-",0,1]],0],["+","attrs_start",["*","attrs_count",16]]],"kind":"defn","name":"ext.xml._tree_children_start","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<","event_count",0],["return",["ext.xml._make_error_code",2]],0],["let","node_total",0],["let","children_total",0],["let","depth0",0],["let","off0",["ext.xml._events_payload_start"]],["let","i",0],["for","_",0,"event_count",["if",["<u","i","event_count"],["begin",["if",["<","off0",0],["return",["ext.xml._make_error_code",2]],0],["let","kind",["view.get_u8","doc","off0"]],["if",["=","kind",1],["begin",["if",[">","depth0",0],["set","children_total",["+","children_total",1]],0],["set","node_total",["+","node_total",1]],["set","depth0",["+","depth0",1]]],["if",["=","kind",2],["begin",["if",["=","depth0",0],["return",["ext.xml._make_error_code",3]],0],["set","depth0",["-","depth0",1]]],["if",["=","kind",3],["begin",["if",["=","depth0",0],["return",["ext.xml._make_error_code",2]],0],["set","children_total",["+","children_total",1]],["set","node_total",["+","node_total",1]]],["return",["ext.xml._make_error_code",2]]]]],["set","off0",["ext.xml._events_skip_one","doc","off0"]],["set","i",["+","i",1]]],0]],["if",["=",["=","depth0",0],0],["return",["ext.xml._make_error_code",4]],0],["if",["=","node_total",0],["return",["ext.xml._make_error_code",1]],0],["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","node_total"]],["set","out",["ext.xml._push_u32_le","out","children_total"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml._tree_count_or_err","params":[{"name":"doc","ty":"bytes_view"},{"name":"event_count","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["<",["view.len","doc"],21],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",13]],"kind":"defn","name":"ext.xml._tree_header_attrs_count","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","doc"],21],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",17]],"kind":"defn","name":"ext.xml._tree_header_children_count","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","doc"],21],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",1]],"kind":"defn","name":"ext.xml._tree_header_node_count","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","doc"],21],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",5]],"kind":"defn","name":"ext.xml._tree_header_root","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","doc"],21],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",9]],"kind":"defn","name":"ext.xml._tree_header_strings_len","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","b","nodes_b"],["let","parent_off",["*","parent",40]],["let","prev",["ext.xml._read_u32_le",["bytes.view","b"],["+","parent_off",28]]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","parent_off",28],["+","prev",1]]],"b"],"kind":"defn","name":"ext.xml._tree_inc_child_count","params":[{"name":"nodes_b","ty":"bytes"},{"name":"parent","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","count",["ext.xml._tree_header_node_count","doc"]],["if",["<","count",0],["return",["-",0,1]],0],["if",["if",["<","node_idx",0],1,[">=","node_idx","count"]],["return",["-",0,1]],0],["+",["ext.xml._tree_nodes_start"],["*","node_idx",40]]],"kind":"defn","name":"ext.xml._tree_node_record_off","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"i32"},{"body":21,"kind":"defn","name":"ext.xml._tree_nodes_start","params":[],"result":"i32"},{"body":["begin",["let","node_count",["ext.xml._tree_header_node_count","doc"]],["let","strings_len",["ext.xml._tree_header_strings_len","doc"]],["if",["if",["<","node_count",0],1,["<","strings_len",0]],["return",["-",0,1]],0],["let","start",["+",["ext.xml._tree_nodes_start"],["*","node_count",40]]],["if",[">=u",["+","start","strings_len"],["+",["view.len","doc"],1]],["return",["-",0,1]],0],"start"],"kind":"defn","name":"ext.xml._tree_strings_start","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","b","nodes_b"],["let","off_node",["*","node_idx",40]],["set","b",["bytes.set_u8","b","off_node",1]],["set","b",["bytes.set_u8","b",["+","off_node",1],0]],["set","b",["bytes.set_u8","b",["+","off_node",2],0]],["set","b",["bytes.set_u8","b",["+","off_node",3],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",4],"parent"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",8],"name_start"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",12],"name_len"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",16],"attr_start_idx"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",20],"attr_count"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",24],"child_start_idx"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",28],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",32],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",36],0]],"b"],"kind":"defn","name":"ext.xml._tree_write_elem_node","params":[{"name":"nodes_b","ty":"bytes"},{"name":"node_idx","ty":"i32"},{"name":"parent","ty":"i32"},{"name":"name_start","ty":"i32"},{"name":"name_len","ty":"i32"},{"name":"attr_start_idx","ty":"i32"},{"name":"attr_count","ty":"i32"},{"name":"child_start_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","b","nodes_b"],["let","off_node",["*","node_idx",40]],["set","b",["bytes.set_u8","b","off_node",2]],["set","b",["bytes.set_u8","b",["+","off_node",1],0]],["set","b",["bytes.set_u8","b",["+","off_node",2],0]],["set","b",["bytes.set_u8","b",["+","off_node",3],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",4],"parent"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",8],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",12],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",16],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",20],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",24],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",28],0]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",32],"text_start"]],["set","b",["ext.xml._write_u32_le_at_bytes","b",["+","off_node",36],"text_len"]],"b"],"kind":"defn","name":"ext.xml._tree_write_text_node","params":[{"name":"nodes_b","ty":"bytes"},{"name":"node_idx","ty":"i32"},{"name":"parent","ty":"i32"},{"name":"text_start","ty":"i32"},{"name":"text_len","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["<","event_count",0],["return",2],0],["let","strings_len",["view.len","strings"]],["let","stack",["vec_u8.with_capacity",0]],["let","depth",0],["let","i",0],["for","_",0,"event_count",["if",["<u","i","event_count"],["begin",["let","rec",["*","i",28]],["if",[">=u",["+","rec",27],["view.len","events"]],["return",2],0],["let","kind",["view.get_u8","events","rec"]],["if",["=","kind",1],["begin",["let","name_start",["ext.xml._read_u32_le","events",["+","rec",4]]],["let","name_len",["ext.xml._read_u32_le","events",["+","rec",8]]],["if",["if",["<","name_start",0],1,["<","name_len",0]],["return",2],0],["if",[">=u",["+","name_start","name_len"],["+","strings_len",1]],["return",2],0],["set","stack",["ext.xml._push_u32_le","stack","name_start"]],["set","stack",["ext.xml._push_u32_le","stack","name_len"]],["set","depth",["+","depth",1]]],["if",["=","kind",2],["begin",["if",["=","depth",0],["return",3],0],["let","name_start",["ext.xml._read_u32_le","events",["+","rec",4]]],["let","name_len",["ext.xml._read_u32_le","events",["+","rec",8]]],["if",["if",["<","name_start",0],1,["<","name_len",0]],["return",2],0],["if",[">=u",["+","name_start","name_len"],["+","strings_len",1]],["return",2],0],["let","stack_v",["vec_u8.as_view","stack"]],["let","top_off",["*",["-","depth",1],8]],["let","top_start",["ext.xml._read_u32_le","stack_v","top_off"]],["let","top_len",["ext.xml._read_u32_le","stack_v",["+","top_off",4]]],["if",["=",["=","top_len","name_len"],0],["return",3],0],["if",["=",["ext.xml._eq_bytes_range","strings","name_start","strings","top_start","name_len"],0],["return",3],0],["set","depth",["-","depth",1]]],["if",["=","kind",3],0,["return",2]]]],["set","i",["+","i",1]]],0]],["if",["=",["=","depth",0],0],["return",4],0],0],"kind":"defn","name":"ext.xml._validate_events_or_code","params":[{"name":"events","ty":"bytes_view"},{"name":"event_count","ty":"i32"},{"name":"strings","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["<","event_count",0],["return",2],0],["let","n",["view.len","payload"]],["let","stack",["vec_u8.with_capacity",0]],["let","stack_top",["-",0,1]],["let","stack_frames",0],["let","depth",0],["let","off",0],["let","i",0],["for","_",0,"event_count",["if",["<u","i","event_count"],["begin",["if",[">=u","off","n"],["return",2],0],["let","kind",["view.get_u8","payload","off"]],["if",["=","kind",1],["begin",["if",[">=u",["+","off",5],["+","n",1]],["return",2],0],["let","name_len",["ext.xml._read_u32_le","payload",["+","off",1]]],["if",["<","name_len",0],["return",2],0],["let","name_off",["+","off",5]],["if",[">=u",["+","name_off","name_len"],["+","n",1]],["return",2],0],["set","stack",["ext.xml._push_u32_le","stack","stack_top"]],["set","stack",["ext.xml._push_u32_le","stack","name_off"]],["set","stack",["ext.xml._push_u32_le","stack","name_len"]],["set","stack_top","stack_frames"],["set","stack_frames",["+","stack_frames",1]],["set","depth",["+","depth",1]]],["if",["=","kind",2],["begin",["if",["=","depth",0],["return",3],0],["if",["<","stack_top",0],["return",3],0],["if",[">=u",["+","off",5],["+","n",1]],["return",2],0],["let","name_len",["ext.xml._read_u32_le","payload",["+","off",1]]],["if",["<","name_len",0],["return",2],0],["let","name_off",["+","off",5]],["if",[">=u",["+","name_off","name_len"],["+","n",1]],["return",2],0],["let","stack_v",["vec_u8.as_view","stack"]],["let","top_off",["*","stack_top",12]],["let","top_prev",["ext.xml._read_u32_le","stack_v","top_off"]],["let","top_name_off",["ext.xml._read_u32_le","stack_v",["+","top_off",4]]],["let","top_name_len",["ext.xml._read_u32_le","stack_v",["+","top_off",8]]],["if",["=",["=","top_name_len","name_len"],0],["return",3],0],["if",["=",["ext.xml._eq_bytes_range","payload","name_off","payload","top_name_off","name_len"],0],["return",3],0],["set","stack_top","top_prev"],["set","depth",["-","depth",1]]],["if",["=","kind",3],0,["return",2]]]],["set","off",["ext.xml._events_payload_skip_one","payload","off"]],["if",["<","off",0],["return",2],0],["set","i",["+","i",1]]],0]],["if",["=",["=","depth",0],0],["return",4],0],["if",["=",["=","off","n"],0],["return",2],0],0],"kind":"defn","name":"ext.xml._validate_events_payload_or_code","params":[{"name":"payload","ty":"bytes_view"},{"name":"event_count","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out","b"],["set","out",["bytes.set_u8","out","offset",["&","val",255]]],["set","out",["bytes.set_u8","out",["+","offset",1],["&",[">>u","val",8],255]]],["set","out",["bytes.set_u8","out",["+","offset",2],["&",[">>u","val",16],255]]],["set","out",["bytes.set_u8","out",["+","offset",3],["&",[">>u","val",24],255]]],"out"],"kind":"defn","name":"ext.xml._write_u32_le_at_bytes","params":[{"name":"b","ty":"bytes"},{"name":"offset","ty":"i32"},{"name":"val","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","off",["ext.xml._events_find_event_off","doc","idx"]],["if",["<","off",0],["return",["-",0,1]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",1],0],["return",["-",0,1]],0],["if",[">=u",["+","off",5],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["let","name_len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","name_len",0],["return",["-",0,1]],0],["let","p",["+","off",5]],["if",[">=u",["+","p","name_len"],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["set","p",["+","p","name_len"]],["if",[">=u",["+","p",4],["+",["view.len","doc"],1]],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc","p"]],"kind":"defn","name":"ext.xml.xml_events_attr_count","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","off",["ext.xml._events_attr_entry_off","doc","idx","attr_idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["if",[">=u",["+","off",4],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","key_len",["ext.xml._read_u32_le","doc","off"]],["if",["<","key_len",0],["return",["ext.xml._empty_bytes"]],0],["let","key_off",["+","off",4]],["if",[">=u",["+","key_off","key_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["view.to_bytes",["view.slice","doc","key_off","key_len"]]],"kind":"defn","name":"ext.xml.xml_events_attr_key","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"},{"name":"attr_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","off",["ext.xml._events_attr_entry_off","doc","idx","attr_idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["if",[">=u",["+","off",4],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","key_len",["ext.xml._read_u32_le","doc","off"]],["if",["<","key_len",0],["return",["ext.xml._empty_bytes"]],0],["let","p",["+","off",4]],["if",[">=u",["+","p","key_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["set","p",["+","p","key_len"]],["if",[">=u",["+","p",4],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","val_len",["ext.xml._read_u32_le","doc","p"]],["if",["<","val_len",0],["return",["ext.xml._empty_bytes"]],0],["let","val_off",["+","p",4]],["if",[">=u",["+","val_off","val_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["view.to_bytes",["view.slice","doc","val_off","val_len"]]],"kind":"defn","name":"ext.xml.xml_events_attr_value","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"},{"name":"attr_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["<",["view.len","doc"],1],["return",1],0],["if",["=",["view.get_u8","doc",0],0],1,0]],"kind":"defn","name":"ext.xml.xml_events_is_err","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","off",["ext.xml._events_find_event_off","doc","idx"]],["if",["<","off",0],["return",["-",0,1]],0],["view.get_u8","doc","off"]],"kind":"defn","name":"ext.xml.xml_events_kind","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["=",["ext.xml.xml_events_is_err","doc"],1],["return",["-",0,1]],0],["if",["<",["view.len","doc"],5],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",1]],"kind":"defn","name":"ext.xml.xml_events_len","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","off",["ext.xml._events_find_event_off","doc","idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["if",["=","kind",1],1,["=","kind",2]],0],["return",["ext.xml._empty_bytes"]],0],["if",[">=u",["+","off",5],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","name_len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","name_len",0],["return",["ext.xml._empty_bytes"]],0],["let","name_off",["+","off",5]],["if",[">=u",["+","name_off","name_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["view.to_bytes",["view.slice","doc","name_off","name_len"]]],"kind":"defn","name":"ext.xml.xml_events_name","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","src"]],["let","events",["vec_u8.with_capacity","n"]],["let","event_count",0],["let","depth",0],["let","seen_root",0],["let","after_root",0],["let","pos",0],["let","done",0],["for","_",0,["+","n",1],["if",["=","done",0],["if",[">=u","pos","n"],["set","done",1],["begin",["let","c",["view.get_u8","src","pos"]],["let","step_b",["if",["=","c",60],["begin",["if",[">=u",["+","pos",1],"n"],["return",["ext.xml._make_error_code",4]],0],["let","c1",["view.get_u8","src",["+","pos",1]]],["if",["=","c1",63],["ext.xml._step_pi_or_err","src","pos","n"],["if",["=","c1",33],["begin",["if",[">=u",["+","pos",2],"n"],["return",["ext.xml._make_error_code",4]],0],["let","c2",["view.get_u8","src",["+","pos",2]]],["if",["=","c2",45],["begin",["if",[">=u",["+","pos",3],"n"],["return",["ext.xml._make_error_code",4]],0],["if",["=",["=",["view.get_u8","src",["+","pos",3]],45],0],["return",["ext.xml._make_error_code",2]],0],["ext.xml._step_comment_or_err","src","pos","n"]],["if",["=","c2",91],["ext.xml._step_cdata_or_err","src","pos","n","depth"],["begin",["if",[">=u",["+","pos",8],"n"],["return",["ext.xml._make_error_code",4]],0],["if",["if",["if",["if",["if",["if",["if",["=",["view.get_u8","src",["+","pos",2]],68],["=",["view.get_u8","src",["+","pos",3]],79],0],["=",["view.get_u8","src",["+","pos",4]],67],0],["=",["view.get_u8","src",["+","pos",5]],84],0],["=",["view.get_u8","src",["+","pos",6]],89],0],["=",["view.get_u8","src",["+","pos",7]],80],0],["=",["view.get_u8","src",["+","pos",8]],69],0],["return",["ext.xml._make_error_code",5]],0],["return",["ext.xml._make_error_code",2]]]]]],["if",["=","c1",47],["ext.xml._step_end_tag_or_err","src","pos","n","depth"],["begin",["if",["=","depth",0],["begin",["if",["if","after_root",1,"seen_root"],["return",["ext.xml._make_error_code",2]],0],["set","seen_root",1]],0],["ext.xml._step_start_tag_or_err","src","pos","n"]]]]]],["ext.xml._step_text_or_err","src","pos","n","depth"]]],["if",["<",["view.len",["bytes.view","step_b"]],1],["return",["ext.xml._make_error_code",2]],0],["if",["=",["view.get_u8",["bytes.view","step_b"],0],0],["return","step_b"],0],["let","step_v",["bytes.view","step_b"]],["if",["<",["view.len","step_v"],13],["return",["ext.xml._make_error_code",2]],0],["let","new_pos",["ext.xml._read_u32_le","step_v",1]],["let","depth_delta",["ext.xml._read_u32_le","step_v",5]],["let","count_delta",["ext.xml._read_u32_le","step_v",9]],["let","payload_off",13],["let","payload_len",["-",["view.len","step_v"],"payload_off"]],["if",[">","payload_len",0],["set","events",["vec_u8.extend_bytes_range","events","step_v","payload_off","payload_len"]],0],["set","event_count",["+","event_count","count_delta"]],["set","depth",["+","depth","depth_delta"]],["set","pos","new_pos"],["if",["if","seen_root",["=","depth",0],0],["set","after_root",1],0]]],0]],["if",["=",["=","depth",0],0],["return",["ext.xml._make_error_code",4]],0],["if",["=","seen_root",0],["return",["ext.xml._make_error_code",1]],0],["let","validate_code",["ext.xml._validate_events_payload_or_code",["vec_u8.as_view","events"],"event_count"]],["if",["=",["=","validate_code",0],0],["return",["ext.xml._make_error_code","validate_code"]],0],["let","events_v",["vec_u8.as_view","events"]],["let","out",["vec_u8.with_capacity",["+",5,["view.len","events_v"]]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.xml._push_u32_le","out","event_count"]],["set","out",["vec_u8.extend_bytes_range","out","events_v",0,["view.len","events_v"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.xml.xml_events_parse","params":[{"name":"src","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","off",["ext.xml._events_find_event_off","doc","idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",3],0],["return",["ext.xml._empty_bytes"]],0],["if",[">=u",["+","off",5],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","text_len",["ext.xml._read_u32_le","doc",["+","off",1]]],["if",["<","text_len",0],["return",["ext.xml._empty_bytes"]],0],["let","text_off",["+","off",5]],["if",[">=u",["+","text_off","text_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["view.to_bytes",["view.slice","doc","text_off","text_len"]]],"kind":"defn","name":"ext.xml.xml_events_text","params":[{"name":"doc","ty":"bytes_view"},{"name":"idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["-",0,1]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",1],0],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",["+","off",20]]],"kind":"defn","name":"ext.xml.xml_tree_attr_count","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","off",["ext.xml._tree_attr_entry_off","doc","node_idx","attr_idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["if",[">=u",["+","off",4],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","key_len",["ext.xml._read_u32_le","doc","off"]],["if",["<","key_len",0],["return",["ext.xml._empty_bytes"]],0],["let","key_off",["+","off",4]],["if",[">=u",["+","key_off","key_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["view.to_bytes",["view.slice","doc","key_off","key_len"]]],"kind":"defn","name":"ext.xml.xml_tree_attr_key","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"},{"name":"attr_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","off",["ext.xml._tree_attr_entry_off","doc","node_idx","attr_idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["if",[">=u",["+","off",4],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","key_len",["ext.xml._read_u32_le","doc","off"]],["if",["<","key_len",0],["return",["ext.xml._empty_bytes"]],0],["let","p",["+","off",4]],["if",[">=u",["+","p","key_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["set","p",["+","p","key_len"]],["if",[">=u",["+","p",4],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["let","val_len",["ext.xml._read_u32_le","doc","p"]],["if",["<","val_len",0],["return",["ext.xml._empty_bytes"]],0],["let","val_off",["+","p",4]],["if",[">=u",["+","val_off","val_len"],["+",["view.len","doc"],1]],["return",["ext.xml._empty_bytes"]],0],["view.to_bytes",["view.slice","doc","val_off","val_len"]]],"kind":"defn","name":"ext.xml.xml_tree_attr_value","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"},{"name":"attr_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","children_start",["ext.xml._tree_children_start","doc"]],["if",["<","children_start",0],["return",["-",0,1]],0],["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["-",0,1]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",1],0],["return",["-",0,1]],0],["let","child_start_idx",["ext.xml._read_u32_le","doc",["+","off",24]]],["let","child_count",["ext.xml._read_u32_le","doc",["+","off",28]]],["if",["if",["<","child_idx",0],1,[">=","child_idx","child_count"]],["return",["-",0,1]],0],["let","idx",["+","child_start_idx","child_idx"]],["let","children_count",["ext.xml._tree_header_children_count","doc"]],["if",["<","children_count",0],["return",["-",0,1]],0],["if",["if",["<","idx",0],1,[">=","idx","children_count"]],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",["+","children_start",["*","idx",4]]]],"kind":"defn","name":"ext.xml.xml_tree_child_at","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"},{"name":"child_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["-",0,1]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",1],0],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",["+","off",28]]],"kind":"defn","name":"ext.xml.xml_tree_child_count","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["<",["view.len","doc"],1],["return",1],0],["if",["=",["view.get_u8","doc",0],0],1,0]],"kind":"defn","name":"ext.xml.xml_tree_is_err","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["=",["ext.xml.xml_tree_is_err","doc"],1],["return",["-",0,1]],0],["ext.xml._tree_header_node_count","doc"]],"kind":"defn","name":"ext.xml.xml_tree_node_count","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["-",0,1]],0],["view.get_u8","doc","off"]],"kind":"defn","name":"ext.xml.xml_tree_node_kind","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","strings_start",["ext.xml._tree_strings_start","doc"]],["if",["<","strings_start",0],["return",["ext.xml._empty_bytes"]],0],["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",1],0],["return",["ext.xml._empty_bytes"]],0],["let","name_start",["ext.xml._read_u32_le","doc",["+","off",8]]],["let","name_len",["ext.xml._read_u32_le","doc",["+","off",12]]],["ext.xml._slice_from_strings","doc","strings_start","name_start","name_len"]],"kind":"defn","name":"ext.xml.xml_tree_node_name","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["-",0,1]],0],["ext.xml._read_u32_le","doc",["+","off",4]]],"kind":"defn","name":"ext.xml.xml_tree_node_parent","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","strings_start",["ext.xml._tree_strings_start","doc"]],["if",["<","strings_start",0],["return",["ext.xml._empty_bytes"]],0],["let","off",["ext.xml._tree_node_record_off","doc","node_idx"]],["if",["<","off",0],["return",["ext.xml._empty_bytes"]],0],["let","kind",["view.get_u8","doc","off"]],["if",["=",["=","kind",2],0],["return",["ext.xml._empty_bytes"]],0],["let","text_start",["ext.xml._read_u32_le","doc",["+","off",32]]],["let","text_len",["ext.xml._read_u32_le","doc",["+","off",36]]],["ext.xml._slice_from_strings","doc","strings_start","text_start","text_len"]],"kind":"defn","name":"ext.xml.xml_tree_node_text","params":[{"name":"doc","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","events_b",["ext.xml.xml_events_parse","src"]],["if",["=",["ext.xml.xml_events_is_err",["bytes.view","events_b"]],1],["return","events_b"],0],["let","doc",["bytes.view","events_b"]],["let","event_count",["ext.xml.xml_events_len","doc"]],["if",["<","event_count",0],["return",["ext.xml._make_error_code",2]],0],["let","counts_b",["ext.xml._tree_count_or_err","doc","event_count"]],["if",["=",["view.get_u8",["bytes.view","counts_b"],0],0],["return","counts_b"],0],["let","counts_v",["bytes.view","counts_b"]],["if",["<",["view.len","counts_v"],9],["return",["ext.xml._make_error_code",2]],0],["let","node_total",["ext.xml._read_u32_le","counts_v",1]],["let","children_total",["ext.xml._read_u32_le","counts_v",5]],["ext.xml._tree_build_or_err","doc","event_count","node_total","children_total"]],"kind":"defn","name":"ext.xml.xml_tree_parse","params":[{"name":"src","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["=",["ext.xml.xml_tree_is_err","doc"],1],["return",["-",0,1]],0],["ext.xml._tree_header_root","doc"]],"kind":"defn","name":"ext.xml.xml_tree_root","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"}],"imports":[],"kind":"module","meta":{"generated_by":"x07import","source_path":"tests/x07import/fixtures/import_sources/rust/ext_xml@0.1.0/xml.rs","source_sha256":"8a3658d54c87d4c3df5e1d605cb7ce0c04efd0c55e2f025aeddbb26dce13c084"},"module_id":"ext.xml","schema_version":"x07.x07ast@0.3.0"}
