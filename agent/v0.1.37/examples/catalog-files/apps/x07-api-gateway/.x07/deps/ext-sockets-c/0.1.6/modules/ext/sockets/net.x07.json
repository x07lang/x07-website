{"decls":[{"kind":"export","names":["ext.sockets.net.dns_lookup_v1","ext.sockets.net.tcp_accept_v1","ext.sockets.net.tcp_connect_v1","ext.sockets.net.tcp_listen_v1","ext.sockets.net.tcp_listener_close_v1","ext.sockets.net.tcp_listener_drop_v1","ext.sockets.net.tcp_stream_close_v1","ext.sockets.net.tcp_stream_drop_v1","ext.sockets.net.tcp_stream_read_v1","ext.sockets.net.tcp_stream_reader_v1","ext.sockets.net.tcp_stream_shutdown_v1","ext.sockets.net.tcp_stream_wait_v1","ext.sockets.net.tcp_stream_write_v1","ext.sockets.net.tls_connect_v1","ext.sockets.net.udp_bind_v1","ext.sockets.net.udp_close_v1","ext.sockets.net.udp_drop_v1","ext.sockets.net.udp_recv_doc_reader_v1","ext.sockets.net.udp_recvfrom_v1","ext.sockets.net.udp_sendto_v1"]},{"body":["begin",["if",["<=","h",0],["return",["ext.sockets.net._make_err_doc",8]],0],["let","actual_len",["unsafe",["ext.sockets._ffi.buf_len","h"]]],["if",["<","actual_len",0],["return",["ext.sockets.net._make_err_doc",8]],0],["let","src",["unsafe",["ext.sockets._ffi.buf_ptr","h"]]],["let","out",["bytes.alloc","actual_len"]],["begin",["let","out_v",["bytes.view","out"]],["let","dst_u8",["view.as_ptr","out_v"]],["let","dst",["unsafe",["ptr.cast","ptr_mut_void","dst_u8"]]],["let","srcv",["unsafe",["ptr.cast","ptr_const_void","src"]]],["let","_",["unsafe",["memcpy","dst","srcv","actual_len"]]],0],["unsafe",["ext.sockets._ffi.buf_free","h"]],"out"],"kind":"defn","name":"ext.sockets.net._buf_to_bytes_v1","params":[{"name":"h","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","code"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",0]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.sockets.net._make_err_doc","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.dns_lookup_alloc",["view.as_ptr","name"],["view.len","name"],"port",["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.dns_lookup_v1","params":[{"name":"name","ty":"bytes_view"},{"name":"port","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.tcp_accept_alloc","listener_handle",["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.tcp_accept_v1","params":[{"name":"listener_handle","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.tcp_connect_alloc",["view.as_ptr","addr"],["view.len","addr"],["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.tcp_connect_v1","params":[{"name":"addr","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.tcp_listen_alloc",["view.as_ptr","addr"],["view.len","addr"],["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.tcp_listen_v1","params":[{"name":"addr","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["unsafe",["ext.sockets._ffi.tcp_listener_close_v1","listener_handle"]],"kind":"defn","name":"ext.sockets.net.tcp_listener_close_v1","params":[{"name":"listener_handle","ty":"i32"}],"result":"i32"},{"body":["unsafe",["ext.sockets._ffi.tcp_listener_drop_v1","listener_handle"]],"kind":"defn","name":"ext.sockets.net.tcp_listener_drop_v1","params":[{"name":"listener_handle","ty":"i32"}],"result":"i32"},{"body":["unsafe",["ext.sockets._ffi.tcp_stream_close_v1","stream_handle"]],"kind":"defn","name":"ext.sockets.net.tcp_stream_close_v1","params":[{"name":"stream_handle","ty":"i32"}],"result":"i32"},{"body":["unsafe",["ext.sockets._ffi.tcp_stream_drop_v1","stream_handle"]],"kind":"defn","name":"ext.sockets.net.tcp_stream_drop_v1","params":[{"name":"stream_handle","ty":"i32"}],"result":"i32"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.tcp_stream_read_alloc","stream_handle","max_bytes",["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.tcp_stream_read_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"max_bytes","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","vt",["unsafe",["ext.sockets._ffi.tcp_stream_reader_prepare_v1","stream_handle",["view.as_ptr","caps"],["view.len","caps"]]]],["iface.make_v1","stream_handle","vt"]],"kind":"defn","name":"ext.sockets.net.tcp_stream_reader_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"iface"},{"body":["unsafe",["ext.sockets._ffi.tcp_stream_shutdown_v1","stream_handle","how"]],"kind":"defn","name":"ext.sockets.net.tcp_stream_shutdown_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"how","ty":"i32"}],"result":"i32"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.tcp_stream_wait_alloc","stream_handle","events","timeout_ms","h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.tcp_stream_wait_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"events","ty":"i32"},{"name":"timeout_ms","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.tcp_stream_write_alloc","stream_handle",["view.as_ptr","data"],["view.len","data"],["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.tcp_stream_write_v1","params":[{"name":"stream_handle","ty":"i32"},{"name":"data","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.tls_connect_alloc",["view.as_ptr","addr"],["view.len","addr"],["view.as_ptr","tls_cfg"],["view.len","tls_cfg"],["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.tls_connect_v1","params":[{"name":"addr","ty":"bytes_view"},{"name":"tls_cfg","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.udp_bind_alloc",["view.as_ptr","addr"],["view.len","addr"],["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.udp_bind_v1","params":[{"name":"addr","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["unsafe",["ext.sockets._ffi.udp_close_v1","sock_handle"]],"kind":"defn","name":"ext.sockets.net.udp_close_v1","params":[{"name":"sock_handle","ty":"i32"}],"result":"i32"},{"body":["unsafe",["ext.sockets._ffi.udp_drop_v1","sock_handle"]],"kind":"defn","name":"ext.sockets.net.udp_drop_v1","params":[{"name":"sock_handle","ty":"i32"}],"result":"i32"},{"body":["begin",["let","vt",["unsafe",["ext.sockets._ffi.udp_recv_doc_reader_prepare_v1","sock_handle",["view.as_ptr","caps"],["view.len","caps"]]]],["iface.make_v1","sock_handle","vt"]],"kind":"defn","name":"ext.sockets.net.udp_recv_doc_reader_v1","params":[{"name":"sock_handle","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"iface"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.udp_recvfrom_alloc","sock_handle","max_bytes",["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.udp_recvfrom_v1","params":[{"name":"sock_handle","ty":"i32"},{"name":"max_bytes","ty":"i32"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","h",0],["let","h_ptr",["unsafe",["ptr.cast","ptr_mut_i32",["addr_of_mut","h"]]]],["let","ret",["unsafe",["ext.sockets._ffi.udp_sendto_alloc","sock_handle",["view.as_ptr","addr"],["view.len","addr"],["view.as_ptr","payload"],["view.len","payload"],["view.as_ptr","caps"],["view.len","caps"],"h_ptr"]]],["if",["=","ret",0],["begin",["let","bh",["unsafe",["ptr.read_i32","h_ptr"]]],["ext.sockets.net._buf_to_bytes_v1","bh"]],["ext.sockets.net._make_err_doc",8]]],"kind":"defn","name":"ext.sockets.net.udp_sendto_v1","params":[{"name":"sock_handle","ty":"i32"},{"name":"addr","ty":"bytes_view"},{"name":"payload","ty":"bytes_view"},{"name":"caps","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.sockets._ffi"],"kind":"module","module_id":"ext.sockets.net","schema_version":"x07.x07ast@0.3.0"}
