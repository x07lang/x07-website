{
  "schema_version": "x07.x07ast@0.3.0",
  "kind": "module",
  "module_id": "ext.httparse.tests",
  "imports": ["std.test", "ext.http_types", "ext.httparse"],
  "decls": [
    {
      "kind": "export",
      "names": [
        "ext.httparse.tests.test_lowercase_ascii",
        "ext.httparse.tests.test_parse_request_roundtrip",
        "ext.httparse.tests.test_parse_request_no_headers",
        "ext.httparse.tests.test_parse_response_roundtrip",
        "ext.httparse.tests.test_parse_partial_is_err",
        "ext.httparse.tests.test_parse_bad_header_is_err"
      ]
    },
    {
      "kind": "defn",
      "name": "ext.httparse.tests.test_lowercase_ascii",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "in", ["bytes.lit", "HeAdEr"]],
        ["let", "out", ["ext.http_types.lowercase_ascii", ["bytes.view", "in"]]],
        ["try", ["std.test.assert_bytes_eq", "out", ["bytes.lit", "header"], ["std.test.code_assert_bytes_eq"]]],
        ["let", "x", ["bytes.lit", "X"]],
        ["let", "y", ["bytes.lit", "y"]],
        ["let", "line", ["ext.http_types.header_line", ["bytes.view", "x"], ["bytes.view", "y"]]],
        ["let", "exp_v", ["vec_u8.with_capacity", 6]],
        ["set", "exp_v", ["vec_u8.push", "exp_v", 88]],
        ["set", "exp_v", ["vec_u8.push", "exp_v", 58]],
        ["set", "exp_v", ["vec_u8.push", "exp_v", 32]],
        ["set", "exp_v", ["vec_u8.push", "exp_v", 121]],
        ["set", "exp_v", ["vec_u8.push", "exp_v", 13]],
        ["set", "exp_v", ["vec_u8.push", "exp_v", 10]],
        ["let", "expected", ["vec_u8.into_bytes", "exp_v"]],
        ["try", ["std.test.assert_bytes_eq", "line", "expected", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.httparse.tests.test_parse_request_roundtrip",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "host_name", ["bytes.lit", "Host"]],
        ["let", "host_value", ["bytes.lit", "Example.COM"]],
        ["let", "h1", ["ext.http_types.header_line",
          ["bytes.view", "host_name"],
          ["bytes.view", "host_value"]
        ]],
        ["let", "ct_name", ["bytes.lit", "Content-Type"]],
        ["let", "ct_value", ["bytes.lit", "text/plain"]],
        ["let", "h2", ["ext.http_types.header_line",
          ["bytes.view", "ct_name"],
          ["bytes.view", "ct_value"]
        ]],
        ["let", "headers_v", ["vec_u8.with_capacity", 64]],
        ["set", "headers_v", ["vec_u8.extend_bytes", "headers_v", "h1"]],
        ["set", "headers_v", ["vec_u8.extend_bytes", "headers_v", "h2"]],
        ["let", "headers", ["vec_u8.into_bytes", "headers_v"]],
        ["let", "body", ["bytes.lit", "hello"]],
        ["let", "method", ["bytes.lit", "GET"]],
        ["let", "target", ["bytes.lit", "/path?x=1"]],
        ["let", "req", ["ext.http_types.build_request",
          ["bytes.view", "method"],
          ["bytes.view", "target"],
          ["bytes.view", "headers"],
          ["bytes.view", "body"]
        ]],
        ["let", "reqv", ["bytes.view", "req"]],
        ["let", "doc", ["ext.httparse.parse_request", "reqv"]],
        ["let", "docv", ["bytes.view", "doc"]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.is_err", "docv"], 0, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.kind", "docv"], 1, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.version", "docv", "reqv"], ["bytes.lit", "HTTP/1.1"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.method", "docv", "reqv"], ["bytes.lit", "GET"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.target", "docv", "reqv"], ["bytes.lit", "/path?x=1"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.header_count", "docv"], 2, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.header_name", "docv", "reqv", 0], ["bytes.lit", "Host"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.header_value", "docv", "reqv", 0], ["bytes.lit", "Example.COM"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.header_name", "docv", "reqv", 1], ["bytes.lit", "Content-Type"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.header_value", "docv", "reqv", 1], ["bytes.lit", "text/plain"], ["std.test.code_assert_bytes_eq"]]],
        ["let", "q_host", ["bytes.lit", "host"]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.header_get", "docv", "reqv", ["bytes.view", "q_host"]], ["bytes.lit", "Example.COM"], ["std.test.code_assert_bytes_eq"]]],
        ["let", "q_ct", ["bytes.lit", "CONTENT-TYPE"]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.header_get", "docv", "reqv", ["bytes.view", "q_ct"]], ["bytes.lit", "text/plain"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.body", "docv", "reqv"], "body", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.httparse.tests.test_parse_request_no_headers",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "headers", ["bytes.alloc", 0]],
        ["let", "body", ["bytes.lit", "hi"]],
        ["let", "method", ["bytes.lit", "GET"]],
        ["let", "target", ["bytes.lit", "/"]],
        ["let", "req", ["ext.http_types.build_request",
          ["bytes.view", "method"],
          ["bytes.view", "target"],
          ["bytes.view", "headers"],
          ["bytes.view", "body"]
        ]],
        ["let", "reqv", ["bytes.view", "req"]],
        ["let", "doc", ["ext.httparse.parse_request", "reqv"]],
        ["let", "docv", ["bytes.view", "doc"]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.is_err", "docv"], 0, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.kind", "docv"], 1, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.header_count", "docv"], 0, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.body", "docv", "reqv"], "body", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.httparse.tests.test_parse_response_roundtrip",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "ct_name", ["bytes.lit", "Content-Type"]],
        ["let", "ct_value", ["bytes.lit", "text/plain"]],
        ["let", "h1", ["ext.http_types.header_line",
          ["bytes.view", "ct_name"],
          ["bytes.view", "ct_value"]
        ]],
        ["let", "headers_v", ["vec_u8.with_capacity", 32]],
        ["set", "headers_v", ["vec_u8.extend_bytes", "headers_v", "h1"]],
        ["let", "headers", ["vec_u8.into_bytes", "headers_v"]],
        ["let", "body", ["bytes.lit", "ok"]],
        ["let", "reason", ["bytes.lit", "OK"]],
        ["let", "resp", ["ext.http_types.build_response",
          200,
          ["bytes.view", "reason"],
          ["bytes.view", "headers"],
          ["bytes.view", "body"]
        ]],
        ["let", "respv", ["bytes.view", "resp"]],
        ["let", "doc", ["ext.httparse.parse_response", "respv"]],
        ["let", "docv", ["bytes.view", "doc"]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.is_err", "docv"], 0, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.kind", "docv"], 2, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.version", "docv", "respv"], ["bytes.lit", "HTTP/1.1"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.status_code", "docv"], 200, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.reason", "docv", "respv"], ["bytes.lit", "OK"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.header_count", "docv"], 1, ["std.test.code_assert_i32_eq"]]],
        ["let", "q_ct", ["bytes.lit", "content-type"]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.header_get", "docv", "respv", ["bytes.view", "q_ct"]], ["bytes.lit", "text/plain"], ["std.test.code_assert_bytes_eq"]]],
        ["try", ["std.test.assert_bytes_eq", ["ext.httparse.body", "docv", "respv"], "body", ["std.test.code_assert_bytes_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.httparse.tests.test_parse_partial_is_err",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "v", ["vec_u8.with_capacity", 64]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.lit", "GET"]]],
        ["set", "v", ["vec_u8.push", "v", 32]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.lit", "/"]]],
        ["set", "v", ["vec_u8.push", "v", 32]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.lit", "HTTP/1.1"]]],
        ["set", "v", ["vec_u8.push", "v", 13]],
        ["set", "v", ["vec_u8.push", "v", 10]],
        ["let", "host_name", ["bytes.lit", "Host"]],
        ["let", "host_value", ["bytes.lit", "x"]],
        ["let", "h", ["ext.http_types.header_line", ["bytes.view", "host_name"], ["bytes.view", "host_value"]]],
        ["set", "v", ["vec_u8.extend_bytes", "v", "h"]],
        ["let", "req", ["vec_u8.into_bytes", "v"]],
        ["let", "doc", ["ext.httparse.parse_request", ["bytes.view", "req"]]],
        ["let", "docv", ["bytes.view", "doc"]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.is_err", "docv"], 1, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.err_code", "docv"], 1, ["std.test.code_assert_i32_eq"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "ext.httparse.tests.test_parse_bad_header_is_err",
      "params": [],
      "result": "result_i32",
      "body": ["begin",
        ["let", "v", ["vec_u8.with_capacity", 64]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.lit", "GET"]]],
        ["set", "v", ["vec_u8.push", "v", 32]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.lit", "/"]]],
        ["set", "v", ["vec_u8.push", "v", 32]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.lit", "HTTP/1.1"]]],
        ["set", "v", ["vec_u8.push", "v", 13]],
        ["set", "v", ["vec_u8.push", "v", 10]],
        ["set", "v", ["vec_u8.extend_bytes", "v", ["bytes.lit", "BadHeader"]]],
        ["set", "v", ["vec_u8.push", "v", 13]],
        ["set", "v", ["vec_u8.push", "v", 10]],
        ["set", "v", ["vec_u8.push", "v", 13]],
        ["set", "v", ["vec_u8.push", "v", 10]],
        ["let", "req", ["vec_u8.into_bytes", "v"]],
        ["let", "doc", ["ext.httparse.parse_request", ["bytes.view", "req"]]],
        ["let", "docv", ["bytes.view", "doc"]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.is_err", "docv"], 1, ["std.test.code_assert_i32_eq"]]],
        ["try", ["std.test.assert_i32_eq", ["ext.httparse.err_code", "docv"], 3, ["std.test.code_assert_i32_eq"]]],
        ["std.test.pass"]
      ]
    }
  ]
}
