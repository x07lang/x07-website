{"decls":[{"kind":"export","names":["app.extract.emit_canonical_json_v1","app.extract.extract_records_v1"]},{"body":["begin",["let","open_tag",["bytes.lit","<title>"]],["let","close_tag",["bytes.lit","</title>"]],["let","n",["view.len","html"]],["let","open_len",["view.len",["bytes.view","open_tag"]]],["let","close_len",["view.len",["bytes.view","close_tag"]]],["if",["<","n",["+","open_len","close_len"]],["return",["bytes.alloc",0]],0],["let","pos",["std.regex-lite.find_literal","html",["bytes.view","open_tag"]]],["if",["<","pos",0],["return",["bytes.alloc",0]],0],["let","start",["+","pos","open_len"]],["let","rest",["view.slice","html","start",["-","n","start"]]],["let","end_rel",["std.regex-lite.find_literal","rest",["bytes.view","close_tag"]]],["if",["<","end_rel",0],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","html","start","end_rel"]]],"kind":"defn","name":"app.extract._extract_title_v1","params":[{"name":"html","ty":"bytes_view"}],"result":"bytes"},{"body":["ext.json.canon.canonicalize","json_bytes"],"ensures":[{"expr":[">",["view.len",["bytes.view","__result"]],0],"id":"output_nonempty"}],"kind":"defn","name":"app.extract.emit_canonical_json_v1","params":[{"name":"json_bytes","ty":"bytes_view"}],"requires":[{"expr":[">",["view.len","json_bytes"],0],"id":"input_nonempty"}],"result":"bytes"},{"body":["begin",["let","title",["app.extract._extract_title_v1","html"]],["let","text",["ext.html.text_v1","html"]],["let","links",["ext.html.links_abs_v1","html","origin"]],["let","j1",["bytes.lit","{\"url\":\""]],["let","j2",["bytes.lit","\",\"title\":\""]],["let","j3",["bytes.lit","\",\"text_len\":"]],["let","j4",["bytes.lit",",\"links_count\":"]],["let","j5",["bytes.lit","}"]],["let","out",["std.vec.with_capacity",4096]],["set","out",["std.vec.extend_bytes","out",["bytes.view","j1"]]],["set","out",["std.vec.extend_bytes","out","url"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","j2"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","title"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","j3"]]],["let","tlen_b",["std.fmt.u32_to_dec",["view.len",["bytes.view","text"]]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","tlen_b"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","j4"]]],["let","link_sl",["std.text.ascii.split_lines_view",["bytes.view","links"]]],["let","link_slv",["bytes.view","link_sl"]],["let","lc",["std.text.slices.count_v1","link_slv"]],["let","lc_b",["std.fmt.u32_to_dec","lc"]],["set","out",["std.vec.extend_bytes","out",["bytes.view","lc_b"]]],["set","out",["std.vec.extend_bytes","out",["bytes.view","j5"]]],["std.vec.as_bytes","out"]],"ensures":[{"expr":[">=",["view.len",["bytes.view","__result"]],0],"id":"output_has_url"}],"kind":"defn","name":"app.extract.extract_records_v1","params":[{"name":"html","ty":"bytes_view"},{"name":"url","ty":"bytes_view"},{"name":"origin","ty":"bytes_view"}],"requires":[{"expr":[">",["view.len","html"],0],"id":"html_nonempty"}],"result":"bytes"}],"imports":["ext.html","ext.json.canon","std.bytes","std.fmt","std.regex-lite","std.text.ascii","std.text.slices","std.vec"],"kind":"module","module_id":"app.extract","schema_version":"x07.x07ast@0.5.0"}
