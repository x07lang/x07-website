{
  "schema_version": "x07.x07ast@0.3.0",
  "kind": "module",
  "module_id": "smoke",
  "imports": [
    "app",
    "std.json",
    "std.test",
    "std.vec"
  ],
  "decls": [
    {
      "kind": "export",
      "names": [
        "smoke.test_metrics_snapshot_v1",
        "smoke.test_report_ok_v1"
      ]
    },
    {
      "kind": "defn",
      "name": "smoke.assert_json_field_eq_v1",
      "params": [
        { "name": "json", "ty": "bytes_view" },
        { "name": "field", "ty": "bytes" },
        { "name": "want", "ty": "bytes" }
      ],
      "result": "result_i32",
      "body": [
        "begin",
        ["let", "qv", ["std.vec.with_capacity", ["+", ["view.len", "json"], ["+", ["bytes.len", "field"], 8]]]],
        ["set", "qv", ["std.vec.extend_bytes", "qv", "json"]],
        ["set", "qv", ["std.vec.push", "qv", 0]],
        ["set", "qv", ["std.vec.extend_bytes", "qv", ["bytes.view", "field"]]],
        ["let", "query", ["std.vec.as_bytes", "qv"]],
        ["let", "got", ["std.json.extract_path_canon_or_err", ["bytes.view", "query"]]],
        ["std.test.assert_bytes_eq", "got", "want", ["std.test.code_assert_bytes_eq"]]
      ]
    },
    {
      "kind": "defn",
      "name": "smoke.test_report_ok_v1",
      "params": [],
      "result": "result_i32",
      "body": [
        "begin",
        ["let", "empty", ["bytes.alloc", 0]],
        ["let", "out", ["app.main", ["bytes.view", "empty"]]],
        ["try", ["smoke.assert_json_field_eq_v1", ["bytes.view", "out"], ["bytes.lit", "ok"], ["bytes.lit", "1"]]],
        ["try", ["smoke.assert_json_field_eq_v1", ["bytes.view", "out"], ["bytes.lit", "kafka_ok"], ["bytes.lit", "1"]]],
        ["try", ["smoke.assert_json_field_eq_v1", ["bytes.view", "out"], ["bytes.lit", "amqp_ok"], ["bytes.lit", "1"]]],
        ["std.test.pass"]
      ]
    },
    {
      "kind": "defn",
      "name": "smoke.test_metrics_snapshot_v1",
      "params": [],
      "result": "result_i32",
      "body": [
        "begin",
        ["let", "snap", ["app.openmetrics_snapshot_v1", 1, 1]],
        ["try", ["std.test.assert_true", [">", ["bytes.len", "snap"], 0], ["std.test.code_assert_true"]]],
        ["std.test.pass"]
      ]
    }
  ]
}
