{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://x07.io/spec/x07-install.channels.schema.json",
  "title": "X07 installer channels manifest v0.1.0",
  "description": "Channel â†’ version resolution and artifact metadata for the X07 installer and x07up.",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "updated_at", "channels", "toolchains", "x07up"],
  "properties": {
    "schema_version": { "const": "x07.install.channels@0.1.0" },
    "updated_at": { "type": "string", "format": "date-time" },
    "channels": {
      "type": "object",
      "minProperties": 1,
      "properties": {
        "stable": { "$ref": "#/$defs/channel" }
      },
      "required": ["stable"],
      "additionalProperties": { "$ref": "#/$defs/channel" }
    },
    "toolchains": {
      "type": "object",
      "minProperties": 1,
      "patternProperties": {
        "^v[0-9]+\\.[0-9]+\\.[0-9]+.*$": { "$ref": "#/$defs/toolchain_release" }
      },
      "additionalProperties": false
    },
    "x07up": {
      "type": "object",
      "minProperties": 1,
      "patternProperties": {
        "^v[0-9]+\\.[0-9]+\\.[0-9]+.*$": { "$ref": "#/$defs/x07up_release" }
      },
      "additionalProperties": false
    },
    "signing": { "$ref": "#/$defs/signing" }
  },
  "$defs": {
    "sha256_hex": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$"
    },
    "artifact_format": {
      "type": "string",
      "enum": ["tar.gz", "zip", "exe", "raw"]
    },
    "artifact": {
      "type": "object",
      "additionalProperties": false,
      "required": ["url", "sha256", "format"],
      "properties": {
        "url": { "type": "string" },
        "sha256": { "$ref": "#/$defs/sha256_hex" },
        "size_bytes": { "type": "integer", "minimum": 0 },
        "format": { "$ref": "#/$defs/artifact_format" }
      }
    },
    "asset_map": {
      "type": "object",
      "minProperties": 1,
      "patternProperties": {
        "^[A-Za-z0-9_\\.-]+$": { "$ref": "#/$defs/artifact" }
      },
      "additionalProperties": false
    },
    "channel": {
      "type": "object",
      "additionalProperties": false,
      "required": ["toolchain", "x07up"],
      "properties": {
        "toolchain": { "type": "string" },
        "x07up": { "type": "string" },
        "notes": { "type": "string" }
      }
    },
    "components": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "docs": { "$ref": "#/$defs/artifact" },
        "skills": { "$ref": "#/$defs/artifact" }
      }
    },
    "toolchain_release": {
      "type": "object",
      "additionalProperties": false,
      "required": ["published_at", "assets"],
      "properties": {
        "published_at": { "type": "string", "format": "date-time" },
        "notes": { "type": "string" },
        "assets": { "$ref": "#/$defs/asset_map" },
        "components": { "$ref": "#/$defs/components" },
        "min_required": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "x07up": { "type": "string" }
          }
        }
      }
    },
    "x07up_release": {
      "type": "object",
      "additionalProperties": false,
      "required": ["published_at", "assets"],
      "properties": {
        "published_at": { "type": "string", "format": "date-time" },
        "notes": { "type": "string" },
        "assets": { "$ref": "#/$defs/asset_map" }
      }
    },
    "signing": {
      "type": "object",
      "additionalProperties": false,
      "required": ["kind", "signature_url", "public_keys"],
      "properties": {
        "kind": { "type": "string", "enum": ["minisign"] },
        "signature_url": { "type": "string" },
        "public_keys": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/public_key" }
        }
      }
    },
    "public_key": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "minisign_pub"],
      "properties": {
        "id": { "type": "string" },
        "minisign_pub": { "type": "string" }
      }
    }
  }
}

