{"decls":[{"kind":"export","names":["ext.csv.csv_get_string","ext.csv.csv_is_err","ext.csv.csv_parse"]},{"body":["begin",["let","out","row_data"],["let","fv",["vec_u8.as_view","field"]],["let","len",["view.len","fv"]],["set","out",["ext.csv._push_u32_le","out","len"]],["set","out",["vec_u8.extend_bytes_range","out","fv",0,"len"]],"out"],"kind":"defn","name":"ext.csv._emit_field","params":[{"name":"row_data","ty":"vec_u8"},{"name":"field","ty":"vec_u8"}],"result":"vec_u8"},{"body":["begin",["let","out","table"],["let","rv",["vec_u8.as_view","row_data"]],["let","len",["view.len","rv"]],["set","out",["ext.csv._push_u32_le","out","col_count"]],["set","out",["vec_u8.extend_bytes_range","out","rv",0,"len"]],"out"],"kind":"defn","name":"ext.csv._emit_row","params":[{"name":"table","ty":"vec_u8"},{"name":"row_data","ty":"vec_u8"},{"name":"col_count","ty":"i32"}],"result":"vec_u8"},{"body":["vec_u8.into_bytes",["vec_u8.with_capacity",0]],"kind":"defn","name":"ext.csv._empty_bytes","params":[],"result":"bytes"},{"body":["if",["=","c",32],1,["=","c",9]],"kind":"defn","name":"ext.csv._is_ws_after_quote","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",0]],["set","out",["ext.csv._push_u32_le","out","code"]],["set","out",["ext.csv._push_u32_le","out",0]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.csv._make_error_code","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","o","out"],["set","o",["vec_u8.push","o",["&","val",255]]],["set","o",["vec_u8.push","o",["&",[">>u","val",8],255]]],["set","o",["vec_u8.push","o",["&",[">>u","val",16],255]]],["set","o",["vec_u8.push","o",["&",[">>u","val",24],255]]],"o"],"kind":"defn","name":"ext.csv._push_u32_le","params":[{"name":"out","ty":"vec_u8"},{"name":"val","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","b0",["view.get_u8","b","offset"]],["let","b1",["view.get_u8","b",["+","offset",1]]],["let","b2",["view.get_u8","b",["+","offset",2]]],["let","b3",["view.get_u8","b",["+","offset",3]]],["+",["+",["+","b0",["<<u","b1",8]],["<<u","b2",16]],["<<u","b3",24]]],"kind":"defn","name":"ext.csv._read_u32_le","params":[{"name":"b","ty":"bytes_view"},{"name":"offset","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<","n",5],["return",["ext.csv._empty_bytes"]],0],["if",["=",["=",["view.get_u8","doc",0],1],0],["return",["ext.csv._empty_bytes"]],0],["let","row_count",["ext.csv._read_u32_le","doc",1]],["if",["if",["<","row_idx",0],1,[">=","row_idx","row_count"]],["return",["ext.csv._empty_bytes"]],0],["if",["<","col_idx",0],["return",["ext.csv._empty_bytes"]],0],["let","pos",5],["for","r",0,"row_count",["begin",["if",["=",["<u",["+","pos",4],["+","n",1]],0],["return",["ext.csv._empty_bytes"]],0],["let","col_count",["ext.csv._read_u32_le","doc","pos"]],["set","pos",["+","pos",4]],["if",["=","r","row_idx"],["begin",["if",[">=","col_idx","col_count"],["return",["ext.csv._empty_bytes"]],0],["for","c",0,"col_count",["begin",["if",["=",["<u",["+","pos",4],["+","n",1]],0],["return",["ext.csv._empty_bytes"]],0],["let","len",["ext.csv._read_u32_le","doc","pos"]],["set","pos",["+","pos",4]],["if",["=",["<u",["+","pos","len"],["+","n",1]],0],["return",["ext.csv._empty_bytes"]],0],["if",["=","c","col_idx"],["return",["view.to_bytes",["view.slice","doc","pos","len"]]],0],["set","pos",["+","pos","len"]]]],["return",["ext.csv._empty_bytes"]]],["for","_",0,"col_count",["begin",["if",["=",["<u",["+","pos",4],["+","n",1]],0],["return",["ext.csv._empty_bytes"]],0],["let","len",["ext.csv._read_u32_le","doc","pos"]],["set","pos",["+","pos",4]],["if",["=",["<u",["+","pos","len"],["+","n",1]],0],["return",["ext.csv._empty_bytes"]],0],["set","pos",["+","pos","len"]]]]]]],["ext.csv._empty_bytes"]],"kind":"defn","name":"ext.csv.csv_get_string","params":[{"name":"doc","ty":"bytes_view"},{"name":"row_idx","ty":"i32"},{"name":"col_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["if",["<",["view.len","doc"],1],["return",1],0],["if",["=",["view.get_u8","doc",0],0],1,0]],"kind":"defn","name":"ext.csv.csv_is_err","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","src"]],["let","table",["vec_u8.with_capacity",256]],["let","row_count",0],["let","row_started",0],["let","row_data",["vec_u8.with_capacity",0]],["let","col_count",0],["let","field",["vec_u8.with_capacity",0]],["let","in_quotes",0],["let","after_quote",0],["let","i",0],["let","done",0],["for","_",0,["+","n",1],["if",["=","done",0],["if",[">=u","i","n"],["begin",["set","done",1],["if","row_started",["begin",["if","in_quotes",["return",["ext.csv._make_error_code",1]],0],["set","row_data",["ext.csv._emit_field","row_data","field"]],["set","col_count",["+","col_count",1]],["set","table",["ext.csv._emit_row","table","row_data","col_count"]],["set","row_count",["+","row_count",1]]],0]],["begin",["let","c",["view.get_u8","src","i"]],["if",["=","row_started",0],["if",["=","c",10],["begin",["let","rd",["vec_u8.with_capacity",0]],["set","rd",["ext.csv._emit_field","rd",["vec_u8.with_capacity",0]]],["set","table",["ext.csv._emit_row","table","rd",1]],["set","row_count",["+","row_count",1]],["set","i",["+","i",1]],0],["if",["=","c",13],["begin",["let","advance",1],["if",["<u",["+","i",1],"n"],["if",["=",["view.get_u8","src",["+","i",1]],10],["set","advance",2],0],0],["let","rd",["vec_u8.with_capacity",0]],["set","rd",["ext.csv._emit_field","rd",["vec_u8.with_capacity",0]]],["set","table",["ext.csv._emit_row","table","rd",1]],["set","row_count",["+","row_count",1]],["set","i",["+","i","advance"]],0],["begin",["set","row_started",1],["set","row_data",["vec_u8.with_capacity",0]],["set","col_count",0],["set","field",["vec_u8.with_capacity",0]],["set","in_quotes",0],["set","after_quote",0],0]]],0],["if","row_started",["if","in_quotes",["if",["=","c",34],["if",["<u",["+","i",1],"n"],["if",["=",["view.get_u8","src",["+","i",1]],34],["begin",["set","field",["vec_u8.push","field",34]],["set","i",["+","i",2]],0],["begin",["set","in_quotes",0],["set","after_quote",1],["set","i",["+","i",1]],0]],["begin",["set","in_quotes",0],["set","after_quote",1],["set","i",["+","i",1]],0]],["begin",["set","field",["vec_u8.push","field","c"]],["set","i",["+","i",1]],0]],["if","after_quote",["if",["ext.csv._is_ws_after_quote","c"],["begin",["set","i",["+","i",1]],0],["if",["=","c",44],["begin",["set","row_data",["ext.csv._emit_field","row_data","field"]],["set","col_count",["+","col_count",1]],["set","field",["vec_u8.with_capacity",0]],["set","after_quote",0],["set","i",["+","i",1]],0],["if",["=","c",10],["begin",["set","row_data",["ext.csv._emit_field","row_data","field"]],["set","col_count",["+","col_count",1]],["set","table",["ext.csv._emit_row","table","row_data","col_count"]],["set","row_count",["+","row_count",1]],["set","row_started",0],["set","row_data",["vec_u8.with_capacity",0]],["set","col_count",0],["set","field",["vec_u8.with_capacity",0]],["set","after_quote",0],["set","i",["+","i",1]],0],["if",["=","c",13],["begin",["let","advance",1],["if",["<u",["+","i",1],"n"],["if",["=",["view.get_u8","src",["+","i",1]],10],["set","advance",2],0],0],["set","row_data",["ext.csv._emit_field","row_data","field"]],["set","col_count",["+","col_count",1]],["set","table",["ext.csv._emit_row","table","row_data","col_count"]],["set","row_count",["+","row_count",1]],["set","row_started",0],["set","row_data",["vec_u8.with_capacity",0]],["set","col_count",0],["set","field",["vec_u8.with_capacity",0]],["set","after_quote",0],["set","i",["+","i","advance"]],0],["return",["ext.csv._make_error_code",2]]]]]],["begin",["let","field_len",["view.len",["vec_u8.as_view","field"]]],["if",["if",["=","c",34],["=","field_len",0],0],["begin",["set","in_quotes",1],["set","i",["+","i",1]],0],["if",["=","c",44],["begin",["set","row_data",["ext.csv._emit_field","row_data","field"]],["set","col_count",["+","col_count",1]],["set","field",["vec_u8.with_capacity",0]],["set","i",["+","i",1]],0],["if",["=","c",10],["begin",["set","row_data",["ext.csv._emit_field","row_data","field"]],["set","col_count",["+","col_count",1]],["set","table",["ext.csv._emit_row","table","row_data","col_count"]],["set","row_count",["+","row_count",1]],["set","row_started",0],["set","row_data",["vec_u8.with_capacity",0]],["set","col_count",0],["set","field",["vec_u8.with_capacity",0]],["set","i",["+","i",1]],0],["if",["=","c",13],["begin",["let","advance",1],["if",["<u",["+","i",1],"n"],["if",["=",["view.get_u8","src",["+","i",1]],10],["set","advance",2],0],0],["set","row_data",["ext.csv._emit_field","row_data","field"]],["set","col_count",["+","col_count",1]],["set","table",["ext.csv._emit_row","table","row_data","col_count"]],["set","row_count",["+","row_count",1]],["set","row_started",0],["set","row_data",["vec_u8.with_capacity",0]],["set","col_count",0],["set","field",["vec_u8.with_capacity",0]],["set","i",["+","i","advance"]],0],["begin",["set","field",["vec_u8.push","field","c"]],["set","i",["+","i",1]],0]]]]]]]],0]]],0]],["let","table_b",["vec_u8.into_bytes","table"]],["let","table_v",["bytes.view","table_b"]],["let","table_len",["view.len","table_v"]],["let","out",["vec_u8.with_capacity",["+",5,"table_len"]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.csv._push_u32_le","out","row_count"]],["set","out",["vec_u8.extend_bytes_range","out","table_v",0,"table_len"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.csv.csv_parse","params":[{"name":"src","ty":"bytes_view"}],"result":"bytes"}],"imports":[],"kind":"module","meta":{"generated_by":"x07import","source_path":"tests/x07import/fixtures/import_sources/rust/ext_csv@0.1.0/csv.rs","source_sha256":"fd6a273c115628dae97b87e6430f53c56d89446f3c9fae6fcbaab8518efc5509"},"module_id":"ext.csv","schema_version":"x07.x07ast@0.3.0"}
