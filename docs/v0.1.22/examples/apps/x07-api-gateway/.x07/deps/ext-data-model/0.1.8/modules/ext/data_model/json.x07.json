{"decls":[{"kind":"export","names":["ext.data_model.json.emit_canon"]},{"body":["begin",["if",["=",["ext.unicode.unicode_utf8_is_valid","s"],0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_utf8"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["set","out",["vec_u8.push","out",34]],["let","n",["view.len","s"]],["for","i",0,"n",["begin",["let","c",["view.get_u8","s","i"]],["if",["=","c",34],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",34]],0],["if",["=","c",92],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",92]],0],["if",["=","c",8],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",98]],0],["if",["=","c",12],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",102]],0],["if",["=","c",10],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",110]],0],["if",["=","c",13],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",114]],0],["if",["=","c",9],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",116]],0],["if",["<u","c",32],["begin",["let","hi",[">>u","c",4]],["let","lo",["&","c",15]],["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",117]],["set","out",["vec_u8.push","out",48]],["set","out",["vec_u8.push","out",48]],["set","out",["vec_u8.push","out",["ext.data_model.json._hex_digit","hi"]]],["set","out",["vec_u8.push","out",["ext.data_model.json._hex_digit","lo"]]],0],["begin",["set","out",["vec_u8.push","out","c"]],0]]]]]]]]],0]],["set","out",["vec_u8.push","out",34]],"out"],"kind":"defn","name":"ext.data_model.json._emit_string","params":[{"name":"out","ty":"vec_u8"},{"name":"s","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","tag",["ext.data_model.kind_at","b","off"]],["if",["<","tag",0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_offset"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["if",["=","tag",0],["begin",["set","out",["vec_u8.push","out",110]],["set","out",["vec_u8.push","out",117]],["set","out",["vec_u8.push","out",108]],["set","out",["vec_u8.push","out",108]],["return","out"]],0],["if",["=","tag",1],["begin",["let","bv",["ext.data_model.bool_get","b","off"]],["if",["<","bv",0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_bool"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["if",["=","bv",0],["begin",["set","out",["vec_u8.push","out",102]],["set","out",["vec_u8.push","out",97]],["set","out",["vec_u8.push","out",108]],["set","out",["vec_u8.push","out",115]],["set","out",["vec_u8.push","out",101]],["return","out"]],["begin",["set","out",["vec_u8.push","out",116]],["set","out",["vec_u8.push","out",114]],["set","out",["vec_u8.push","out",117]],["set","out",["vec_u8.push","out",101]],["return","out"]]]],0],["if",["=","tag",2],["begin",["let","num",["ext.data_model.number_get","b","off"]],["if",["=",["bytes.len","num"],0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_number"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["set","out",["vec_u8.extend_bytes","out","num"]],["return","out"]],0],["if",["=","tag",3],["begin",["let","s",["ext.data_model.string_get","b","off"]],0,["set","out",["ext.data_model.json._emit_string","out",["bytes.view","s"]]],["if",["=",["vec_u8.get","out",0],0],["return","out"],0],["return","out"]],0],["if",["=","tag",4],["begin",["let","count",["ext.data_model.seq_len","b","off"]],["if",["<","count",0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_seq"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["set","out",["vec_u8.push","out",91]],["for","i",0,"count",["begin",["if",["=","i",0],0,["begin",["set","out",["vec_u8.push","out",44]],0]],["let","elem_off",["ext.data_model.seq_get","b","off","i"]],["if",["<","elem_off",0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_seq_elem"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["set","out",["ext.data_model.json._emit_value_into","out","b","elem_off"]],["if",["=",["vec_u8.get","out",0],0],["return","out"],0],0]],["set","out",["vec_u8.push","out",93]],["return","out"]],0],["if",["=","tag",5],["begin",["let","count",["ext.data_model.map_len","b","off"]],["if",["<","count",0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_map"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["set","out",["vec_u8.push","out",123]],["for","i",0,"count",["begin",["if",["=","i",0],0,["begin",["set","out",["vec_u8.push","out",44]],0]],["let","key",["ext.data_model.map_key_at","b","off","i"]],["if",["=",["bytes.len","key"],0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_map_key"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["set","out",["ext.data_model.json._emit_string","out",["bytes.view","key"]]],["if",["=",["vec_u8.get","out",0],0],["return","out"],0],["set","out",["vec_u8.push","out",58]],["let","val_off",["ext.data_model.map_value_at","b","off","i"]],["if",["<","val_off",0],["begin",["let","msg",["bytes.lit","data_model.json:invalid_map_value"]],["return",["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],0],["set","out",["ext.data_model.json._emit_value_into","out","b","val_off"]],["if",["=",["vec_u8.get","out",0],0],["return","out"],0],0]],["set","out",["vec_u8.push","out",125]],["return","out"]],0],["begin",["let","msg",["bytes.lit","data_model.json:unknown_kind"]],["ext.data_model.json._err_from_msg",["bytes.view","msg"]]]],"kind":"defn","name":"ext.data_model.json._emit_value_into","params":[{"name":"out","ty":"vec_u8"},{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","msg_len",["view.len","msg"]],["let","out",["vec_u8.with_capacity",["+",9,"msg_len"]]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",0]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","msg_len"]]],["set","out",["ext.data_model.json._extend_view","out","msg"]],"out"],"kind":"defn","name":"ext.data_model.json._err_from_msg","params":[{"name":"msg","ty":"bytes_view"}],"result":"vec_u8"},{"body":["ext.data_model.json._extend_view_range","out","b",0,["view.len","b"]],"kind":"defn","name":"ext.data_model.json._extend_view","params":[{"name":"out","ty":"vec_u8"},{"name":"b","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","o","out"],["let","end",["+","start","len"]],["for","i","start","end",["begin",["set","o",["vec_u8.push","o",["view.get_u8","b","i"]]],0]],"o"],"kind":"defn","name":"ext.data_model.json._extend_view_range","params":[{"name":"out","ty":"vec_u8"},{"name":"b","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"len","ty":"i32"}],"result":"vec_u8"},{"body":["if",["<u","x",10],["+",48,"x"],["+",55,"x"]],"kind":"defn","name":"ext.data_model.json._hex_digit","params":[{"name":"x","ty":"i32"}],"result":"i32"},{"body":["begin",["if",["ext.data_model.doc_is_err","doc"],["return",["view.to_bytes","doc"]],0],["let","out",["vec_u8.with_capacity",["+",16,["view.len","doc"]]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.data_model.json._emit_value_into","out","doc",1]],["if",["=",["vec_u8.get","out",0],0],["return",["std.vec.as_bytes","out"]],0],["let","doc_bytes",["std.vec.as_bytes","out"]],["let","docv",["bytes.view","doc_bytes"]],["let","jsonv",["view.slice","docv",1,["-",["view.len","docv"],1]]],["let","canon",["ext.json.canon.canonicalize","jsonv"]],["if",["=",["bytes.len","canon"],0],["begin",["let","msg",["bytes.lit","data_model.json:canon_failed"]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg"]]]],0],["ext.data_model.doc_ok",["bytes.view","canon"]]],"kind":"defn","name":"ext.data_model.json.emit_canon","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.json.canon","ext.unicode","std.vec"],"kind":"module","module_id":"ext.data_model.json","schema_version":"x07.x07ast@0.3.0"}
