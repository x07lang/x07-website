{"decls":[{"kind":"export","names":["ext.xml.data_model.parse"]},{"body":["ext.data_model.doc_err_from_msg","msg"],"kind":"defn","name":"ext.xml.data_model._err","params":[{"name":"msg","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","kind",["ext.xml.xml_tree_node_kind","tree","node_idx"]],["if",["=","kind",1],["begin",["let","name_b",["ext.xml.xml_tree_node_name","tree","node_idx"]],["let","name_val",["ext.data_model.value_string",["bytes.view","name_b"]]],["let","attr_n",["ext.xml.xml_tree_attr_count","tree","node_idx"]],["if",["<","attr_n",0],["return",["bytes.alloc",0]],0],["let","attr_entries",["vec_u8.with_capacity",64]],["set","attr_entries",["vec_u8.extend_bytes","attr_entries",["codec.write_u32_le","attr_n"]]],["for","i",0,"attr_n",["begin",["let","k",["ext.xml.xml_tree_attr_key","tree","node_idx","i"]],["let","v",["ext.xml.xml_tree_attr_value","tree","node_idx","i"]],["let","v_val",["ext.data_model.value_string",["bytes.view","v"]]],["set","attr_entries",["vec_u8.extend_bytes","attr_entries",["codec.write_u32_le",["bytes.len","k"]]]],["set","attr_entries",["vec_u8.extend_bytes","attr_entries","k"]],["set","attr_entries",["vec_u8.extend_bytes","attr_entries",["codec.write_u32_le",["bytes.len","v_val"]]]],["set","attr_entries",["vec_u8.extend_bytes","attr_entries","v_val"]],0]],["let","attr_entries_b",["vec_u8.into_bytes","attr_entries"]],["let","attrs_val",["ext.data_model.value_map_from_entries",["bytes.view","attr_entries_b"]]],["if",["=",["bytes.len","attrs_val"],0],["return",["bytes.alloc",0]],0],["let","child_n",["ext.xml.xml_tree_child_count","tree","node_idx"]],["if",["<","child_n",0],["return",["bytes.alloc",0]],0],["let","elems",["vec_u8.with_capacity",128]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","child_n"]]],["for","i",0,"child_n",["begin",["let","cidx",["ext.xml.xml_tree_child_at","tree","node_idx","i"]],["let","cval",["ext.xml.data_model._node_to_value","tree","cidx"]],["let","clen",["bytes.len","cval"]],["if",["=","clen",0],["return",["bytes.alloc",0]],0],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","clen"]]],["set","elems",["vec_u8.extend_bytes","elems","cval"]],0]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","children_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["if",["=",["bytes.len","children_val"],0],["return",["bytes.alloc",0]],0],["let","k_name",["bytes.lit","name"]],["let","k_attrs",["bytes.lit","attrs"]],["let","k_children",["bytes.lit","children"]],["let","entries",["vec_u8.with_capacity",256]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",3]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","k_name"]]]],["set","entries",["vec_u8.extend_bytes","entries","k_name"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","name_val"]]]],["set","entries",["vec_u8.extend_bytes","entries","name_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","k_attrs"]]]],["set","entries",["vec_u8.extend_bytes","entries","k_attrs"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","attrs_val"]]]],["set","entries",["vec_u8.extend_bytes","entries","attrs_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","k_children"]]]],["set","entries",["vec_u8.extend_bytes","entries","k_children"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","children_val"]]]],["set","entries",["vec_u8.extend_bytes","entries","children_val"]],["let","entries_b",["vec_u8.into_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["if",["=","kind",2],["begin",["let","t",["ext.xml.xml_tree_node_text","tree","node_idx"]],["ext.data_model.value_string",["bytes.view","t"]]],["bytes.alloc",0]]]],"kind":"defn","name":"ext.xml.data_model._node_to_value","params":[{"name":"tree","ty":"bytes_view"},{"name":"node_idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","msg_convert_failed",["bytes.lit","xml:convert_failed"]],["let","msg_no_root",["bytes.lit","xml:no_root"]],["let","msg_malformed",["bytes.lit","xml:malformed"]],["let","msg_mismatched",["bytes.lit","xml:mismatched_end_tag"]],["let","msg_eof",["bytes.lit","xml:unexpected_eof"]],["let","msg_doctype",["bytes.lit","xml:doctype_unsupported"]],["let","msg_entity",["bytes.lit","xml:entity_error"]],["let","msg_dup_attr",["bytes.lit","xml:duplicate_attribute"]],["let","msg_bad_name",["bytes.lit","xml:invalid_name"]],["let","tree",["ext.xml.xml_tree_parse","src"]],["let","treev",["bytes.view","tree"]],["if",["=",["ext.xml.xml_tree_is_err","treev"],1],["begin",["let","code",["ext.data_model.doc_error_code","treev"]],["if",["=","code",1],["return",["ext.xml.data_model._err",["bytes.view","msg_no_root"]]],0],["if",["=","code",2],["return",["ext.xml.data_model._err",["bytes.view","msg_malformed"]]],0],["if",["=","code",3],["return",["ext.xml.data_model._err",["bytes.view","msg_mismatched"]]],0],["if",["=","code",4],["return",["ext.xml.data_model._err",["bytes.view","msg_eof"]]],0],["if",["=","code",5],["return",["ext.xml.data_model._err",["bytes.view","msg_doctype"]]],0],["if",["=","code",6],["return",["ext.xml.data_model._err",["bytes.view","msg_entity"]]],0],["if",["=","code",7],["return",["ext.xml.data_model._err",["bytes.view","msg_dup_attr"]]],0],["if",["=","code",8],["return",["ext.xml.data_model._err",["bytes.view","msg_bad_name"]]],0],["return",["ext.data_model.doc_err_from_code","code"]]],0],["let","root",["ext.xml.xml_tree_root","treev"]],["if",["<","root",0],["return",["ext.xml.data_model._err",["bytes.view","msg_convert_failed"]]],0],["let","val",["ext.xml.data_model._node_to_value","treev","root"]],["if",["=",["bytes.len","val"],0],["return",["ext.xml.data_model._err",["bytes.view","msg_convert_failed"]]],0],["ext.data_model.doc_ok",["bytes.view","val"]]],"kind":"defn","name":"ext.xml.data_model.parse","params":[{"name":"src","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.xml"],"kind":"module","module_id":"ext.xml.data_model","schema_version":"x07.x07ast@0.3.0"}
