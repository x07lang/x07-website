{"decls":[{"kind":"export","names":["ext.pb.data_model.decode_descriptor_set_v2","ext.pb.data_model.decode_schema_v2","ext.pb.data_model.decode_v1","ext.pb.data_model.emit_v1","ext.pb.data_model.emit_schema_v2","ext.pb.data_model.is_err","ext.pb.data_model.err_code","ext.pb.data_model.get_bytes"]},{"body":["begin",["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","code"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",0]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.pb.data_model._make_err_doc","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","empty",["bytes.alloc",0]],["let","empty_v",["bytes.view","empty"]],["let","name_view","empty_v"],["let","label",0],["let","typ",0],["let","type_name_view","empty_v"],["let","sf_found",0],["let","sf_pos","fields_start"],["for","_sf",0,"field_count",["begin",["let","sf_no",["codec.read_u32_le","schema","sf_pos"]],["let","sf_label",["view.get_u8","schema",["+","sf_pos",4]]],["let","sf_type",["view.get_u8","schema",["+","sf_pos",5]]],["let","sf_name_len",["codec.read_u32_le","schema",["+","sf_pos",6]]],["let","sf_name_off",["+","sf_pos",10]],["let","sf_name_view",["view.slice","schema","sf_name_off","sf_name_len"]],["let","tn_len_off",["+","sf_name_off","sf_name_len"]],["let","sf_tn_len",["codec.read_u32_le","schema","tn_len_off"]],["let","sf_tn_view",["view.slice","schema",["+","tn_len_off",4],"sf_tn_len"]],["let","next_sf_pos",["+",["+","tn_len_off",4],"sf_tn_len"]],["if",["if",["=","sf_found",0],["=","sf_no","field_no"],0],["begin",["set","sf_found",1],["set","name_view","sf_name_view"],["set","label","sf_label"],["set","typ","sf_type"],["set","type_name_view","sf_tn_view"],0],0],["set","sf_pos","next_sf_pos"],0]],["let","k_name",["bytes.lit","name"]],["let","k_field",["bytes.lit","field_no"]],["let","k_wire",["bytes.lit","wire_type"]],["let","k_label",["bytes.lit","label"]],["let","k_type",["bytes.lit","type"]],["let","k_type_name",["bytes.lit","type_name"]],["let","k_value",["bytes.lit","value"]],["let","k_name_v",["bytes.view","k_name"]],["let","k_field_v",["bytes.view","k_field"]],["let","k_wire_v",["bytes.view","k_wire"]],["let","k_label_v",["bytes.view","k_label"]],["let","k_type_v",["bytes.view","k_type"]],["let","k_type_name_v",["bytes.view","k_type_name"]],["let","k_value_v",["bytes.view","k_value"]],["let","k_name_len",["view.len","k_name_v"]],["let","k_field_len",["view.len","k_field_v"]],["let","k_wire_len",["view.len","k_wire_v"]],["let","k_label_len",["view.len","k_label_v"]],["let","k_type_len",["view.len","k_type_v"]],["let","k_type_name_len",["view.len","k_type_name_v"]],["let","k_value_len",["view.len","k_value_v"]],["let","name_val",["ext.data_model.value_string","name_view"]],["let","type_name_val",["ext.data_model.value_string","type_name_view"]],["let","field_s",["std.fmt.u32_to_dec","field_no"]],["let","field_val",["ext.data_model.value_number",["bytes.view","field_s"]]],["let","wire_s",["std.fmt.u32_to_dec","wire_type"]],["let","wire_val",["ext.data_model.value_number",["bytes.view","wire_s"]]],["let","label_s",["std.fmt.u32_to_dec","label"]],["let","label_val",["ext.data_model.value_number",["bytes.view","label_s"]]],["let","type_s",["std.fmt.u32_to_dec","typ"]],["let","type_val",["ext.data_model.value_number",["bytes.view","type_s"]]],["let","value_val",["ext.data_model.value_string","val_view"]],["let","name_val_len",["bytes.len","name_val"]],["let","field_val_len",["bytes.len","field_val"]],["let","wire_val_len",["bytes.len","wire_val"]],["let","label_val_len",["bytes.len","label_val"]],["let","type_val_len",["bytes.len","type_val"]],["let","type_name_val_len",["bytes.len","type_name_val"]],["let","value_val_len",["bytes.len","value_val"]],["let","entries",["vec_u8.with_capacity",256]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",7]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_name_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_name_v",0,"k_name_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","name_val_len"]]],["set","entries",["vec_u8.extend_bytes","entries","name_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_field_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_field_v",0,"k_field_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","field_val_len"]]],["set","entries",["vec_u8.extend_bytes","entries","field_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_wire_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_wire_v",0,"k_wire_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","wire_val_len"]]],["set","entries",["vec_u8.extend_bytes","entries","wire_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_label_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_label_v",0,"k_label_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","label_val_len"]]],["set","entries",["vec_u8.extend_bytes","entries","label_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_type_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_type_v",0,"k_type_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","type_val_len"]]],["set","entries",["vec_u8.extend_bytes","entries","type_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_type_name_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_type_name_v",0,"k_type_name_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","type_name_val_len"]]],["set","entries",["vec_u8.extend_bytes","entries","type_name_val"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_value_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_value_v",0,"k_value_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","value_val_len"]]],["set","entries",["vec_u8.extend_bytes","entries","value_val"]],["let","entries_b",["vec_u8.into_bytes","entries"]],["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],"kind":"defn","name":"ext.pb.data_model._occ_map_v2","params":[{"name":"schema","ty":"bytes_view"},{"name":"fields_start","ty":"i32"},{"name":"field_count","ty":"i32"},{"name":"field_no","ty":"i32"},{"name":"wire_type","ty":"i32"},{"name":"val_view","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","sn",["view.len","schema"]],["if",["<","sn",6],["return",["ext.pb.data_model._make_err_doc",1]],0],["if",["!=",["view.get_u8","schema",0],1],["return",["ext.pb.data_model._make_err_doc",1]],0],["if",["!=",["view.get_u8","schema",1],1],["return",["ext.pb.data_model._make_err_doc",1]],0],["let","msg_defs",["codec.read_u32_le","schema",2]],["if",["<","msg_defs",0],["return",["ext.pb.data_model._make_err_doc",1]],0],["let","pos",6],["let","found",0],["let","fields_start",0],["let","field_count",0],["for","_m",0,"msg_defs",["begin",["if",[">=u",["+","pos",4],["+","sn",1]],["return",["ext.pb.data_model._make_err_doc",1]],0],["let","name_len",["codec.read_u32_le","schema","pos"]],["if",["<","name_len",0],["return",["ext.pb.data_model._make_err_doc",1]],0],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","name_len"],["+","sn",1]],["return",["ext.pb.data_model._make_err_doc",1]],0],["let","name_view",["view.slice","schema","pos","name_len"]],["set","pos",["+","pos","name_len"]],["if",[">=u",["+","pos",4],["+","sn",1]],["return",["ext.pb.data_model._make_err_doc",1]],0],["let","fc",["codec.read_u32_le","schema","pos"]],["if",["<","fc",0],["return",["ext.pb.data_model._make_err_doc",1]],0],["set","pos",["+","pos",4]],["if",["if",["=","found",0],["ext.pb.data_model._view_eq","name_view","message_name"],0],["begin",["set","found",1],["set","fields_start","pos"],["set","field_count","fc"],0],0],["for","_f",0,"fc",["begin",["if",[">=u",["+","pos",10],["+","sn",1]],["return",["ext.pb.data_model._make_err_doc",1]],0],["set","pos",["+","pos",6]],["let","fn_len",["codec.read_u32_le","schema","pos"]],["if",["<","fn_len",0],["return",["ext.pb.data_model._make_err_doc",1]],0],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","fn_len"],["+","sn",1]],["return",["ext.pb.data_model._make_err_doc",1]],0],["set","pos",["+","pos","fn_len"]],["if",[">=u",["+","pos",4],["+","sn",1]],["return",["ext.pb.data_model._make_err_doc",1]],0],["let","tn_len",["codec.read_u32_le","schema","pos"]],["if",["<","tn_len",0],["return",["ext.pb.data_model._make_err_doc",1]],0],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","tn_len"],["+","sn",1]],["return",["ext.pb.data_model._make_err_doc",1]],0],["set","pos",["+","pos","tn_len"]],0]],0]],["if",["!=","pos","sn"],["return",["ext.pb.data_model._make_err_doc",1]],0],["if",["=","found",0],["return",["ext.pb.data_model._make_err_doc",2]],0],["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","fields_start"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","field_count"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.pb.data_model._schema_message_fields_v1","params":[{"name":"schema","ty":"bytes_view"},{"name":"message_name","ty":"bytes_view"}],"result":"bytes"},{"kind":"defn","name":"ext.pb.data_model._schema_has_field_v1","params":[{"name":"schema","ty":"bytes_view"},{"name":"fields_start","ty":"i32"},{"name":"field_count","ty":"i32"},{"name":"field_no","ty":"i32"}],"result":"i32","body":["begin",["let","sn",["view.len","schema"]],["if",["<","sn",0],["return",0],0],["if",["<","fields_start",0],["return",0],0],["if",["<","field_count",0],["return",0],0],["if",[">=u","fields_start",["+","sn",1]],["return",0],0],["let","pos","fields_start"],["let","found",0],["for","_i",0,"field_count",["begin",["if",["=","found",1],0,["begin",["if",[">=u",["+","pos",10],["+","sn",1]],["return",0],0],["let","sf_no",["codec.read_u32_le","schema","pos"]],["let","name_len",["codec.read_u32_le","schema",["+","pos",6]]],["if",["<","name_len",0],["return",0],0],["let","name_off",["+","pos",10]],["let","tn_len_off",["+","name_off","name_len"]],["if",[">=u",["+","tn_len_off",4],["+","sn",1]],["return",0],0],["let","tn_len",["codec.read_u32_le","schema","tn_len_off"]],["if",["<","tn_len",0],["return",0],0],["let","next_pos",["+",["+","tn_len_off",4],"tn_len"]],["if",[">=u","next_pos",["+","sn",1]],["return",0],0],["if",["=","sf_no","field_no"],["set","found",1],0],["set","pos","next_pos"],0]],0]],"found"]},{"body":["begin",["let","n",["view.len","a"]],["if",["!=","n",["view.len","b"]],["return",0],0],["for","i",0,"n",["begin",["if",["!=",["view.get_u8","a","i"],["view.get_u8","b","i"]],["return",0],0],0]],1],"kind":"defn","name":"ext.pb.data_model._view_eq","params":[{"name":"a","ty":"bytes_view"},{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","schema_b",["ext.pb.wire.descriptor_set_to_schema_v1","desc","max_out_bytes"]],["let","schema",["bytes.view","schema_b"]],["if",["ext.pb.wire.is_err","schema"],["return",["ext.data_model.doc_err_from_code",["ext.pb.wire.err_code","schema"]]],0],["ext.pb.data_model.decode_schema_v2","msg","schema","message_name","max_out_bytes"]],"kind":"defn","name":"ext.pb.data_model.decode_descriptor_set_v2","params":[{"name":"msg","ty":"bytes_view"},{"name":"desc","ty":"bytes_view"},{"name":"message_name","ty":"bytes_view"},{"name":"max_out_bytes","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","msg_bad_schema",["bytes.lit","pb:schema:bad_schema_doc"]],["let","msg_not_found",["bytes.lit","pb:schema:message_not_found"]],["let","msg_malformed",["bytes.lit","pb:malformed_wire_doc"]],["let","msg_map_failed",["bytes.lit","pb:map_build_failed"]],["let","msg_seq_failed",["bytes.lit","pb:seq_build_failed"]],["let","info_b",["ext.pb.data_model._schema_message_fields_v1","schema","message_name"]],["let","info",["bytes.view","info_b"]],["if",["<",["view.len","info"],1],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]],0],["if",["=",["view.get_u8","info",0],0],["begin",["let","code",["ext.pb.wire.err_code","info"]],["if",["=","code",2],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_not_found"]]],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]]]],0],["let","fields_start",["codec.read_u32_le","info",1]],["let","field_count",["codec.read_u32_le","info",5]],["if",["<","fields_start",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]],0],["if",["<","field_count",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]],0],["let","raw",["ext.pb.wire.decode_v1","msg","max_out_bytes"]],["let","rawv",["bytes.view","raw"]],["if",["ext.pb.wire.is_err","rawv"],["return",["ext.data_model.doc_err_from_code",["ext.pb.wire.err_code","rawv"]]],0],["let","n",["view.len","rawv"]],["if",["<u","n",5],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed"]]],0],["let","count",["codec.read_u32_le","rawv",1]],["if",["<","count",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed"]]],0],["let","pos",5],["let","payload",["vec_u8.with_capacity",64]],["let","ok",1],["for","_",0,"count",["begin",["if",["=","ok",0],0,["begin",["if",[">=u",["+","pos",9],["+","n",1]],["set","ok",0],0],["if",["=","ok",0],0,["begin",["let","field_no",["codec.read_u32_le","rawv","pos"]],["set","pos",["+","pos",4]],["let","wire_type",["view.get_u8","rawv","pos"]],["set","pos",["+","pos",1]],["let","vlen",["codec.read_u32_le","rawv","pos"]],["set","pos",["+","pos",4]],["if",["<","vlen",0],["set","ok",0],0],["if",["=","ok",0],0,["begin",["if",[">=u",["+","pos","vlen"],["+","n",1]],["set","ok",0],0],["if",["=","ok",0],0,["begin",["let","val_view",["view.slice","rawv","pos","vlen"]],["set","pos",["+","pos","vlen"]],["let","map_val",["ext.pb.data_model._occ_map_v2","schema","fields_start","field_count","field_no","wire_type","val_view"]],["if",["=",["bytes.len","map_val"],0],["set","ok",0],0],["if",["=","ok",0],0,["begin",["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","map_val"]]]],["set","payload",["vec_u8.extend_bytes","payload","map_val"]],0]],0]],0]],0]]]],0]],["if",["=","ok",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_map_failed"]]],0],["if",["!=","pos","n"],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed"]]],0],["let","payload_b",["vec_u8.into_bytes","payload"]],["let","elems",["vec_u8.with_capacity",["+",4,["bytes.len","payload_b"]]]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","count"]]],["set","elems",["vec_u8.extend_bytes","elems","payload_b"]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","seq_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["if",["=",["bytes.len","seq_val"],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_seq_failed"]]],0],["ext.data_model.doc_ok",["bytes.view","seq_val"]]],"kind":"defn","name":"ext.pb.data_model.decode_schema_v2","params":[{"name":"msg","ty":"bytes_view"},{"name":"schema","ty":"bytes_view"},{"name":"message_name","ty":"bytes_view"},{"name":"max_out_bytes","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","msg_malformed",["bytes.lit","pb:malformed_wire_doc"]],["let","msg_map_failed",["bytes.lit","pb:map_build_failed"]],["let","msg_seq_failed",["bytes.lit","pb:seq_build_failed"]],["let","raw",["ext.pb.wire.decode_v1","msg","max_out_bytes"]],["let","rawv",["bytes.view","raw"]],["if",["ext.pb.wire.is_err","rawv"],["ext.data_model.doc_err_from_code",["ext.pb.wire.err_code","rawv"]],["begin",["let","n",["view.len","rawv"]],["if",["<u","n",5],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed"]]],0],["let","count",["codec.read_u32_le","rawv",1]],["if",["<","count",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed"]]],0],["let","k_field",["bytes.lit","field_no"]],["let","k_wire",["bytes.lit","wire_type"]],["let","k_value",["bytes.lit","value"]],["let","k_field_v",["bytes.view","k_field"]],["let","k_wire_v",["bytes.view","k_wire"]],["let","k_value_v",["bytes.view","k_value"]],["let","k_field_len",["view.len","k_field_v"]],["let","k_wire_len",["view.len","k_wire_v"]],["let","k_value_len",["view.len","k_value_v"]],["let","pos",5],["let","payload",["vec_u8.with_capacity",64]],["let","ok",1],["for","_",0,"count",["begin",["if",["=","ok",0],0,["begin",["if",[">=u",["+","pos",9],["+","n",1]],["set","ok",0],0],["if",["=","ok",0],0,["begin",["let","field_no",["codec.read_u32_le","rawv","pos"]],["set","pos",["+","pos",4]],["let","wire_type",["view.get_u8","rawv","pos"]],["set","pos",["+","pos",1]],["let","vlen",["codec.read_u32_le","rawv","pos"]],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","vlen"],["+","n",1]],["set","ok",0],0],["if",["=","ok",0],0,["begin",["let","val_view",["view.slice","rawv","pos","vlen"]],["set","pos",["+","pos","vlen"]],["let","field_s",["std.fmt.u32_to_dec","field_no"]],["let","field_v",["ext.data_model.value_number",["bytes.view","field_s"]]],["let","wire_s",["std.fmt.u32_to_dec","wire_type"]],["let","wire_v",["ext.data_model.value_number",["bytes.view","wire_s"]]],["let","value_v",["ext.data_model.value_string","val_view"]],["let","field_v_len",["bytes.len","field_v"]],["let","wire_v_len",["bytes.len","wire_v"]],["let","value_v_len",["bytes.len","value_v"]],["let","entries",["vec_u8.with_capacity",["+",4,["+",["+",["+",["+",12,"k_field_len"],"field_v_len"],"k_wire_len"],["+",["+","wire_v_len","k_value_len"],"value_v_len"]]]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",3]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_field_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_field_v",0,"k_field_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","field_v_len"]]],["set","entries",["vec_u8.extend_bytes","entries","field_v"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_wire_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_wire_v",0,"k_wire_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","wire_v_len"]]],["set","entries",["vec_u8.extend_bytes","entries","wire_v"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","k_value_len"]]],["set","entries",["vec_u8.extend_bytes_range","entries","k_value_v",0,"k_value_len"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le","value_v_len"]]],["set","entries",["vec_u8.extend_bytes","entries","value_v"]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","map_val",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["if",["=",["bytes.len","map_val"],0],["set","ok",0],0],["if",["=","ok",0],0,["begin",["set","payload",["vec_u8.extend_bytes","payload",["codec.write_u32_le",["bytes.len","map_val"]]]],["set","payload",["vec_u8.extend_bytes","payload","map_val"]],0]],0]],0]],0]],0]],["if",["=","ok",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_map_failed"]]],0],["if",["!=","pos","n"],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed"]]],0],["let","payload_b",["vec_u8.into_bytes","payload"]],["let","elems",["vec_u8.with_capacity",["+",4,["bytes.len","payload_b"]]]],["set","elems",["vec_u8.extend_bytes","elems",["codec.write_u32_le","count"]]],["set","elems",["vec_u8.extend_bytes","elems","payload_b"]],["let","elems_b",["vec_u8.into_bytes","elems"]],["let","seq_val",["ext.data_model.value_seq_from_elems",["bytes.view","elems_b"]]],["if",["=",["bytes.len","seq_val"],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_seq_failed"]]],0],["ext.data_model.doc_ok",["bytes.view","seq_val"]]]]],"kind":"defn","name":"ext.pb.data_model.decode_v1","params":[{"name":"msg","ty":"bytes_view"},{"name":"max_out_bytes","ty":"i32"}],"result":"bytes"},{"kind":"defn","name":"ext.pb.data_model.emit_v1","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes","body":["begin",["let","msg_malformed_doc",["bytes.lit","pb:data_model:malformed_doc"]],["let","msg_root_not_seq",["bytes.lit","pb:data_model:root_not_seq"]],["let","msg_occ_not_map",["bytes.lit","pb:data_model:occ_not_map"]],["let","msg_missing_field_no",["bytes.lit","pb:data_model:missing_field_no"]],["let","msg_missing_wire_type",["bytes.lit","pb:data_model:missing_wire_type"]],["let","msg_missing_value",["bytes.lit","pb:data_model:missing_value"]],["let","msg_field_no_invalid",["bytes.lit","pb:data_model:field_no_invalid"]],["let","msg_wire_type_invalid",["bytes.lit","pb:data_model:wire_type_invalid"]],["let","msg_value_invalid",["bytes.lit","pb:data_model:value_invalid"]],["let","n",["view.len","doc"]],["if",["<","n",1],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["if",["=",["view.get_u8","doc",0],0],["return",["view.to_bytes","doc"]],0],["let","root_kind",["ext.data_model.root_kind","doc"]],["if",["<","root_kind",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["if",["!=","root_kind",4],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_root_not_seq"]]],0],["let","root_off",["ext.data_model.root_offset","doc"]],["if",["<","root_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["let","count",["ext.data_model.seq_len","doc","root_off"]],["if",["<","count",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["let","out",["vec_u8.with_capacity",64]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","count"]]],["let","k_field_no",["bytes.lit","field_no"]],["let","k_wire_type",["bytes.lit","wire_type"]],["let","k_value",["bytes.lit","value"]],["let","k_field_no_v",["bytes.view","k_field_no"]],["let","k_wire_type_v",["bytes.view","k_wire_type"]],["let","k_value_v",["bytes.view","k_value"]],["for","i",0,"count",["begin",["let","occ_off",["ext.data_model.seq_get","doc","root_off","i"]],["if",["<","occ_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["if",["!=",["ext.data_model.kind_at","doc","occ_off"],5],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_occ_not_map"]]],0],["let","field_no_off",["ext.data_model.map_find","doc","occ_off","k_field_no_v"]],["if",["<","field_no_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_missing_field_no"]]],0],["let","wire_type_off",["ext.data_model.map_find","doc","occ_off","k_wire_type_v"]],["if",["<","wire_type_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_missing_wire_type"]]],0],["let","value_off",["ext.data_model.map_find","doc","occ_off","k_value_v"]],["if",["<","value_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_missing_value"]]],0],["if",["!=",["ext.data_model.kind_at","doc","field_no_off"],2],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_field_no_invalid"]]],0],["let","field_no_s",["ext.data_model.number_get","doc","field_no_off"]],["let","field_no_res",["std.parse.i32_status_le",["bytes.view","field_no_s"]]],["if",["=",["bytes.get_u8","field_no_res",0],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_field_no_invalid"]]],0],["let","field_no",["codec.read_u32_le",["bytes.view","field_no_res"],1]],["if",["<=","field_no",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_field_no_invalid"]]],0],["if",["!=",["ext.data_model.kind_at","doc","wire_type_off"],2],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_wire_type_invalid"]]],0],["let","wire_type_s",["ext.data_model.number_get","doc","wire_type_off"]],["let","wire_type_res",["std.parse.i32_status_le",["bytes.view","wire_type_s"]]],["if",["=",["bytes.get_u8","wire_type_res",0],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_wire_type_invalid"]]],0],["let","wire_type",["codec.read_u32_le",["bytes.view","wire_type_res"],1]],["if",["if",["=","wire_type",0],1,["if",["=","wire_type",1],1,["if",["=","wire_type",2],1,["=","wire_type",5]]]],0,["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_wire_type_invalid"]]]],["if",["!=",["ext.data_model.kind_at","doc","value_off"],3],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_value_invalid"]]],0],["let","val",["ext.data_model.string_get","doc","value_off"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","field_no"]]],["set","out",["vec_u8.push","out","wire_type"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["bytes.len","val"]]]],["set","out",["vec_u8.extend_bytes","out","val"]],0]],["let","wire_doc",["vec_u8.into_bytes","out"]],["ext.pb.wire.encode_v1",["bytes.view","wire_doc"],1048576]]},{"kind":"defn","name":"ext.pb.data_model.emit_schema_v2","params":[{"name":"doc","ty":"bytes_view"},{"name":"schema","ty":"bytes_view"},{"name":"message_name","ty":"bytes_view"}],"result":"bytes","body":["begin",["let","msg_bad_schema",["bytes.lit","pb:schema:bad_schema_doc"]],["let","msg_not_found",["bytes.lit","pb:schema:message_not_found"]],["let","info_b",["ext.pb.data_model._schema_message_fields_v1","schema","message_name"]],["let","info",["bytes.view","info_b"]],["if",["<",["view.len","info"],1],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]],0],["if",["=",["view.get_u8","info",0],0],["begin",["let","code",["ext.pb.wire.err_code","info"]],["if",["=","code",2],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_not_found"]]],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]]],0],["let","fields_start",["codec.read_u32_le","info",1]],["let","field_count",["codec.read_u32_le","info",5]],["if",["<","fields_start",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]],0],["if",["<","field_count",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_bad_schema"]]],0],["let","msg_malformed_doc",["bytes.lit","pb:data_model:malformed_doc"]],["let","msg_root_not_seq",["bytes.lit","pb:data_model:root_not_seq"]],["let","msg_occ_not_map",["bytes.lit","pb:data_model:occ_not_map"]],["let","msg_missing_field_no",["bytes.lit","pb:data_model:missing_field_no"]],["let","msg_missing_wire_type",["bytes.lit","pb:data_model:missing_wire_type"]],["let","msg_missing_value",["bytes.lit","pb:data_model:missing_value"]],["let","msg_field_no_invalid",["bytes.lit","pb:data_model:field_no_invalid"]],["let","msg_wire_type_invalid",["bytes.lit","pb:data_model:wire_type_invalid"]],["let","msg_value_invalid",["bytes.lit","pb:data_model:value_invalid"]],["let","n",["view.len","doc"]],["if",["<","n",1],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["if",["=",["view.get_u8","doc",0],0],["return",["view.to_bytes","doc"]],0],["let","root_kind",["ext.data_model.root_kind","doc"]],["if",["<","root_kind",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["if",["!=","root_kind",4],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_root_not_seq"]]],0],["let","root_off",["ext.data_model.root_offset","doc"]],["if",["<","root_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["let","count",["ext.data_model.seq_len","doc","root_off"]],["if",["<","count",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["let","out",["vec_u8.with_capacity",64]],["set","out",["vec_u8.push","out",1]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","count"]]],["let","k_field_no",["bytes.lit","field_no"]],["let","k_wire_type",["bytes.lit","wire_type"]],["let","k_value",["bytes.lit","value"]],["let","k_field_no_v",["bytes.view","k_field_no"]],["let","k_wire_type_v",["bytes.view","k_wire_type"]],["let","k_value_v",["bytes.view","k_value"]],["for","i",0,"count",["begin",["let","occ_off",["ext.data_model.seq_get","doc","root_off","i"]],["if",["<","occ_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_malformed_doc"]]],0],["if",["!=",["ext.data_model.kind_at","doc","occ_off"],5],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_occ_not_map"]]],0],["let","field_no_off",["ext.data_model.map_find","doc","occ_off","k_field_no_v"]],["if",["<","field_no_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_missing_field_no"]]],0],["let","wire_type_off",["ext.data_model.map_find","doc","occ_off","k_wire_type_v"]],["if",["<","wire_type_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_missing_wire_type"]]],0],["let","value_off",["ext.data_model.map_find","doc","occ_off","k_value_v"]],["if",["<","value_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_missing_value"]]],0],["if",["!=",["ext.data_model.kind_at","doc","field_no_off"],2],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_field_no_invalid"]]],0],["let","field_no_s",["ext.data_model.number_get","doc","field_no_off"]],["let","field_no_res",["std.parse.i32_status_le",["bytes.view","field_no_s"]]],["if",["=",["bytes.get_u8","field_no_res",0],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_field_no_invalid"]]],0],["let","field_no",["codec.read_u32_le",["bytes.view","field_no_res"],1]],["if",["<=","field_no",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_field_no_invalid"]]],0],["if",["!=",["ext.data_model.kind_at","doc","wire_type_off"],2],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_wire_type_invalid"]]],0],["let","wire_type_s",["ext.data_model.number_get","doc","wire_type_off"]],["let","wire_type_res",["std.parse.i32_status_le",["bytes.view","wire_type_s"]]],["if",["=",["bytes.get_u8","wire_type_res",0],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_wire_type_invalid"]]],0],["let","wire_type",["codec.read_u32_le",["bytes.view","wire_type_res"],1]],["if",["if",["=","wire_type",0],1,["if",["=","wire_type",1],1,["if",["=","wire_type",2],1,["=","wire_type",5]]]],0,["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_wire_type_invalid"]]]],["if",["!=",["ext.data_model.kind_at","doc","value_off"],3],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_value_invalid"]]],0],["let","val",["ext.data_model.string_get","doc","value_off"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","field_no"]]],["set","out",["vec_u8.push","out","wire_type"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",["bytes.len","val"]]]],["set","out",["vec_u8.extend_bytes","out","val"]],0]],["let","wire_doc",["vec_u8.into_bytes","out"]],["ext.pb.wire.encode_v1",["bytes.view","wire_doc"],1048576]]},{"kind":"defn","name":"ext.pb.data_model.is_err","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32","body":["begin",["if",["<",["view.len","doc"],1],["return",1],0],["=",["view.get_u8","doc",0],0]]},{"kind":"defn","name":"ext.pb.data_model.err_code","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32","body":["ext.pb.wire.err_code","doc"]},{"kind":"defn","name":"ext.pb.data_model.get_bytes","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes","body":["begin",["let","n",["view.len","doc"]],["if",["<","n",2],["return",["bytes.alloc",0]],0],["if",["=",["view.get_u8","doc",0],1],0,["return",["bytes.alloc",0]]],["view.to_bytes",["view.slice","doc",1,["-","n",1]]]]}],"imports":["ext.data_model","ext.pb.wire","std.fmt","std.parse"],"kind":"module","module_id":"ext.pb.data_model","schema_version":"x07.x07ast@0.3.0"}
