{"decls":[{"kind":"export","names":["std.obs.otlp.encode_metrics_export_v1"]},{"body":["begin",["let","labels_len",["ext.data_model.seq_len","doc","labels_off"]],["if",["<","labels_len",0],["return","out"],0],["for","i",0,"labels_len",["begin",["let","entry_off",["ext.data_model.seq_get","doc","labels_off","i"]],["if",["<","entry_off",0],["return","out"],0],["let","k_key",["bytes.lit","k"]],["let","v_key",["bytes.lit","v"]],["let","k_off",["ext.data_model.map_find","doc","entry_off",["bytes.view","k_key"]]],["let","v_off",["ext.data_model.map_find","doc","entry_off",["bytes.view","v_key"]]],["if",["if",["<","k_off",0],1,["<","v_off",0]],["return","out"],0],["let","k",["ext.data_model.string_get","doc","k_off"]],["let","v",["ext.data_model.string_get","doc","v_off"]],["let","kv",["std.obs.otlp._encode_keyvalue_string_v1",["bytes.view","k"],["bytes.view","v"]]],["set","out",["std.obs.otlp._append_len_delim_v1","out","attr_field_no",["bytes.view","kv"]]],0]],"out"],"kind":"defn","name":"std.obs.otlp._append_attributes_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"doc","ty":"bytes_view"},{"name":"labels_off","ty":"i32"},{"name":"attr_field_no","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["if",["!=",["view.len","bits"],8],["return","out"],0],["set","out",["std.obs.otlp._append_key_v1","out","field_no",1]],["vec_u8.extend_bytes_range","out","bits",0,8]],"kind":"defn","name":"std.obs.otlp._append_fixed64_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"field_no","ty":"i32"},{"name":"bits","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","tag",["|",["<<u","field_no",3],"wire_type"]],["std.obs.otlp._append_varint_u32_v1","out","tag"]],"kind":"defn","name":"std.obs.otlp._append_key_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"field_no","ty":"i32"},{"name":"wire_type","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","n",["view.len","payload"]],["set","out",["std.obs.otlp._append_key_v1","out","field_no",2]],["set","out",["std.obs.otlp._append_varint_u32_v1","out","n"]],["vec_u8.extend_bytes_range","out","payload",0,"n"]],"kind":"defn","name":"std.obs.otlp._append_len_delim_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"field_no","ty":"i32"},{"name":"payload","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","b",["ext.pb.wire.varint_u32_encode_v1","x"]],["vec_u8.extend_bytes","out","b"]],"kind":"defn","name":"std.obs.otlp._append_varint_u32_v1","params":[{"name":"out","ty":"vec_u8"},{"name":"x","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","out",["vec_u8.with_capacity",["+",8,["view.len","v"]]]],["set","out",["std.obs.otlp._append_len_delim_v1","out",1,"v"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.obs.otlp._encode_anyvalue_string_v1","params":[{"name":"v","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","out",["vec_u8.with_capacity",256]],["set","out",["std.obs.otlp._append_attributes_v1","out","doc","labels_off",9]],["set","out",["std.obs.otlp._append_fixed64_v1","out",2,"start_time_bits"]],["set","out",["std.obs.otlp._append_fixed64_v1","out",3,"time_bits"]],["let","cb",["ext.u64.to_bytes_le","count_u32",0]],["set","out",["std.obs.otlp._append_fixed64_v1","out",4,["bytes.view","cb"]]],["set","out",["std.obs.otlp._append_fixed64_v1","out",5,"sum_f64_bits"]],["let","bc_len",["ext.data_model.seq_len","doc","bucket_counts_off"]],["for","i",0,"bc_len",["begin",["let","v_off",["ext.data_model.seq_get","doc","bucket_counts_off","i"]],["let","v_num",["ext.data_model.number_get","doc","v_off"]],["let","v",["std.obs.otlp._parse_u32_dec_or_neg1_v1",["bytes.view","v_num"]]],["if",["<","v",0],["return",["vec_u8.into_bytes","out"]],0],["let","vb",["ext.u64.to_bytes_le","v",0]],["set","out",["std.obs.otlp._append_fixed64_v1","out",6,["bytes.view","vb"]]],0]],["let","b_len",["ext.data_model.seq_len","doc","bounds_off"]],["for","i",0,"b_len",["begin",["let","b_off",["ext.data_model.seq_get","doc","bounds_off","i"]],["let","b_num",["ext.data_model.number_get","doc","b_off"]],["let","f_res",["std.math.f64.parse_v1",["bytes.view","b_num"]]],["if",["!=",["result_bytes.err_code","f_res"],0],["return",["vec_u8.into_bytes","out"]],0],["let","f",["result_bytes.unwrap_or","f_res",["bytes.alloc",0]]],["let","bits",["std.math.f64.to_bits_u64le_v1",["bytes.view","f"]]],["set","out",["std.obs.otlp._append_fixed64_v1","out",7,["bytes.view","bits"]]],0]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.obs.otlp._encode_histogram_datapoint_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"labels_off","ty":"i32"},{"name":"start_time_bits","ty":"bytes_view"},{"name":"time_bits","ty":"bytes_view"},{"name":"count_u32","ty":"i32"},{"name":"sum_f64_bits","ty":"bytes_view"},{"name":"bucket_counts_off","ty":"i32"},{"name":"bounds_off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","av",["std.obs.otlp._encode_anyvalue_string_v1","v"]],["let","out",["vec_u8.with_capacity",["+",32,["+",["view.len","k"],["bytes.len","av"]]]]],["set","out",["std.obs.otlp._append_len_delim_v1","out",1,"k"]],["set","out",["std.obs.otlp._append_len_delim_v1","out",2,["bytes.view","av"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.obs.otlp._encode_keyvalue_string_v1","params":[{"name":"k","ty":"bytes_view"},{"name":"v","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","out",["vec_u8.with_capacity",128]],["set","out",["std.obs.otlp._append_attributes_v1","out","doc","labels_off",7]],["set","out",["std.obs.otlp._append_fixed64_v1","out",2,"start_time_bits"]],["set","out",["std.obs.otlp._append_fixed64_v1","out",3,"time_bits"]],["let","vb",["ext.u64.to_bytes_le","value_u32",0]],["set","out",["std.obs.otlp._append_fixed64_v1","out",6,["bytes.view","vb"]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.obs.otlp._encode_number_datapoint_counter_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"labels_off","ty":"i32"},{"name":"start_time_bits","ty":"bytes_view"},{"name":"time_bits","ty":"bytes_view"},{"name":"value_u32","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","out",["vec_u8.with_capacity",128]],["set","out",["std.obs.otlp._append_attributes_v1","out","doc","labels_off",7]],["set","out",["std.obs.otlp._append_fixed64_v1","out",3,"time_bits"]],["set","out",["std.obs.otlp._append_fixed64_v1","out",4,"value_f64_bits"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"std.obs.otlp._encode_number_datapoint_gauge_v1","params":[{"name":"doc","ty":"bytes_view"},{"name":"labels_off","ty":"i32"},{"name":"time_bits","ty":"bytes_view"},{"name":"value_f64_bits","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","b"]],["if",["<=","n",0],["return",-1],0],["let","x",0],["for","i",0,"n",["begin",["let","c",["view.get_u8","b","i"]],["if",["if",[">=u","c",48],["<u","c",58],0],0,["return",-1]],["let","d",["-","c",48]],["if",[">","x",214748364],["return",-1],0],["if",["if",["=","x",214748364],[">","d",7],0],["return",-1],0],["set","x",["+",["*","x",10],"d"]],0]],"x"],"kind":"defn","name":"std.obs.otlp._parse_u32_dec_or_neg1_v1","params":[{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["=",["ext.data_model.doc_is_err","snapshot"],1],["return",["result_bytes.err",63001]],0],["if",["!=",["ext.data_model.root_kind","snapshot"],5],["return",["result_bytes.err",63002]],0],["let","root",["ext.data_model.root_offset","snapshot"]],["let","k_schema",["bytes.lit","schema_version"]],["let","schema_off",["ext.data_model.map_find","snapshot","root",["bytes.view","k_schema"]]],["if",["<","schema_off",0],["return",["result_bytes.err",63003]],0],["let","schema",["ext.data_model.string_get","snapshot","schema_off"]],["if",["bytes.eq","schema",["bytes.lit","x07.obs.snapshot@0.1.0"]],0,["return",["result_bytes.err",63004]]],["let","k_time",["bytes.lit","time_unix_nano"]],["let","k_start",["bytes.lit","start_time_unix_nano"]],["let","time_off",["ext.data_model.map_find","snapshot","root",["bytes.view","k_time"]]],["let","start_off",["ext.data_model.map_find","snapshot","root",["bytes.view","k_start"]]],["if",["<","time_off",0],["return",["result_bytes.err",63005]],0],["let","time_num",["ext.data_model.number_get","snapshot","time_off"]],["let","time_u32",["std.obs.otlp._parse_u32_dec_or_neg1_v1",["bytes.view","time_num"]]],["if",["<","time_u32",0],["return",["result_bytes.err",63006]],0],["let","start_u32",["if",["<","start_off",0],"time_u32",["begin",["let","n",["ext.data_model.number_get","snapshot","start_off"]],["std.obs.otlp._parse_u32_dec_or_neg1_v1",["bytes.view","n"]]]]],["if",["<","start_u32",0],["return",["result_bytes.err",63007]],0],["let","time_bits",["ext.u64.to_bytes_le","time_u32",0]],["let","start_bits",["ext.u64.to_bytes_le","start_u32",0]],["let","k_metrics",["bytes.lit","metrics"]],["let","metrics_off",["ext.data_model.map_find","snapshot","root",["bytes.view","k_metrics"]]],["if",["<","metrics_off",0],["return",["result_bytes.err",63008]],0],["let","metrics_len",["ext.data_model.seq_len","snapshot","metrics_off"]],["if",["<","metrics_len",0],["return",["result_bytes.err",63009]],0],["let","scope_metrics_out",["vec_u8.with_capacity",1024]],["for","mi",0,"metrics_len",["begin",["let","metric_off",["ext.data_model.seq_get","snapshot","metrics_off","mi"]],["if",["<","metric_off",0],["return",["result_bytes.err",63010]],0],["let","k_id",["bytes.lit","id"]],["let","k_type",["bytes.lit","type"]],["let","k_help",["bytes.lit","help"]],["let","k_unit",["bytes.lit","unit"]],["let","k_series",["bytes.lit","series"]],["let","id_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_id"]]],["let","type_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_type"]]],["let","help_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_help"]]],["let","unit_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_unit"]]],["let","series_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_series"]]],["if",["if",["<","id_off",0],1,["if",["<","type_off",0],1,["<","series_off",0]]],["return",["result_bytes.err",63011]],0],["let","id",["ext.data_model.string_get","snapshot","id_off"]],["let","typ",["ext.data_model.string_get","snapshot","type_off"]],["let","help",["if",["<","help_off",0],["bytes.alloc",0],["ext.data_model.string_get","snapshot","help_off"]]],["let","unit",["if",["<","unit_off",0],["bytes.alloc",0],["ext.data_model.string_get","snapshot","unit_off"]]],["let","series_len",["ext.data_model.seq_len","snapshot","series_off"]],["if",["<","series_len",0],["return",["result_bytes.err",63012]],0],["let","metric_msg",["vec_u8.with_capacity",512]],["set","metric_msg",["std.obs.otlp._append_len_delim_v1","metric_msg",1,["bytes.view","id"]]],["if",[">",["bytes.len","help"],0],["set","metric_msg",["std.obs.otlp._append_len_delim_v1","metric_msg",2,["bytes.view","help"]]],0],["if",[">",["bytes.len","unit"],0],["set","metric_msg",["std.obs.otlp._append_len_delim_v1","metric_msg",3,["bytes.view","unit"]]],0],["if",["bytes.eq","typ",["bytes.lit","counter_u64_v1"]],["begin",["let","sum_msg",["vec_u8.with_capacity",512]],["for","si",0,"series_len",["begin",["let","s_off",["ext.data_model.seq_get","snapshot","series_off","si"]],["let","k_labels",["bytes.lit","labels"]],["let","k_value",["bytes.lit","value"]],["let","labels_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_labels"]]],["let","value_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_value"]]],["if",["if",["<","labels_off",0],1,["<","value_off",0]],["return",["result_bytes.err",63013]],0],["let","v_num",["ext.data_model.number_get","snapshot","value_off"]],["let","v_u32",["std.obs.otlp._parse_u32_dec_or_neg1_v1",["bytes.view","v_num"]]],["if",["<","v_u32",0],["return",["result_bytes.err",63014]],0],["let","dp",["std.obs.otlp._encode_number_datapoint_counter_v1","snapshot","labels_off",["bytes.view","start_bits"],["bytes.view","time_bits"],"v_u32"]],["set","sum_msg",["std.obs.otlp._append_len_delim_v1","sum_msg",1,["bytes.view","dp"]]],0]],["set","sum_msg",["std.obs.otlp._append_key_v1","sum_msg",2,0]],["set","sum_msg",["std.obs.otlp._append_varint_u32_v1","sum_msg",2]],["set","sum_msg",["std.obs.otlp._append_key_v1","sum_msg",3,0]],["set","sum_msg",["std.obs.otlp._append_varint_u32_v1","sum_msg",1]],["let","sum_bytes",["vec_u8.into_bytes","sum_msg"]],["set","metric_msg",["std.obs.otlp._append_len_delim_v1","metric_msg",7,["bytes.view","sum_bytes"]]],0],["if",["bytes.eq","typ",["bytes.lit","gauge_f64_v1"]],["begin",["let","g_msg",["vec_u8.with_capacity",512]],["for","si",0,"series_len",["begin",["let","s_off",["ext.data_model.seq_get","snapshot","series_off","si"]],["let","k_labels",["bytes.lit","labels"]],["let","k_value",["bytes.lit","value"]],["let","labels_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_labels"]]],["let","value_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_value"]]],["if",["if",["<","labels_off",0],1,["<","value_off",0]],["return",["result_bytes.err",63015]],0],["let","v_num",["ext.data_model.number_get","snapshot","value_off"]],["let","f",["try",["std.math.f64.parse_v1",["bytes.view","v_num"]]]],["let","bits",["std.math.f64.to_bits_u64le_v1",["bytes.view","f"]]],["let","dp",["std.obs.otlp._encode_number_datapoint_gauge_v1","snapshot","labels_off",["bytes.view","time_bits"],["bytes.view","bits"]]],["set","g_msg",["std.obs.otlp._append_len_delim_v1","g_msg",1,["bytes.view","dp"]]],0]],["let","g_bytes",["vec_u8.into_bytes","g_msg"]],["set","metric_msg",["std.obs.otlp._append_len_delim_v1","metric_msg",5,["bytes.view","g_bytes"]]],0],["if",["bytes.eq","typ",["bytes.lit","histogram_f64_v1"]],["begin",["let","k_buckets",["bytes.lit","buckets"]],["let","buckets_off",["ext.data_model.map_find","snapshot","metric_off",["bytes.view","k_buckets"]]],["if",["<","buckets_off",0],["return",["result_bytes.err",63016]],0],["let","h_msg",["vec_u8.with_capacity",768]],["for","si",0,"series_len",["begin",["let","s_off",["ext.data_model.seq_get","snapshot","series_off","si"]],["let","k_labels",["bytes.lit","labels"]],["let","k_count",["bytes.lit","count"]],["let","k_sum",["bytes.lit","sum"]],["let","k_bucket_counts",["bytes.lit","bucket_counts"]],["let","labels_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_labels"]]],["let","count_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_count"]]],["let","sum_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_sum"]]],["let","bc_off",["ext.data_model.map_find","snapshot","s_off",["bytes.view","k_bucket_counts"]]],["if",["if",["if",["<","labels_off",0],1,["<","count_off",0]],1,["if",["<","sum_off",0],1,["<","bc_off",0]]],["return",["result_bytes.err",63017]],0],["let","count_num",["ext.data_model.number_get","snapshot","count_off"]],["let","count_u32",["std.obs.otlp._parse_u32_dec_or_neg1_v1",["bytes.view","count_num"]]],["if",["<","count_u32",0],["return",["result_bytes.err",63018]],0],["let","sum_num",["ext.data_model.number_get","snapshot","sum_off"]],["let","sf",["try",["std.math.f64.parse_v1",["bytes.view","sum_num"]]]],["let","sb",["std.math.f64.to_bits_u64le_v1",["bytes.view","sf"]]],["let","dp",["std.obs.otlp._encode_histogram_datapoint_v1","snapshot","labels_off",["bytes.view","start_bits"],["bytes.view","time_bits"],"count_u32",["bytes.view","sb"],"bc_off","buckets_off"]],["set","h_msg",["std.obs.otlp._append_len_delim_v1","h_msg",1,["bytes.view","dp"]]],0]],["set","h_msg",["std.obs.otlp._append_key_v1","h_msg",2,0]],["set","h_msg",["std.obs.otlp._append_varint_u32_v1","h_msg",2]],["let","h_bytes",["vec_u8.into_bytes","h_msg"]],["set","metric_msg",["std.obs.otlp._append_len_delim_v1","metric_msg",9,["bytes.view","h_bytes"]]],0],["return",["result_bytes.err",63019]]]]],["let","metric_bytes",["vec_u8.into_bytes","metric_msg"]],["set","scope_metrics_out",["std.obs.otlp._append_len_delim_v1","scope_metrics_out",2,["bytes.view","metric_bytes"]]],0]],["let","scope_metrics_bytes",["vec_u8.into_bytes","scope_metrics_out"]],["let","rm_msg",["vec_u8.with_capacity",["+",16,["bytes.len","scope_metrics_bytes"]]]],["set","rm_msg",["std.obs.otlp._append_len_delim_v1","rm_msg",2,["bytes.view","scope_metrics_bytes"]]],["let","rm_bytes",["vec_u8.into_bytes","rm_msg"]],["let","req_msg",["vec_u8.with_capacity",["+",16,["bytes.len","rm_bytes"]]]],["set","req_msg",["std.obs.otlp._append_len_delim_v1","req_msg",1,["bytes.view","rm_bytes"]]],["result_bytes.ok",["vec_u8.into_bytes","req_msg"]]],"kind":"defn","name":"std.obs.otlp.encode_metrics_export_v1","params":[{"name":"snapshot","ty":"bytes_view"}],"result":"result_bytes"}],"imports":["ext.data_model","ext.pb.wire","ext.u64","std.math.f64","std.vec"],"kind":"module","module_id":"std.obs.otlp","schema_version":"x07.x07ast@0.3.0"}
