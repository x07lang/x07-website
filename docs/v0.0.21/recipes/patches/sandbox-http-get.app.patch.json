[
  {
    "op": "add",
    "path": "/imports/-",
    "value": "std.net.http"
  },
  {
    "op": "add",
    "path": "/imports/-",
    "value": "std.net.http.spec"
  },
  {
    "op": "add",
    "path": "/imports/-",
    "value": "std.fmt"
  },
  {
    "op": "add",
    "path": "/imports/-",
    "value": "std.os.fs"
  },
  {
    "op": "replace",
    "path": "/decls/1/body",
    "value": [
      "begin",
      ["let", "url", ["bytes.lit", "https://example.com/"]],
      ["let", "caps", ["std.net.http.spec.caps_default_v1"]],
      ["let", "resp", ["std.net.http.get_v1", "url", "caps"]],
      ["let", "dv", ["bytes.view", "resp"]],
      [
        "if",
        ["std.net.http.resp_is_err_v1", "dv"],
        [
          "begin",
          ["let", "code", ["std.net.http.resp_err_code_v1", "dv"]],
          ["let", "code_b", ["std.fmt.s32_to_dec", "code"]],
          ["bytes.concat", ["bytes.lit", "http_error_code="], "code_b"]
        ],
        [
          "begin",
          ["let", "status", ["std.net.http.resp_status_v1", "dv"]],
          ["let", "body", ["std.net.http.resp_body_v1", "dv"]],
          ["std.os.fs.write_file", ["bytes.lit", "out/example.html"], "body"],
          ["bytes.concat", ["bytes.lit", "status="], ["std.fmt.u32_to_dec", "status"]]
        ]
      ]
    ]
  }
]
