{"decls":[{"kind":"export","names":["app.solve"]},{"body":["begin",["if",["!=",["ext.data_model.kind_at","m",0],5],["return",10],0],["let","count",["ext.data_model.map_len","m",0]],["if",["!=","count",2],["return",11],0],["let","expect_hello",["bytes.lit","hello"]],["let","expect_42",["bytes.lit","42"]],["let","hello_v",["bytes.view","expect_hello"]],["let","n42_v",["bytes.view","expect_42"]],["let","seen_a",0],["let","seen_b",0],["for","i",0,"count",["begin",["let","key_b",["ext.data_model.map_key_at","m",0,"i"]],["let","key",["bytes.view","key_b"]],["if",["!=",["view.len","key"],1],["return",20],0],["let","c0",["view.get_u8","key",0]],["let","vo",["ext.data_model.map_value_at","m",0,"i"]],["if",["<","vo",0],["return",21],0],["if",["=","c0",97],["begin",["if",["!=",["ext.data_model.kind_at","m","vo"],3],["return",30],0],["let","s",["ext.data_model.string_get","m","vo"]],["let","sv",["bytes.view","s"]],["if",["=",["app._view_eq","sv","hello_v"],0],["return",31],0],["set","seen_a",1],0],["if",["=","c0",98],["begin",["if",["!=",["ext.data_model.kind_at","m","vo"],2],["return",40],0],["let","n",["ext.data_model.number_get","m","vo"]],["let","nv",["bytes.view","n"]],["if",["=",["app._view_eq","nv","n42_v"],0],["return",41],0],["set","seen_b",1],0],["return",50]]],0]],["if",["=","seen_a",1],["if",["=","seen_b",1],1,60],60]],"kind":"defn","name":"app._check_expected_map","params":[{"name":"m","ty":"bytes_view"}],"result":"i32"},{"body":["if",["=","code",10],["bytes.lit","FAIL_map_kind"],["if",["=","code",11],["bytes.lit","FAIL_map_count"],["if",["=","code",20],["bytes.lit","FAIL_map_key_len"],["if",["=","code",21],["bytes.lit","FAIL_map_value_off"],["if",["=","code",30],["bytes.lit","FAIL_map_a_kind"],["if",["=","code",31],["bytes.lit","FAIL_map_a_value"],["if",["=","code",40],["bytes.lit","FAIL_map_b_kind"],["if",["=","code",41],["bytes.lit","FAIL_map_b_value"],["if",["=","code",50],["bytes.lit","FAIL_map_key_unknown"],["bytes.lit","FAIL_map_missing_keys"]]]]]]]]]],"kind":"defn","name":"app._fail_map_build","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["if",["=","code",10],["bytes.lit","FAIL_roundtrip_kind"],["if",["=","code",11],["bytes.lit","FAIL_roundtrip_count"],["if",["=","code",20],["bytes.lit","FAIL_roundtrip_key_len"],["if",["=","code",21],["bytes.lit","FAIL_roundtrip_value_off"],["if",["=","code",30],["bytes.lit","FAIL_roundtrip_a_kind"],["if",["=","code",31],["bytes.lit","FAIL_roundtrip_a_value"],["if",["=","code",40],["bytes.lit","FAIL_roundtrip_b_kind"],["if",["=","code",41],["bytes.lit","FAIL_roundtrip_b_value"],["if",["=","code",50],["bytes.lit","FAIL_roundtrip_key_unknown"],["bytes.lit","FAIL_roundtrip_missing_keys"]]]]]]]]]],"kind":"defn","name":"app._fail_roundtrip","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","count",["ext.data_model.map_len","m",0]],["if",["<","count",0],["return",["bytes.alloc",0]],0],["for","i",0,"count",["begin",["let","key_b",["ext.data_model.map_key_at","m",0,"i"]],["let","key",["bytes.view","key_b"]],["if",["if",["=",["view.len","key"],1],["=",["view.get_u8","key",0],98],0],["begin",["let","vo",["ext.data_model.map_value_at","m",0,"i"]],["if",["<","vo",0],["return",["bytes.alloc",0]],0],["if",["!=",["ext.data_model.kind_at","m","vo"],2],["return",["bytes.alloc",0]],0],["return",["ext.data_model.number_get","m","vo"]]],0],0]],["bytes.alloc",0]],"kind":"defn","name":"app._map_get_b_number","params":[{"name":"m","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","an",["view.len","a"]],["let","bn",["view.len","b"]],["if",["!=","an","bn"],["return",0],0],["if",["=",["bytes.cmp_range","a",0,"an","b",0,"bn"],0],1,0]],"kind":"defn","name":"app._view_eq","params":[{"name":"a","ty":"bytes_view"},{"name":"b","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","hello_s",["bytes.lit","hello"]],["let","n42_s",["bytes.lit","42"]],["let","v1",["ext.data_model.value_string",["bytes.view","hello_s"]]],["let","v2",["ext.data_model.value_number",["bytes.view","n42_s"]]],["let","entries",["vec_u8.with_capacity",64]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",2]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",1]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.lit","a"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v1"]]]],["set","entries",["vec_u8.extend_bytes","entries","v1"]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",1]]],["set","entries",["vec_u8.extend_bytes","entries",["bytes.lit","b"]]],["set","entries",["vec_u8.extend_bytes","entries",["codec.write_u32_le",["bytes.len","v2"]]]],["set","entries",["vec_u8.extend_bytes","entries","v2"]],["let","entries_b",["vec_u8.into_bytes","entries"]],["let","map",["ext.data_model.value_map_from_entries",["bytes.view","entries_b"]]],["let","mapv",["bytes.view","map"]],["let","map_code",["app._check_expected_map","mapv"]],["if",["!=","map_code",1],["return",["app._fail_map_build","map_code"]],0],["let","doc",["ext.data_model.doc_ok","mapv"]],["let","emit",["ext.cbor.data_model.emit_v1",["bytes.view","doc"]]],["let","ev",["bytes.view","emit"]],["if",["!=",["ext.cbor.data_model.is_err","ev"],0],["return",["bytes.lit","FAIL_cbor_emit"]],0],["let","cbor",["ext.cbor.data_model.get_bytes","ev"]],["let","parse",["ext.cbor.data_model.parse_v1",["bytes.view","cbor"]]],["let","pv",["bytes.view","parse"]],["if",["!=",["ext.cbor.data_model.is_err","pv"],0],["return",["bytes.lit","FAIL_cbor_parse"]],0],["let","map2",["ext.cbor.data_model.get_bytes","pv"]],["let","map2v",["bytes.view","map2"]],["let","map2_code",["app._check_expected_map","map2v"]],["if",["!=","map2_code",1],["begin",["if",["=","map2_code",41],["return",["app._map_get_b_number","map2v"]],0],["return",["app._fail_roundtrip","map2_code"]]],0],["let","out",["bytes.alloc",3]],["set","out",["bytes.set_u8","out",0,111]],["set","out",["bytes.set_u8","out",1,107]],["bytes.set_u8","out",2,10]],"kind":"defn","name":"app.solve","params":[{"name":"b","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.cbor.data_model","ext.data_model"],"kind":"module","module_id":"app","schema_version":"x07.x07ast@0.3.0"}
