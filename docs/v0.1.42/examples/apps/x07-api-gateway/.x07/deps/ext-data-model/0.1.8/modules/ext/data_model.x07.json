{"decls":[{"kind":"export","names":["ext.data_model.bool_get","ext.data_model.doc_err_from_code","ext.data_model.doc_err_from_msg","ext.data_model.doc_error_code","ext.data_model.doc_error_msg","ext.data_model.doc_is_err","ext.data_model.doc_ok","ext.data_model.kind_at","ext.data_model.map_find","ext.data_model.map_key_at","ext.data_model.map_len","ext.data_model.map_value_at","ext.data_model.number_get","ext.data_model.root_kind","ext.data_model.root_offset","ext.data_model.seq_get","ext.data_model.seq_len","ext.data_model.skip_value","ext.data_model.string_get","ext.data_model.value_bool","ext.data_model.value_map_from_entries","ext.data_model.value_null","ext.data_model.value_number","ext.data_model.value_seq_from_elems","ext.data_model.value_string"]},{"body":["begin",["let","min_len",["if",["<u","a_len","b_len"],"a_len","b_len"]],["for","i",0,"min_len",["begin",["let","ac",["view.get_u8","a",["+","a_start","i"]]],["let","bc",["view.get_u8","b",["+","b_start","i"]]],["if",["<","ac","bc"],["return",-1],0],["if",[">","ac","bc"],["return",1],0],0]],["if",["<","a_len","b_len"],-1,["if",[">","a_len","b_len"],1,0]]],"kind":"defn","name":"ext.data_model._cmp_bytes_range","params":[{"name":"a","ty":"bytes_view"},{"name":"a_start","ty":"i32"},{"name":"a_len","ty":"i32"},{"name":"b","ty":"bytes_view"},{"name":"b_start","ty":"i32"},{"name":"b_len","ty":"i32"}],"result":"i32"},{"body":["begin",["let","a_len",["ext.data_model._entry_key_len","entries","a_off"]],["let","b_len",["ext.data_model._entry_key_len","entries","b_off"]],["let","a_start",["ext.data_model._entry_key_start","entries","a_off"]],["let","b_start",["ext.data_model._entry_key_start","entries","b_off"]],["ext.data_model._cmp_bytes_range","entries","a_start","a_len","entries","b_start","b_len"]],"kind":"defn","name":"ext.data_model._cmp_entry_key","params":[{"name":"entries","ty":"bytes_view"},{"name":"a_off","ty":"i32"},{"name":"b_off","ty":"i32"}],"result":"i32"},{"body":["codec.read_u32_le","entries","entry_off"],"kind":"defn","name":"ext.data_model._entry_key_len","params":[{"name":"entries","ty":"bytes_view"},{"name":"entry_off","ty":"i32"}],"result":"i32"},{"body":["+","entry_off",4],"kind":"defn","name":"ext.data_model._entry_key_start","params":[{"name":"entries","ty":"bytes_view"},{"name":"entry_off","ty":"i32"}],"result":"i32"},{"body":["ext.data_model._extend_view_range","v","b",0,["view.len","b"]],"kind":"defn","name":"ext.data_model._extend_view","params":[{"name":"v","ty":"vec_u8"},{"name":"b","ty":"bytes_view"}],"result":"vec_u8"},{"body":["begin",["let","out","v"],["let","end",["+","start","len"]],["for","i","start","end",["begin",["set","out",["vec_u8.push","out",["view.get_u8","b","i"]]],0]],"out"],"kind":"defn","name":"ext.data_model._extend_view_range","params":[{"name":"v","ty":"vec_u8"},{"name":"b","ty":"bytes_view"},{"name":"start","ty":"i32"},{"name":"len","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","count",["ext.data_model.map_len","b","map_off"]],["if",["<","count",0],["return",-1],0],["if",["<","idx",0],["return",-1],0],["if",[">=","idx","count"],["return",-1],0],["let","pos",["+","map_off",5]],["for","i",0,"idx",["begin",["if",[">=u",["+","pos",4],["+",["view.len","b"],1]],["return",-1],0],["let","key_len",["codec.read_u32_le","b","pos"]],["set","pos",["+","pos",4]],["set","pos",["+","pos","key_len"]],["set","pos",["ext.data_model.skip_value","b","pos"]],["if",["<","pos",0],["return",-1],0],0]],"pos"],"kind":"defn","name":"ext.data_model._map_entry_start_at","params":[{"name":"b","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","b"]],["if",[">=u","off","n"],["return",-1],0],["if",["=",["view.get_u8","b","off"],1],0,["return",-1]],["if",[">=u",["+","off",1],"n"],["return",-1],0],["view.get_u8","b",["+","off",1]]],"kind":"defn","name":"ext.data_model.bool_get","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","out",["vec_u8.with_capacity",9]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","code"]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",0]]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.data_model.doc_err_from_code","params":[{"name":"code","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","msg_len",["view.len","msg"]],["let","out",["vec_u8.with_capacity",["+",9,"msg_len"]]],["set","out",["vec_u8.push","out",0]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le",0]]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","msg_len"]]],["set","out",["ext.data_model._extend_view","out","msg"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.data_model.doc_err_from_msg","params":[{"name":"msg","ty":"bytes_view"}],"result":"bytes"},{"body":["if",["<",["view.len","doc"],5],0,["codec.read_u32_le","doc",1]],"kind":"defn","name":"ext.data_model.doc_error_code","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","doc"]],["if",["<","n",9],["return",["bytes.alloc",0]],0],["let","msg_len",["codec.read_u32_le","doc",5]],["if",["<","n",["+",9,"msg_len"]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","doc",9,"msg_len"]]],"kind":"defn","name":"ext.data_model.doc_error_msg","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<",["view.len","doc"],1],["return",1],0],["=",["view.get_u8","doc",0],0]],"kind":"defn","name":"ext.data_model.doc_is_err","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","n",["view.len","value"]],["let","out",["vec_u8.with_capacity",["+",1,"n"]]],["set","out",["vec_u8.push","out",1]],["set","out",["ext.data_model._extend_view","out","value"]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.data_model.doc_ok","params":[{"name":"value","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["if",["<u","off",["view.len","b"]],["view.get_u8","b","off"],-1]],"kind":"defn","name":"ext.data_model.kind_at","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","count",["ext.data_model.map_len","b","map_off"]],["if",["<","count",0],["return",-1],0],["let","target_len",["view.len","key"]],["let","pos",["+","map_off",5]],["let","n",["view.len","b"]],["for","_",0,"count",["begin",["if",[">=u",["+","pos",4],["+","n",1]],["return",-1],0],["let","k_len",["codec.read_u32_le","b","pos"]],["let","k_start",["+","pos",4]],["let","k_end",["+","k_start","k_len"]],["if",[">=u","k_end",["+","n",1]],["return",-1],0],["let","v_off","k_end"],["let","cmp",["ext.data_model._cmp_bytes_range","b","k_start","k_len","key",0,"target_len"]],["if",["=","cmp",0],["return","v_off"],0],["set","pos",["ext.data_model.skip_value","b","v_off"]],["if",["<","pos",0],["return",-1],0],["if",[">","cmp",0],["return",-1],0],0]],-1],"kind":"defn","name":"ext.data_model.map_find","params":[{"name":"b","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"key","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","pos",["ext.data_model._map_entry_start_at","b","map_off","idx"]],["if",["<","pos",0],["return",["bytes.alloc",0]],0],["let","n",["view.len","b"]],["if",[">=u",["+","pos",4],["+","n",1]],["return",["bytes.alloc",0]],0],["let","key_len",["codec.read_u32_le","b","pos"]],["let","key_start",["+","pos",4]],["if",[">=u",["+","key_start","key_len"],["+","n",1]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","b","key_start","key_len"]]],"kind":"defn","name":"ext.data_model.map_key_at","params":[{"name":"b","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"idx","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","b"]],["if",[">=u","off","n"],["return",-1],0],["if",["=",["view.get_u8","b","off"],5],0,["return",-1]],["if",[">=u",["+","off",4],"n"],["return",-1],0],["codec.read_u32_le","b",["+","off",1]]],"kind":"defn","name":"ext.data_model.map_len","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","pos",["ext.data_model._map_entry_start_at","b","map_off","idx"]],["if",["<","pos",0],["return",-1],0],["let","n",["view.len","b"]],["if",[">=u",["+","pos",4],["+","n",1]],["return",-1],0],["let","key_len",["codec.read_u32_le","b","pos"]],["let","val_off",["+",["+","pos",4],"key_len"]],["if",[">=u","val_off","n"],-1,"val_off"]],"kind":"defn","name":"ext.data_model.map_value_at","params":[{"name":"b","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","b"]],["if",[">=u","off","n"],["return",["bytes.alloc",0]],0],["if",["=",["view.get_u8","b","off"],2],0,["return",["bytes.alloc",0]]],["if",[">=u",["+","off",4],"n"],["return",["bytes.alloc",0]],0],["let","len",["codec.read_u32_le","b",["+","off",1]]],["let","start",["+","off",5]],["if",[">=u",["+","start","len"],["+","n",1]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","b","start","len"]]],"kind":"defn","name":"ext.data_model.number_get","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","off",["ext.data_model.root_offset","doc"]],["if",["<","off",0],["return",-1],0],["ext.data_model.kind_at","doc","off"]],"kind":"defn","name":"ext.data_model.root_kind","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["if",["ext.data_model.doc_is_err","doc"],-1,1],"kind":"defn","name":"ext.data_model.root_offset","params":[{"name":"doc","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","count",["ext.data_model.seq_len","b","seq_off"]],["if",["<","count",0],["return",-1],0],["if",["<","idx",0],["return",-1],0],["if",[">=","idx","count"],["return",-1],0],["let","pos",["+","seq_off",5]],["for","i",0,"idx",["begin",["set","pos",["ext.data_model.skip_value","b","pos"]],["if",["<","pos",0],["return",-1],0],0]],["if",[">=u","pos",["view.len","b"]],-1,"pos"]],"kind":"defn","name":"ext.data_model.seq_get","params":[{"name":"b","ty":"bytes_view"},{"name":"seq_off","ty":"i32"},{"name":"idx","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","b"]],["if",[">=u","off","n"],["return",-1],0],["if",["=",["view.get_u8","b","off"],4],0,["return",-1]],["if",[">=u",["+","off",4],"n"],["return",-1],0],["codec.read_u32_le","b",["+","off",1]]],"kind":"defn","name":"ext.data_model.seq_len","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","b"]],["if",[">=u","off","n"],["return",-1],0],["let","tag",["view.get_u8","b","off"]],["if",["=","tag",0],["return",["+","off",1]],0],["if",["=","tag",1],["begin",["if",[">=u",["+","off",1],"n"],["return",-1],0],["return",["+","off",2]]],0],["if",["if",["=","tag",2],1,["=","tag",3]],["begin",["if",[">=u",["+","off",4],"n"],["return",-1],0],["let","len",["codec.read_u32_le","b",["+","off",1]]],["let","end",["+",["+","off",5],"len"]],["return",["if",[">=u","end",["+","n",1]],-1,"end"]]],0],["if",["=","tag",4],["begin",["if",[">=u",["+","off",4],"n"],["return",-1],0],["let","count",["codec.read_u32_le","b",["+","off",1]]],["let","pos",["+","off",5]],["for","_",0,"count",["begin",["set","pos",["ext.data_model.skip_value","b","pos"]],["if",["<","pos",0],["return",-1],0],0]],["return","pos"]],0],["if",["=","tag",5],["begin",["if",[">=u",["+","off",4],"n"],["return",-1],0],["let","count",["codec.read_u32_le","b",["+","off",1]]],["let","pos",["+","off",5]],["for","_",0,"count",["begin",["if",[">=u",["+","pos",4],["+","n",1]],["return",-1],0],["let","key_len",["codec.read_u32_le","b","pos"]],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","key_len"],["+","n",1]],["return",-1],0],["set","pos",["+","pos","key_len"]],["set","pos",["ext.data_model.skip_value","b","pos"]],["if",["<","pos",0],["return",-1],0],0]],["return","pos"]],0],-1],"kind":"defn","name":"ext.data_model.skip_value","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","b"]],["if",[">=u","off","n"],["return",["bytes.alloc",0]],0],["if",["=",["view.get_u8","b","off"],3],0,["return",["bytes.alloc",0]]],["if",[">=u",["+","off",4],"n"],["return",["bytes.alloc",0]],0],["let","len",["codec.read_u32_le","b",["+","off",1]]],["let","start",["+","off",5]],["if",[">=u",["+","start","len"],["+","n",1]],["return",["bytes.alloc",0]],0],["view.to_bytes",["view.slice","b","start","len"]]],"kind":"defn","name":"ext.data_model.string_get","params":[{"name":"b","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","v",["vec_u8.with_capacity",2]],["set","v",["vec_u8.push","v",1]],["set","v",["vec_u8.push","v",["if",["=","x",0],0,1]]],["vec_u8.into_bytes","v"]],"kind":"defn","name":"ext.data_model.value_bool","params":[{"name":"x","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","entries"]],["if",["<","n",4],["return",["bytes.alloc",0]],0],["let","count",["codec.read_u32_le","entries",0]],["let","offsets",["vec_u8.with_capacity",["*","count",4]]],["let","pos",4],["for","_",0,"count",["begin",["if",[">=u",["+","pos",4],["+","n",1]],["return",["bytes.alloc",0]],0],["set","offsets",["vec_u8.extend_bytes","offsets",["codec.write_u32_le","pos"]]],["let","key_len",["codec.read_u32_le","entries","pos"]],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","key_len"],["+","n",1]],["return",["bytes.alloc",0]],0],["set","pos",["+","pos","key_len"]],["if",[">=u",["+","pos",4],["+","n",1]],["return",["bytes.alloc",0]],0],["let","val_len",["codec.read_u32_le","entries","pos"]],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","val_len"],["+","n",1]],["return",["bytes.alloc",0]],0],["set","pos",["+","pos","val_len"]],0]],["if",["=","pos","n"],0,["return",["bytes.alloc",0]]],["let","offsets_b",["vec_u8.into_bytes","offsets"]],["let","offsets_v",["bytes.view","offsets_b"]],["let","used",["bytes.alloc","count"]],["let","out",["vec_u8.with_capacity",["+",5,["-","n",4]]]],["set","out",["vec_u8.push","out",5]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","count"]]],["let","prev_entry_off",-1],["for","_",0,"count",["begin",["let","best",-1],["for","j",0,"count",["begin",["if",["=",["bytes.get_u8","used","j"],1],0,["begin",["if",["=","best",-1],["set","best","j"],["begin",["let","j_off",["codec.read_u32_le","offsets_v",["*","j",4]]],["let","best_off",["codec.read_u32_le","offsets_v",["*","best",4]]],["if",["<",["ext.data_model._cmp_entry_key","entries","j_off","best_off"],0],["set","best","j"],0],0]],0]],0]],["set","used",["bytes.set_u8","used","best",1]],["let","entry_off",["codec.read_u32_le","offsets_v",["*","best",4]]],["if",["<","prev_entry_off",0],0,["if",["=",["ext.data_model._cmp_entry_key","entries","entry_off","prev_entry_off"],0],["return",["bytes.alloc",0]],0]],["set","prev_entry_off","entry_off"],["let","key_len",["codec.read_u32_le","entries","entry_off"]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","key_len"]]],["let","key_start",["+","entry_off",4]],["set","out",["ext.data_model._extend_view_range","out","entries","key_start","key_len"]],["let","val_len_off",["+","key_start","key_len"]],["let","val_len",["codec.read_u32_le","entries","val_len_off"]],["let","val_start",["+","val_len_off",4]],["set","out",["ext.data_model._extend_view_range","out","entries","val_start","val_len"]],0]],["vec_u8.into_bytes","out"]],"kind":"defn","name":"ext.data_model.value_map_from_entries","params":[{"name":"entries","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","v",["vec_u8.with_capacity",1]],["set","v",["vec_u8.push","v",0]],["vec_u8.into_bytes","v"]],"kind":"defn","name":"ext.data_model.value_null","params":[],"result":"bytes"},{"body":["begin",["let","n",["view.len","s"]],["let","v",["vec_u8.with_capacity",["+",5,"n"]]],["set","v",["vec_u8.push","v",2]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le","n"]]],["set","v",["ext.data_model._extend_view","v","s"]],["vec_u8.into_bytes","v"]],"kind":"defn","name":"ext.data_model.value_number","params":[{"name":"s","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","elems"]],["if",["<","n",4],["return",["bytes.alloc",0]],0],["let","count",["codec.read_u32_le","elems",0]],["let","pos",4],["let","out",["vec_u8.with_capacity",["+",5,["-","n",4]]]],["set","out",["vec_u8.push","out",4]],["set","out",["vec_u8.extend_bytes","out",["codec.write_u32_le","count"]]],["for","_",0,"count",["begin",["if",[">=u",["+","pos",4],["+","n",1]],["return",["bytes.alloc",0]],0],["let","val_len",["codec.read_u32_le","elems","pos"]],["set","pos",["+","pos",4]],["if",[">=u",["+","pos","val_len"],["+","n",1]],["return",["bytes.alloc",0]],0],["set","out",["ext.data_model._extend_view_range","out","elems","pos","val_len"]],["set","pos",["+","pos","val_len"]],0]],["if",["=","pos","n"],["vec_u8.into_bytes","out"],["bytes.alloc",0]]],"kind":"defn","name":"ext.data_model.value_seq_from_elems","params":[{"name":"elems","ty":"bytes_view"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","s"]],["let","v",["vec_u8.with_capacity",["+",5,"n"]]],["set","v",["vec_u8.push","v",3]],["set","v",["vec_u8.extend_bytes","v",["codec.write_u32_le","n"]]],["set","v",["ext.data_model._extend_view","v","s"]],["vec_u8.into_bytes","v"]],"kind":"defn","name":"ext.data_model.value_string","params":[{"name":"s","ty":"bytes_view"}],"result":"bytes"}],"imports":[],"kind":"module","module_id":"ext.data_model","schema_version":"x07.x07ast@0.3.0"}
