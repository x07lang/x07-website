{"decls":[{"kind":"export","names":["ext.data_model.toml.emit_canon"]},{"body":["begin",["let","ka",["ext.data_model.map_key_at","doc","map_off","a"]],["let","kb",["ext.data_model.map_key_at","doc","map_off","b"]],["let","la",["bytes.len","ka"]],["let","lb",["bytes.len","kb"]],["bytes.cmp_range","ka",0,"la","kb",0,"lb"]],"kind":"defn","name":"ext.data_model.toml._cmp_root_entry","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"a","ty":"i32"},{"name":"b","ty":"i32"}],"result":"i32"},{"body":["begin",["let","ka",["ext.data_model.map_key_at","doc","map_off","a"]],["let","kb",["ext.data_model.map_key_at","doc","map_off","b"]],["let","kav",["bytes.view","ka"]],["let","kbv",["bytes.view","kb"]],["let","da",["ext.data_model.toml._last_dot_or_err","kav"]],["let","db",["ext.data_model.toml._last_dot_or_err","kbv"]],["let","cmp",["bytes.cmp_range","ka",0,"da","kb",0,"db"]],["if",["!=","cmp",0],["return","cmp"],0],["let","a_start",["+","da",1]],["let","b_start",["+","db",1]],["let","a_len",["-",["bytes.len","ka"],"a_start"]],["let","b_len",["-",["bytes.len","kb"],"b_start"]],["bytes.cmp_range","ka","a_start","a_len","kb","b_start","b_len"]],"kind":"defn","name":"ext.data_model.toml._cmp_section_entry","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"a","ty":"i32"},{"name":"b","ty":"i32"}],"result":"i32"},{"body":["begin",["let","msg_invalid_value",["bytes.lit","data_model.toml:invalid_value"]],["let","msg_invalid_utf8",["bytes.lit","data_model.toml:invalid_utf8"]],["let","msg_invalid_string",["bytes.lit","data_model.toml:invalid_string"]],["let","msg_invalid_number",["bytes.lit","data_model.toml:invalid_number"]],["let","msg_unsupported_kind",["bytes.lit","data_model.toml:unsupported_kind"]],["let","tag",["ext.data_model.kind_at","doc","off"]],["if",["<","tag",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_value"]]],0],["if",["=","tag",1],["begin",["let","bv",["ext.data_model.bool_get","doc","off"]],["if",["<","bv",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_value"]]],0],["if",["=","bv",0],["return",["ext.data_model.doc_ok",["bytes.lit","false"]]],["return",["ext.data_model.doc_ok",["bytes.lit","true"]]]],0],0],["if",["=","tag",2],["begin",["let","num",["ext.data_model.number_get","doc","off"]],["if",["=",["bytes.len","num"],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_value"]]],0],["let","numv",["bytes.view","num"]],["if",["=",["ext.data_model.toml._is_canon_i32_dec","numv"],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_number"]]],0],["return",["ext.data_model.doc_ok","numv"]]],0],["if",["=","tag",3],["begin",["let","s",["ext.data_model.string_get","doc","off"]],["if",["=",["bytes.len","s"],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_value"]]],0],["let","sv",["bytes.view","s"]],["if",["=",["ext.unicode.unicode_utf8_is_valid","sv"],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_utf8"]]],0],["let","out",["vec_u8.with_capacity",["+",["view.len","sv"],2]]],["set","out",["vec_u8.push","out",34]],["let","n",["view.len","sv"]],["for","i",0,"n",["begin",["let","c",["view.get_u8","sv","i"]],["if",["=","c",34],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",34]],0],["if",["=","c",92],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",92]],0],["if",["=","c",10],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",110]],0],["if",["=","c",13],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",114]],0],["if",["=","c",9],["begin",["set","out",["vec_u8.push","out",92]],["set","out",["vec_u8.push","out",116]],0],["begin",["if",["<u","c",32],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_string"]]],0],["set","out",["vec_u8.push","out","c"]],0]]]]]],0]],["set","out",["vec_u8.push","out",34]],["let","b",["std.vec.as_bytes","out"]],["return",["ext.data_model.doc_ok",["bytes.view","b"]]]],0],["ext.data_model.doc_err_from_msg",["bytes.view","msg_unsupported_kind"]]],"kind":"defn","name":"ext.data_model.toml._emit_value_or_err","params":[{"name":"doc","ty":"bytes_view"},{"name":"off","ty":"i32"}],"result":"bytes"},{"body":["begin",["let","n",["view.len","s"]],["if",["<","n",1],["return",0],0],["let","i",0],["let","neg",0],["let","c0",["view.get_u8","s",0]],["if",["=","c0",45],["begin",["set","neg",1],["set","i",1],0],0],["if",["=","c0",43],["return",0],0],["if",[">=u","i","n"],["return",0],0],["let","d0",["view.get_u8","s","i"]],["if",["if",[">=u","d0",48],["<u","d0",58],0],0,["return",0]],["let","digit_len",["-","n","i"]],["if",["if",["=","d0",48],[">","digit_len",1],0],["return",0],0],["if",["if",["=","neg",1],["if",["=","d0",48],["=","digit_len",1],0],0],["return",0],0],["for","j","i","n",["begin",["let","c",["view.get_u8","s","j"]],["if",["if",[">=u","c",48],["<u","c",58],0],0,["return",0]],0]],["if",["<","digit_len",10],["return",1],0],["if",[">","digit_len",10],["return",0],0],["let","max",["bytes.lit","2147483647"]],["let","maxv",["bytes.view","max"]],["for","k",0,10,["begin",["let","a",["view.get_u8","s",["+","i","k"]]],["let","b",["view.get_u8","maxv","k"]],["if",["<","a","b"],["return",1],0],["if",[">","a","b"],["return",0],0],0]],1],"kind":"defn","name":"ext.data_model.toml._is_canon_i32_dec","params":[{"name":"s","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["if",["if",[">=u","c",65],["<u","c",91],0],["return",1],0],["if",["if",[">=u","c",97],["<u","c",123],0],["return",1],0],["if",["if",[">=u","c",48],["<u","c",58],0],["return",1],0],["if",["if",["=","c",95],1,["=","c",45]],["return",1],0],0],"kind":"defn","name":"ext.data_model.toml._is_key_char","params":[{"name":"c","ty":"i32"}],"result":"i32"},{"body":["begin",["let","n",["view.len","k"]],["if",["<","n",1],["return",-2],0],["let","last",-1],["let","prev_dot",1],["for","i",0,"n",["begin",["let","c",["view.get_u8","k","i"]],["if",["=","c",46],["begin",["if",["=","i",0],["return",-2],0],["if",["=","i",["-","n",1]],["return",-2],0],["if",["=","prev_dot",1],["return",-2],0],["set","last","i"],["set","prev_dot",1],0],["begin",["if",["=",["ext.data_model.toml._is_key_char","c"],0],["return",-2],0],["set","prev_dot",0],0]],0]],"last"],"kind":"defn","name":"ext.data_model.toml._last_dot_or_err","params":[{"name":"k","ty":"bytes_view"}],"result":"i32"},{"body":["begin",["let","out","idxs"],["for","i",0,"n",["begin",["let","best","i"],["for","j",["+","i",1],"n",["begin",["let","idx_best",["codec.read_u32_le",["vec_u8.as_view","out"],["*","best",4]]],["let","idx_j",["codec.read_u32_le",["vec_u8.as_view","out"],["*","j",4]]],["let","cmp",["ext.data_model.toml._cmp_root_entry","doc","map_off","idx_j","idx_best"]],["if",["<","cmp",0],["set","best","j"],0],0]],["if",["=","best","i"],0,["begin",["let","a",["codec.read_u32_le",["vec_u8.as_view","out"],["*","i",4]]],["let","b",["codec.read_u32_le",["vec_u8.as_view","out"],["*","best",4]]],["set","out",["std.u32.write_le_at_vec_u8","out",["*","i",4],"b"]],["set","out",["std.u32.write_le_at_vec_u8","out",["*","best",4],"a"]],0]],0]],"out"],"kind":"defn","name":"ext.data_model.toml._sort_root_idxs","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"idxs","ty":"vec_u8"},{"name":"n","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","out","idxs"],["for","i",0,"n",["begin",["let","best","i"],["for","j",["+","i",1],"n",["begin",["let","idx_best",["codec.read_u32_le",["vec_u8.as_view","out"],["*","best",4]]],["let","idx_j",["codec.read_u32_le",["vec_u8.as_view","out"],["*","j",4]]],["let","cmp",["ext.data_model.toml._cmp_section_entry","doc","map_off","idx_j","idx_best"]],["if",["<","cmp",0],["set","best","j"],0],0]],["if",["=","best","i"],0,["begin",["let","a",["codec.read_u32_le",["vec_u8.as_view","out"],["*","i",4]]],["let","b",["codec.read_u32_le",["vec_u8.as_view","out"],["*","best",4]]],["set","out",["std.u32.write_le_at_vec_u8","out",["*","i",4],"b"]],["set","out",["std.u32.write_le_at_vec_u8","out",["*","best",4],"a"]],0]],0]],"out"],"kind":"defn","name":"ext.data_model.toml._sort_section_idxs","params":[{"name":"doc","ty":"bytes_view"},{"name":"map_off","ty":"i32"},{"name":"idxs","ty":"vec_u8"},{"name":"n","ty":"i32"}],"result":"vec_u8"},{"body":["begin",["let","msg_root_not_map",["bytes.lit","data_model.toml:root_not_map"]],["let","msg_invalid_map",["bytes.lit","data_model.toml:invalid_map"]],["let","msg_invalid_map_key",["bytes.lit","data_model.toml:invalid_map_key"]],["let","msg_invalid_key",["bytes.lit","data_model.toml:invalid_key"]],["let","msg_invalid_map_value",["bytes.lit","data_model.toml:invalid_map_value"]],["if",["ext.data_model.doc_is_err","doc"],["return",["view.to_bytes","doc"]],0],["if",["=",["ext.data_model.root_kind","doc"],5],0,["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_root_not_map"]]]],["let","map_off",["ext.data_model.root_offset","doc"]],["let","count",["ext.data_model.map_len","doc","map_off"]],["if",["<","count",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_map"]]],0],["let","root_idxs",["vec_u8.with_capacity",["*","count",4]]],["let","sec_idxs",["vec_u8.with_capacity",["*","count",4]]],["let","root_n",0],["let","sec_n",0],["for","i",0,"count",["begin",["let","key",["ext.data_model.map_key_at","doc","map_off","i"]],["if",["=",["bytes.len","key"],0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_map_key"]]],0],["let","dot",["ext.data_model.toml._last_dot_or_err",["bytes.view","key"]]],["if",["=","dot",-2],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_key"]]],0],["if",["=","dot",-1],["begin",["set","root_idxs",["std.u32.push_le","root_idxs","i"]],["set","root_n",["+","root_n",1]],0],["begin",["set","sec_idxs",["std.u32.push_le","sec_idxs","i"]],["set","sec_n",["+","sec_n",1]],0]],0]],["set","root_idxs",["ext.data_model.toml._sort_root_idxs","doc","map_off","root_idxs","root_n"]],["set","sec_idxs",["ext.data_model.toml._sort_section_idxs","doc","map_off","sec_idxs","sec_n"]],["let","out",["vec_u8.with_capacity",256]],["for","p",0,"root_n",["begin",["let","idx",["codec.read_u32_le",["vec_u8.as_view","root_idxs"],["*","p",4]]],["let","key",["ext.data_model.map_key_at","doc","map_off","idx"]],["let","key_len",["bytes.len","key"]],["set","out",["vec_u8.extend_bytes_range","out","key",0,"key_len"]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.push","out",61]],["set","out",["vec_u8.push","out",32]],["let","val_off",["ext.data_model.map_value_at","doc","map_off","idx"]],["if",["<","val_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_map_value"]]],0],["let","enc",["ext.data_model.toml._emit_value_or_err","doc","val_off"]],["let","encv",["bytes.view","enc"]],["if",["ext.data_model.doc_is_err","encv"],["return",["view.to_bytes","encv"]],0],["let","enc_len",["view.len","encv"]],["set","out",["vec_u8.extend_bytes_range","out","encv",1,["-","enc_len",1]]],["set","out",["vec_u8.push","out",10]],0]],["if",["=","sec_n",0],0,["begin",["let","prev_section",["bytes.alloc",0]],["let","have_prev",0],["for","p",0,"sec_n",["begin",["let","idx",["codec.read_u32_le",["vec_u8.as_view","sec_idxs"],["*","p",4]]],["let","key",["ext.data_model.map_key_at","doc","map_off","idx"]],["let","keyv",["bytes.view","key"]],["let","dot",["ext.data_model.toml._last_dot_or_err","keyv"]],["let","section",["view.to_bytes",["view.slice","keyv",0,"dot"]]],["if",["=","have_prev",0],["begin",["if",[">","root_n",0],["set","out",["vec_u8.push","out",10]],0],["set","have_prev",1],["set","prev_section",["view.to_bytes",["bytes.view","section"]]],["set","out",["vec_u8.push","out",91]],["set","out",["vec_u8.extend_bytes","out","section"]],["set","out",["vec_u8.push","out",93]],["set","out",["vec_u8.push","out",10]],0],["begin",["let","cmp",["bytes.cmp_range","section",0,["bytes.len","section"],"prev_section",0,["bytes.len","prev_section"]]],["if",["!=","cmp",0],["begin",["set","out",["vec_u8.push","out",10]],["set","prev_section",["view.to_bytes",["bytes.view","section"]]],["set","out",["vec_u8.push","out",91]],["set","out",["vec_u8.extend_bytes","out","section"]],["set","out",["vec_u8.push","out",93]],["set","out",["vec_u8.push","out",10]],0],0],0]],["let","name_start",["+","dot",1]],["let","name_len",["-",["bytes.len","key"],"name_start"]],["set","out",["vec_u8.extend_bytes_range","out","key","name_start","name_len"]],["set","out",["vec_u8.push","out",32]],["set","out",["vec_u8.push","out",61]],["set","out",["vec_u8.push","out",32]],["let","val_off",["ext.data_model.map_value_at","doc","map_off","idx"]],["if",["<","val_off",0],["return",["ext.data_model.doc_err_from_msg",["bytes.view","msg_invalid_map_value"]]],0],["let","enc",["ext.data_model.toml._emit_value_or_err","doc","val_off"]],["let","encv",["bytes.view","enc"]],["if",["ext.data_model.doc_is_err","encv"],["return",["view.to_bytes","encv"]],0],["let","enc_len",["view.len","encv"]],["set","out",["vec_u8.extend_bytes_range","out","encv",1,["-","enc_len",1]]],["set","out",["vec_u8.push","out",10]],0]],0]],["let","toml_bytes",["std.vec.as_bytes","out"]],["ext.data_model.doc_ok",["bytes.view","toml_bytes"]]],"kind":"defn","name":"ext.data_model.toml.emit_canon","params":[{"name":"doc","ty":"bytes_view"}],"result":"bytes"}],"imports":["ext.data_model","ext.unicode","std.u32","std.vec"],"kind":"module","module_id":"ext.data_model.toml","schema_version":"x07.x07ast@0.3.0"}